import{r as T,b as O,f as H,a as N,g as q,d as F,c as $,t as j,h as B,i as R}from"./stopLabels-EZMPmHTw.js";const M="kaist-bus-favorites",D="kaist-bus-theme",b="kaist-bus-night-sky",C="kaist-bus-card-glow";let p=null;const G="campus-loop",v=[{id:"main",label:"본교",match:/본교/},{id:"munji",label:"문지",match:/문지/},{id:"hwaam",label:"화암",match:/화암/}],a={now:new Date,serviceDay:"weekday",serviceOverride:null,routeId:"",stopId:"",campusFrom:"main",campusTo:"munji",stopPillsExpanded:!1};function w(){try{const t=localStorage.getItem(M);return t?JSON.parse(t):[]}catch{return[]}}function K(t){const e=document.querySelector("#favoriteDockPanel"),n=document.querySelector("#favoriteDock"),s=document.querySelector("[data-favorite-tab]");if(!e)return;const o=w();if(!o.length){if(e.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,n&&n.classList.add("is-empty"),s){const i=n==null?void 0:n.classList.contains("is-open");s.classList.toggle("is-active",!!i)}return}n&&n.classList.remove("is-empty");const r=a.now.getHours()*60+a.now.getMinutes(),l=S(a.now),c=o.map(i=>{var I;const d=T.routes.find(y=>y.id===i.routeId);if(!d)return"";let u=d.stops.find(y=>y.id===i.stopId);if(m(d)&&i.campusFrom&&(u=u||_(d,i.campusFrom,i.campusTo)),!u)return"";const g=((I=u.times)==null?void 0:I[l])||[],L=q(g,r-2,2),E=g[g.length-1],A=m(d)&&i.campusFrom?`${h(i.campusFrom)} → ${h(i.campusTo)}`:u.direction&&u.direction!==d.name?`${$(d.id,u.name)} → ${u.direction}`:`${$(d.id,u.name)}`;return`
        <div class="favorite-dock__item">
          <div class="favorite-dock__title">
            <span>${d.name}</span>
            <span>${A}</span>
          </div>
          <div class="favorite-dock__row">
            <div class="favorite-dock__times">
              ${L.map(y=>`
                  <span>
                    ${y}
                    ${E&&y===E?'<em class="last-tag">막차</em>':""}
                  </span>
                `).join("")}
            </div>
            <button class="favorite-dock__remove" type="button" data-remove-favorite="${i.key}">
              삭제
            </button>
          </div>
        </div>
      `}).filter(Boolean);if(!c.length){if(e.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,n&&n.classList.add("is-empty"),s){const i=n==null?void 0:n.classList.contains("is-open");s.classList.toggle("is-active",!!i)}return}e.innerHTML=c.join("")}function S(t){const e=j(t);return B.forcedWeekends.includes(e)||R(t)?"weekend":"weekday"}function W(t){return a.serviceOverride||S(t)}function J(t){const e=["olev","campus-loop","wolpyeong","wolpyeong-early"];return T.routes.sort((n,s)=>{const o=e.indexOf(n.id),r=e.indexOf(s.id),l=o===-1?Number.MAX_SAFE_INTEGER:o,c=r===-1?Number.MAX_SAFE_INTEGER:r;return l!==c?l-c:n.name.localeCompare(s.name)})}function Y(t,e){return t.find(n=>n.id===e)||t[0]}function m(t){return(t==null?void 0:t.id)===G}function h(t){var e;return((e=v.find(n=>n.id===t))==null?void 0:e.label)||t}function k(t){const e=v.find(n=>n.match.test(t));return e?e.id:null}function z(t,e){const n=k(t[e].name);for(let s=e+1;s<t.length;s+=1){const o=k(t[s].name);if(o&&o!==n)return o}return null}function _(t,e,n){const s=t.stops||[],o=s.map((c,i)=>({stop:c,index:i,campus:k(c.name)})).filter(c=>c.campus===e);if(!o.length)return s[0];const r=o.filter(c=>/출발/.test(c.stop.name)),l=r.length?r:o;if(n){const c=l.find(i=>z(s,i.index)===n);if(c)return c.stop}return l[0].stop}function P(t){return m(t)?_(t,a.campusFrom,a.campusTo):t.stops.find(e=>e.id===a.stopId)||t.stops.find(e=>e.default)||t.stops[0]}function U(t){const e=document.querySelector("[data-route-title]"),n=document.querySelector("[data-route-subtitle]"),s=document.querySelector("[data-route-badge]"),o=document.querySelector("[data-weekday]");if(e&&(e.textContent=t.name),n&&(n.textContent=m(t)?`${h(a.campusFrom)} → ${h(a.campusTo)}`:t.subtitle||""),s){const r=t.stops.some(l=>{var c;return(((c=l.times)==null?void 0:c.weekend)||[]).length});s.textContent=r?"매일 운영":"평일 운영",s.classList.toggle("is-daily",r),s.classList.toggle("is-weekday",!r)}if(o){const r=S(a.now)==="weekday"?"평일":"휴일";o.textContent=`${O(a.now)} (${r}) ·`}}function V(){const t=document.querySelector("[data-clock]"),e=document.querySelector("[data-date]");if(!t||!e)return;t.textContent=H(a.now);const n=N(a.now);e.textContent=n.replace(/^\d{4}년\s*/,"")}function X(){try{return localStorage.getItem(D)}catch{return null}}function Q(t){try{localStorage.setItem(D,t)}catch{}}function x(t){const e=X();let n=!0;if(e==="dark")n=!1;else if(e==="light")n=!0;else{const o=t.getHours();n=o>=6&&o<18}document.body.classList.toggle("theme-night",!n);const s=document.querySelector('meta[name="theme-color"]');s&&s.setAttribute("content",n?"#f5f5fb":"#05070f"),n?document.documentElement.style.removeProperty("--night-sky"):Z()}function Z(){if(!p&&window.__nightSkyCss&&(p=window.__nightSkyCss),!p)try{p=localStorage.getItem(b)||sessionStorage.getItem(b)}catch{p=null}if(!p){p=ee();try{localStorage.setItem(b,p),sessionStorage.setItem(b,p)}catch{}}window.__nightSkyCss=p,document.documentElement.style.setProperty("--night-sky",p)}function ee(){const t=[],n=typeof window<"u"?window.innerWidth:1200,s=typeof window<"u"?window.innerHeight:800;for(let o=0;o<28;o+=1){const r=Math.floor(Math.random()*n),l=Math.floor(Math.random()*s),c=(Math.random()*1.8+.6).toFixed(2),i=(Math.random()*.5+.35).toFixed(2),u=Math.random()<.25?`rgba(255, 238, 180, ${i})`:`rgba(255, 255, 255, ${i})`;t.push(`radial-gradient(circle at ${r}px ${l}px, ${u} 0 ${c}px, transparent ${(Number(c)+1.6).toFixed(2)}px)`)}if(Math.random()<.65){const o=Math.floor(Math.random()*n),r=Math.floor(Math.random()*(s*.6));t.push(`radial-gradient(circle at ${o}px ${r}px, rgba(255, 244, 190, 0.95) 0 4px, transparent 7px)`)}return t.push("linear-gradient(180deg, #05070f 0%, #0b1026 55%, #141b3f 100%)"),t.join(", ")}function te(){const t=()=>Math.random()<.7?Math.random()<.5?-15+Math.random()*20:95+Math.random()*20:15+Math.random()*70,e=(o,r)=>{const l=Math.round(t()),c=Math.round(t()),i=Math.floor(420+Math.random()*420),d=Math.floor(320+Math.random()*360),u=(r+Math.random()*.06).toFixed(2);return`radial-gradient(${i}px ${d}px at ${l}% ${c}%, rgba(${o}, ${u}), transparent 72%)`},n=["246, 226, 138","255, 181, 201","171, 228, 255","160, 255, 224","198, 176, 255","255, 214, 165"],s=[];for(let o=0;o<10;o+=1){const r=n[o%n.length];s.push(e(r,.045))}return s}function ne(){if(!document.body.classList.contains("theme-night"))return;const t=document.querySelectorAll(".hero-card, .next-card, .notice-card, .route-card, .time-table");let e={};try{e=JSON.parse(sessionStorage.getItem(C)||"{}")}catch{e={}}const n=o=>o.classList.contains("hero-card")?"hero":o.classList.contains("next-card")?"next":o.classList.contains("notice-card")?"notice":o.classList.contains("route-card")?"route":o.classList.contains("time-table")?"table":"card",s=location.pathname.replace(/\W+/g,"")||"route";t.forEach((o,r)=>{const l=n(o),c=`${s}:${l}:${r}`;e[c]||(e[c]=te());const[i,d,u]=e[c];o.style.setProperty("--card-glow-1",i),o.style.setProperty("--card-glow-2",d),o.style.setProperty("--card-glow-3",u)});try{sessionStorage.setItem(C,JSON.stringify(e))}catch{}}function se(t,e){const n=document.querySelector("#routeSelect"),s=document.querySelector("#stopSelect"),o=document.querySelector("#stopSelectLabel"),r=document.querySelector("#campusSelector");if(!n||!s)return;n.innerHTML=t.map(c=>`<option value="${c.id}">${c.name}${c.subtitle?` ${c.subtitle}`:""}</option>`).join(""),n.value=e.id;const l=m(e);if(n.disabled=!1,n.classList.remove("route-select--static"),l?s.innerHTML="":s.innerHTML=e.stops.map(c=>`<option value="${c.id}">${c.name}</option>`).join(""),l)s.disabled=!0;else{const c=e.stops.find(i=>i.default)||e.stops[0];a.stopId=a.stopId||c.id,s.value=a.stopId,s.disabled=e.stops.length<=1}s.classList.toggle("is-hidden",l),s.style.display=l?"none":"inline-flex",s.hidden=l,s.setAttribute("aria-hidden",l?"true":"false"),s.tabIndex=l?-1:0,o&&(o.classList.toggle("is-hidden",l),o.hidden=l,o.style.display=l?"none":"inline-flex"),r&&(r.style.display=l?"flex":"none"),n.onchange=c=>{a.routeId=c.target.value,a.stopId="",f()},s.onchange=c=>{a.stopId=c.target.value,f()}}function oe(t){const e=document.querySelector("#campusSelector");if(!e||!m(t))return;const n=e.querySelector("[data-campus-role='from']"),s=e.querySelector("[data-campus-role='to']"),o=e.querySelector("#campusSwap"),r=(i,d)=>{if(i!==d)return{fromId:i,toId:d};const u=v.find(g=>g.id!==i);return{fromId:i,toId:u?u.id:d}},l=i=>{const d=r(i,a.campusTo);a.campusFrom=d.fromId,a.campusTo=d.toId,f()},c=i=>{const d=r(a.campusFrom,i);a.campusFrom=d.fromId,a.campusTo=d.toId,f()};n&&(n.innerHTML=v.map(i=>`
        <button class="campus-pill ${i.id===a.campusFrom?"is-active":""}" data-campus-from="${i.id}">
          ${i.label}
        </button>
      `).join(""),n.querySelectorAll("[data-campus-from]").forEach(i=>{i.addEventListener("click",()=>l(i.dataset.campusFrom))})),s&&(s.innerHTML=v.map(i=>`
        <button class="campus-pill ${i.id===a.campusTo?"is-active":""} ${i.id===a.campusFrom?"is-disabled":""}" data-campus-to="${i.id}" ${i.id===a.campusFrom?"disabled":""}>
          ${i.label}
        </button>
      `).join(""),s.querySelectorAll("[data-campus-to]").forEach(i=>{i.addEventListener("click",()=>c(i.dataset.campusTo))})),o&&(o.onclick=()=>{const i=a.campusTo,d=a.campusFrom;a.campusFrom=i,a.campusTo=d,f()})}function ae(t){const e=document.querySelector("#stopPills"),n=document.querySelector("#stopPillsToggle");if(!e)return;const s=e.closest("section");if(m(t)){s&&(s.style.display="none");return}if(t.stops.length<=1){s&&(s.style.display="none");return}s&&(s.style.display="block"),e.innerHTML=t.stops.map(r=>`
      <button class="stop-pill ${r.id===a.stopId?"is-active":""}" data-stop="${r.id}">
        ${$(t.id,r.name)}
      </button>
    `).join("");const o=()=>{if(!n)return;const r=e.scrollHeight>e.clientHeight+4;n.style.display=r||a.stopPillsExpanded?"inline-flex":"none",n.innerHTML="",n.classList.toggle("is-open",a.stopPillsExpanded)};e.classList.toggle("is-collapsed",!a.stopPillsExpanded),e.querySelectorAll("[data-stop]").forEach(r=>{r.addEventListener("click",()=>{a.stopId=r.dataset.stop,f()})}),n&&(n.onclick=()=>{a.stopPillsExpanded=!a.stopPillsExpanded,e.classList.toggle("is-collapsed",!a.stopPillsExpanded),o()}),requestAnimationFrame(o)}function ie(t,e){var d;const n=document.querySelector("#nextPanel");if(!n)return;const s=a.now.getHours()*60+a.now.getMinutes(),o=((d=e.times)==null?void 0:d[a.serviceDay])||[];if(o.length===0){n.style.display="none";return}n.style.display="";const r=o[o.length-1],l=q(o,s,5),i=m(t)?`${h(a.campusFrom)} → ${h(a.campusTo)}`:`${e.name} 기준`;n.innerHTML=`
    <div class="next-header">
      <div>
        <h3>${t.name}</h3>
        <p>${i}</p>
      </div>
      <span class="next-badge">가까운 예정</span>
    </div>
    <div class="next-list">
      ${l.map(u=>`
          <div class="next-chip">
            ${u}
            ${r&&u===r?'<span class="last-tag">막차</span>':""}
          </div>
        `).join("")}
    </div>
    <p class="next-note">실시간 위치 아님 · 실제 운행과 차이 가능</p>
  `}function re(t,e){var l;const n=document.querySelector("#timeTable"),s=document.querySelector("#timeTableSection");if(!n)return;const o=(((l=e.times)==null?void 0:l[a.serviceDay])||[]).slice().sort((c,i)=>F(c)-F(i)),r=o[o.length-1];if(o.length===0){n.innerHTML=`
      <div class="time-empty">
        선택한 운행일에는 시간표가 없습니다.
      </div>
    `,s&&(s.style.display="");return}s&&(s.style.display=""),n.innerHTML=o.map(c=>`
      <div class="time-row ${r&&c===r?"last-run":""}">
        <span>${c}</span>
        <span class="time-label">${r&&c===r?"막차":"예정"}</span>
      </div>
    `).join("")}function ce(t,e){var l;const n=document.querySelector("#routeNote");if(!n)return;const o=(((l=e==null?void 0:e.times)==null?void 0:l[a.serviceDay])||[]).length===0?"선택한 운행일에는 운행하지 않습니다.":"",r=t.note||"";n.textContent=[o,r].filter(Boolean).join(`
`),n.style.display=n.textContent?"":"none"}function le(t,e){const n=document.querySelector("#favoriteToggleRoute");if(!n)return;const s=w(),o=m(t)?`${t.id}:${a.campusFrom}->${a.campusTo}`:`${t.id}:${e.id}`;n.textContent=s.some(r=>r.key===o)?"즐겨찾기 해제":"즐겨찾기 추가"}function f(){var s;a.now=new Date,a.serviceDay=W(a.now);const t=J(),e=Y(t,a.routeId||((s=t[0])==null?void 0:s.id));if(!e)return;a.routeId=e.id;const n=P(e);U(e),V(),x(a.now),se(t,e),oe(e),ie(e,n),re(e,n),ce(e,n),ae(e),le(e,n),K(),ne()}function de(){const t=document.querySelector("#serviceDayToggle");if(!t)return;const e=()=>{const n=S(a.now),s=a.serviceOverride||n;t.querySelectorAll("button[data-day]").forEach(o=>{const r=o.dataset.day,c=r==="auto"?!a.serviceOverride:r===s;o.classList.toggle("is-active",c)})};t.addEventListener("click",n=>{const s=n.target.closest("button[data-day]");if(!s)return;const o=s.dataset.day,r=S(a.now);o==="auto"?a.serviceOverride=null:a.serviceOverride=o===r?null:o,e(),f()}),e()}function ue(){const t=document.querySelector("#favoriteToggleRoute");t&&t.addEventListener("click",()=>{const e=w(),n=T.routes.find(l=>l.id===a.routeId),s=n?P(n):null,o=n&&m(n)?`${n.id}:${a.campusFrom}->${a.campusTo}`:`${a.routeId}:${a.stopId}`,r=e.some(l=>l.key===o)?e.filter(l=>l.key!==o):[{key:o,routeId:a.routeId,stopId:(s==null?void 0:s.id)||a.stopId,campusFrom:n&&m(n)?a.campusFrom:void 0,campusTo:n&&m(n)?a.campusTo:void 0,savedAt:Date.now()},...e];localStorage.setItem(M,JSON.stringify(r.slice(0,10))),f()})}function me(){const t=document.querySelector("[data-theme-toggle]");t&&(t.addEventListener("click",()=>{const e=document.body.classList.contains("theme-night");Q(e?"light":"dark"),x(new Date)}),x(new Date))}function pe(){const t=document.querySelector("#favoriteDock"),e=document.querySelector("[data-favorite-tab]"),n=document.querySelector("#favoriteDockPanel");if(!t||!e)return;let s=!1;const o=()=>{e.classList.toggle("is-active",t.classList.contains("is-open"))},r=()=>{t.classList.add("is-open"),o(),c()},l=()=>{s||(t.classList.remove("is-open"),o())};t.addEventListener("mouseenter",()=>r()),t.addEventListener("mouseleave",()=>l()),e.addEventListener("mouseenter",()=>r()),e.addEventListener("mouseleave",()=>l()),t.addEventListener("click",()=>{s=!s,s?t.classList.add("is-open"):t.classList.remove("is-open"),o()}),e.addEventListener("click",()=>{s=!s,s?t.classList.add("is-open"):t.classList.remove("is-open"),o()});const c=()=>{if(!window.matchMedia("(max-width: 640px)").matches||!t.classList.contains("is-open"))return;const d=e.getBoundingClientRect();t.style.top=`${Math.round(d.bottom+8)}px`};document.addEventListener("click",i=>{t.classList.contains("is-open")&&(t.contains(i.target)||e.contains(i.target)||(s=!1,t.classList.remove("is-open"),o()))}),n&&n.addEventListener("click",i=>{i.stopPropagation();const d=i.target.closest("[data-remove-favorite]");if(!d)return;const u=d.dataset.removeFavorite;if(!u)return;const g=w().filter(L=>L.key!==u);localStorage.setItem(M,JSON.stringify(g)),f()}),o(),window.addEventListener("scroll",c,{passive:!0}),window.addEventListener("resize",c),e.addEventListener("click",c),t.addEventListener("mouseenter",c)}f();ue();me();pe();de();setInterval(f,1e3);
