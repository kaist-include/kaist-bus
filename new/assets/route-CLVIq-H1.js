import{r as ge,f as he,a as ye,t as we,h as be,i as Se,b as Le,d as ee,e as P,j as ke,k as Ee,l as z,g as xe,m as Ce,c as Ie}from"./recentSearch-BISVGYZR.js";const U="kaist-bus-favorites",te="kaist-bus-theme",N="kaist-bus-night-sky",q="kaist-bus-night-sky-meta",J="v2",Te=24*60*60*1e3,De=1/7,Q="kaist-bus-card-glow";let L=null;const $e="campus-loop",T=[{id:"main",label:"본교",match:/본교/},{id:"munji",label:"문지",match:/문지/},{id:"hwaam",label:"화암",match:/화암/}],s={now:new Date,serviceDay:"weekday",serviceOverride:null,routeId:"",stopId:"",campusFrom:"main",campusTo:"munji",stopPillsExpanded:!1,dropdownOpen:!1,favoriteHelpVisible:!1,sharedFromLink:!1,routeSearch:"",stopSearch:""},$=new Map,_e=12,V=4*60;function Ae(e){const n=new Map;return e.forEach(t=>{if(!n.has(t.id)){n.set(t.id,{...t,stops:t.stops.map(d=>{var a,r;return{...d,times:{weekday:[...((a=d.times)==null?void 0:a.weekday)||[]],weekend:[...((r=d.times)==null?void 0:r.weekend)||[]]}}})});return}const o=n.get(t.id);!o.note&&t.note&&(o.note=t.note);const c=new Map(o.stops.map(d=>[d.name,d]));t.stops.forEach(d=>{var r,i;const a=c.get(d.name);if(!a){const l={...d,times:{weekday:[...((r=d.times)==null?void 0:r.weekday)||[]],weekend:[...((i=d.times)==null?void 0:i.weekend)||[]]}};o.stops.push(l),c.set(d.name,l);return}["weekday","weekend"].forEach(l=>{var h,g;const u=((h=a.times)==null?void 0:h[l])||[],p=((g=d.times)==null?void 0:g[l])||[];if(!u.length&&p.length){a.times[l]=[...p];return}p.forEach(S=>{u.includes(S)||u.push(S)})})})}),Array.from(n.values())}const M=Ae(ge.routes);function B(e){const[n,t]=e.split(":").map(Number);if(Number.isNaN(n)||Number.isNaN(t))return 0;let o=n*60+t;return n<4&&(o+=1440),o}function ne(e){return!e||e.length===0?null:Math.max(...e.map(B))}function oe(e,n){if(!e)return null;const t=e.stops.flatMap(o=>{var c;return((c=o.times)==null?void 0:c[n])||[]});return ne(t)}function _(e,n){const t=e.stops.filter(o=>{var c;return(((c=o.times)==null?void 0:c[n])||[]).length});return t.length?t:e.stops}function Me(e,n,t){const o=e.stops.filter(d=>d.id===n);return o.length?o.find(d=>{var a;return(((a=d.times)==null?void 0:a[t])||[]).length})||o[0]:null}function X(e){s.dropdownOpen=e,document.documentElement.classList.toggle("dropdown-open",e)}function se(){$.forEach(e=>{e.open&&e.close()})}function Fe(e){if($.has(e)){const r=$.get(e);return(!r.wrapper.isConnected||r.wrapper.previousSibling!==e)&&e.after(r.wrapper),r}const n=document.createElement("div");n.className="dropdown";const t=document.createElement("button");t.type="button",t.className="dropdown__button",t.setAttribute("aria-haspopup","listbox"),t.setAttribute("aria-expanded","false");const o=document.createElement("span");o.className="dropdown__label";const c=document.createElement("span");c.className="dropdown__chevron",t.append(o,c);const d=document.createElement("div");d.className="dropdown__list",d.setAttribute("role","listbox"),d.tabIndex=-1,n.append(t,d),e.after(n),e.classList.add("native-select"),e.setAttribute("aria-hidden","true"),e.tabIndex=-1;const a={wrapper:n,button:t,label:o,list:d,optionsKey:"",options:[],activeIndex:0,open:!1,suppressCloseUntil:0,pendingClose:!1,openDropdown(){if(a.open)return;se(),a.open=!0,n.classList.add("is-open"),t.setAttribute("aria-expanded","true"),X(!0),a.syncActiveIndex(),d.tabIndex=-1,a.suppressCloseUntil=performance.now()+500;const r=/Android/i.test(navigator.userAgent||"");a.searchInput&&!r&&a.searchInput.focus()},close(){if(!a.open)return;a.open=!1,n.classList.remove("is-open"),t.setAttribute("aria-expanded","false"),d.tabIndex=-1,t.focus();const r=Array.from($.values()).some(i=>i.open);X(r)},syncActiveIndex(){const r=e.selectedIndex>=0?e.selectedIndex:0;a.setActive(r)},setActive(r){if(!a.options.length)return;const i=Math.max(0,Math.min(r,a.options.length-1));a.activeIndex=i,a.options.forEach((l,u)=>{const p=u===i;l.classList.toggle("is-active",p),l.setAttribute("aria-selected",p?"true":"false"),p&&l.scrollIntoView({block:"nearest"})})}};return n.addEventListener("pointerdown",()=>{a.ignoreDocumentClick=!0,window.setTimeout(()=>{a.ignoreDocumentClick=!1},0)}),d.addEventListener("pointerdown",()=>{a.ignoreDocumentClick=!0,window.setTimeout(()=>{a.ignoreDocumentClick=!1},0)}),t.addEventListener("click",()=>{a.open?a.close():a.openDropdown()}),t.addEventListener("keydown",r=>{if(r.key==="ArrowDown"||r.key==="ArrowUp"){if(r.preventDefault(),!a.open){a.openDropdown();return}a.setActive(a.activeIndex+(r.key==="ArrowDown"?1:-1));return}if(a.open&&r.key==="Enter"){r.preventDefault();const i=a.options[a.activeIndex];i&&(e.value=i.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),a.close());return}a.open&&r.key==="Escape"&&(r.preventDefault(),a.close())}),d.addEventListener("click",r=>{const i=r.target.closest(".dropdown__option");if(!i)return;const l=i.dataset.value;l!=null&&(e.value=l,e.dispatchEvent(new Event("change",{bubbles:!0})),a.close())}),d.addEventListener("keydown",r=>{if(r.key==="Escape"){r.preventDefault(),a.close();return}if(r.key==="ArrowDown"){r.preventDefault(),a.setActive(a.activeIndex+1);return}if(r.key==="ArrowUp"){r.preventDefault(),a.setActive(a.activeIndex-1);return}if(r.key==="Enter"){r.preventDefault();const i=a.options[a.activeIndex];i&&(e.value=i.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),a.close())}}),document.addEventListener("pointerdown",r=>{if(!a.open||performance.now()<a.suppressCloseUntil||a.ignoreDocumentClick)return;const i=r.composedPath?r.composedPath():[];(i.length?i.includes(n):n.contains(r.target))||(a.pendingClose=!0)}),document.addEventListener("pointerup",r=>{if(!a.open||!a.pendingClose)return;a.pendingClose=!1;const i=r.composedPath?r.composedPath():[];(i.length?i.includes(n):n.contains(r.target))||document.activeElement&&n.contains(document.activeElement)||a.close()}),$.set(e,a),a}function E(e,n=null){var S;const t=Fe(e),o=e.hidden||e.style.display==="none"||e.classList.contains("is-hidden");t.wrapper.style.display=o?"none":"",t.button.disabled=e.disabled,t.button.setAttribute("aria-disabled",e.disabled?"true":"false");const c=e.id==="routeSelect"||e.id==="stopSelect",d=c?e.id:"",a=Array.from(e.options).map(v=>({value:v.value,label:v.textContent})),r=e.id==="routeSelect"?s.routeSearch:e.id==="stopSelect"?s.stopSearch:"",i=n??r,l=[d,a.map(v=>`${v.value}:${v.label}`).join("|")].join("|");if(l!==t.optionsKey){if(t.optionsKey=l,c){if(!t.searchWrap){const v=document.createElement("div");v.className="dropdown__search";const m=document.createElement("input");m.type="search",m.className="dropdown__search-input",m.placeholder=e.id==="routeSelect"?"노선 검색":"정류장 검색",m.addEventListener("pointerdown",()=>{t.ignoreDocumentClick=!0}),m.addEventListener("focus",()=>{t.suppressCloseUntil=performance.now()+500});const f=document.createElement("button");f.type="button",f.className="search-clear search-clear--dropdown",f.setAttribute("aria-label","검색어 삭제"),f.textContent="×";const y=()=>{f.classList.toggle("is-visible",!!m.value)};m.addEventListener("compositionstart",()=>{t.isComposing=!0,t.compositionBase=e.id==="routeSelect"?s.routeSearch:s.stopSearch}),m.addEventListener("compositionupdate",()=>{E(e,m.value),y()}),m.addEventListener("compositionend",()=>{t.isComposing=!1,e.id==="routeSelect"?s.routeSearch=m.value:s.stopSearch=m.value,t.compositionBase="",E(e,m.value),y()}),m.addEventListener("input",()=>{if(t.isComposing){E(e,m.value),y();return}e.id==="routeSelect"?s.routeSearch=m.value:s.stopSearch=m.value,E(e,m.value),y()}),m.addEventListener("keydown",w=>{if(w.key!=="Enter")return;const D=e.id==="routeSelect"?"route":"stop";ke(D,m.value),E(e,m.value),y()}),f.addEventListener("click",()=>{m.value="",e.id==="routeSelect"?s.routeSearch="":s.stopSearch="",t.compositionBase="",E(e,""),y(),m.focus()}),v.append(m),v.append(f),t.searchWrap=v,t.searchInput=m,t.searchClear=f}!t.isComposing&&document.activeElement!==t.searchInput&&(t.searchInput.value=i||""),t.searchClear&&t.searchClear.classList.toggle("is-visible",!!t.searchInput.value),t.recentWrap||(t.recentWrap=document.createElement("div"),t.recentWrap.className="dropdown__recent",t.recentWrap.addEventListener("click",v=>{v.stopPropagation(),t.ignoreDocumentClick=!0;const m=v.target.closest("[data-recent]");if(!m)return;const f=m.dataset.recent||"";e.id==="routeSelect"?s.routeSearch=f:s.stopSearch=f,E(e,f)})),t.optionsContainer||(t.optionsContainer=document.createElement("div")),t.list.replaceChildren(t.searchWrap,t.recentWrap,t.optionsContainer)}else t.list.innerHTML="",t.optionsContainer=t.list;t.optionsContainer.innerHTML="",t.options=a.map((v,m)=>{const f=document.createElement("button");return f.type="button",f.className="dropdown__option",f.setAttribute("role","option"),f.dataset.value=v.value,f.dataset.label=v.label,f.addEventListener("mouseenter",()=>{t.setActive(m)}),t.optionsContainer.append(f),f})}const u=(v,m=v)=>{if(!t.optionsContainer)return;let f=0;t.options.forEach(w=>{const D=w.dataset.label||"",F=v?Ce(D,v):!0;w.style.display=F?"":"none",F&&(w.innerHTML=Ie(D,m),f+=1)});const y=t.optionsContainer.querySelector(".dropdown__empty");if(f)y&&y.remove();else if(!y){const w=document.createElement("div");w.className="dropdown__empty",w.textContent="검색 결과가 없습니다.",t.optionsContainer.append(w)}return f};if(c&&t.searchInput&&!t.isComposing&&document.activeElement!==t.searchInput&&t.searchInput.value!==(i||"")&&(t.searchInput.value=i||""),c&&t.recentWrap){const v=e.id==="routeSelect"?"route":"stop",m=Ee(v);t.recentWrap.innerHTML=m.length?`
        <div class="dropdown__recent-label">최근 검색</div>
        <div class="dropdown__recent-items">
          ${m.map(f=>`<button type="button" class="dropdown__recent-chip" data-recent="${z(f)}">${z(f)}</button>`).join("")}
        </div>
      `:`
        <div class="dropdown__recent-label">최근 검색</div>
        <div class="search-recent__empty">-</div>
      `}const p=(t.isComposing,i||""),h=u(i||"",p);if(t.isComposing&&(!h||h===0)){const v=i||"",m=xe(v,a.map(f=>f.label||""),t.compositionBase);m&&u(m,t.isComposing?m:v)}const g=e.selectedIndex>=0?e.selectedIndex:0;t.label.textContent=((S=a[g])==null?void 0:S.label)||"",t.setActive(g)}function A(){try{const e=localStorage.getItem(U);return e?JSON.parse(e):[]}catch{return[]}}function j(e){localStorage.setItem(U,JSON.stringify(e))}function ie(e){const n=document.querySelector("#favoriteDockPanel"),t=document.querySelector("#favoriteDock"),o=document.querySelector("[data-favorite-tab]");if(!n)return;const c=A();if(!c.length){if(n.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,t&&t.classList.add("is-empty"),o){const i=t==null?void 0:t.classList.contains("is-open");o.classList.toggle("is-active",!!i)}return}t&&t.classList.remove("is-empty"),s.now.getHours()*60+s.now.getMinutes();const d=[],a=[];if(c.forEach(i=>{var y;const l=M.find(w=>w.id===i.routeId);if(!l)return;const u=Z(s.now,null,l);let p=Me(l,i.stopId,u);if(b(l)&&i.campusFrom&&(p=de({...l,stops:_(l,u)},i.campusFrom,i.campusTo)),!p)return;a.push(i);const h=Z(s.now,p,l),g=R(l,h,((y=p.times)==null?void 0:y[h])||[],i.campusFrom,i.campusTo),S=ae(s.now,h),v=g.length?ee(g,S-2,2):[],m=g[g.length-1],f=b(l)&&i.campusFrom?`${I(i.campusFrom)} → ${I(i.campusTo)}`:p.direction&&p.direction!==l.name?`${P(l.id,p.name)} → ${p.direction}`:`${P(l.id,p.name)}`;d.push({item:i,route:l,stop:p,label:f,upcoming:v,lastTime:m})}),a.length!==c.length&&j(a),!d.length){if(n.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,t&&t.classList.add("is-empty"),o){const i=t==null?void 0:t.classList.contains("is-open");o.classList.toggle("is-active",!!i)}return}const r=d.map((i,l)=>{const u=l===0,p=l===d.length-1;return`
      <div class="favorite-dock__item" ${[`data-jump-route="${i.route.id}"`,`data-jump-stop="${i.stop.id}"`,i.item.campusFrom?`data-jump-from="${i.item.campusFrom}"`:"",i.item.campusTo?`data-jump-to="${i.item.campusTo}"`:""].filter(Boolean).join(" ")}>
        <div class="favorite-dock__title">
          <span>${i.route.name}</span>
          <span>${i.label}</span>
        </div>
        <div class="favorite-dock__row">
          <div class="favorite-dock__times">
            ${i.upcoming.length?i.upcoming.map(g=>`
                      <span>
                        ${g}
                        ${i.lastTime&&g===i.lastTime?'<em class="last-tag">막차</em>':""}
                      </span>
                    `).join(""):'<span class="favorite-dock__empty-text">미운행</span>'}
          </div>
          <div class="favorite-dock__actions">
            <button class="favorite-dock__move" type="button" data-move-favorite="up" data-key="${i.item.key}" ${u?"disabled":""} aria-label="위로">
              ↑
            </button>
            <button class="favorite-dock__move" type="button" data-move-favorite="down" data-key="${i.item.key}" ${p?"disabled":""} aria-label="아래로">
              ↓
            </button>
            <button class="favorite-dock__remove" type="button" data-remove-favorite="${i.item.key}">
              삭제
            </button>
          </div>
        </div>
      </div>
    `});n.innerHTML=r.join("")}function x(e){const n=we(e);return be.forcedWeekends.includes(n)||Se(e)?"weekend":"weekday"}function Z(e,n,t){var p;const o=x(e),c=new Date(e);c.setDate(e.getDate()-1);const d=x(c);if(o===d)return o;const a=e.getHours()*60+e.getMinutes();if(a>=V)return o;const r=t?oe(t,d):ne(((p=n==null?void 0:n.times)==null?void 0:p[d])||[]),i=r!=null&&r>=a+1440,l=h=>{var g;return(((g=n==null?void 0:n.times)==null?void 0:g[h])||[]).length>0};let u=i?d:o;return u===d&&!l(d)&&l(o)&&(u=o),u===o&&!l(o)&&l(d)&&i&&(u=d),u}function ae(e,n){const t=e.getHours()*60+e.getMinutes(),o=x(e);return n!==o&&t<V?t+1440:t}function re(e,n){if(s.serviceOverride)return s.serviceOverride;if(!n)return x(e);const t=new Date(e);t.setDate(e.getDate()-1);const o=x(t),c=x(e);if(o===c)return c;const d=e.getHours()*60+e.getMinutes();if(d>=V)return c;const a=oe(n,o);return a==null?c:a>=d+1440?o:c}function ce(e){const n=["olev","campus-loop","wolpyeong","wolpyeong-early"];return M.sort((t,o)=>{const c=n.indexOf(t.id),d=n.indexOf(o.id),a=c===-1?Number.MAX_SAFE_INTEGER:c,r=d===-1?Number.MAX_SAFE_INTEGER:d;return a!==r?a-r:t.name.localeCompare(o.name)})}function Y(e,n){return e.find(t=>t.id===n)||e[0]}function Ne({routeId:e,stopId:n,campusFrom:t,campusTo:o}){const c=new URLSearchParams;e&&c.set("route",e),n&&c.set("stop",n),t&&c.set("from",t),o&&c.set("to",o),s.serviceOverride&&c.set("day",s.serviceOverride);const d=c.toString();return d?`./route.html?${d}`:"./route.html"}function qe(){const e=new URLSearchParams;return s.routeId&&e.set("route",s.routeId),s.stopId&&e.set("stop",s.stopId),s.campusFrom&&e.set("from",s.campusFrom),s.campusTo&&e.set("to",s.campusTo),s.serviceOverride&&e.set("day",s.serviceOverride),e.set("shared","1"),`./route.html?${e.toString()}`}function b(e){return(e==null?void 0:e.id)===$e}function I(e){var n;return((n=T.find(t=>t.id===e))==null?void 0:n.label)||e}function W(e){const n=T.find(t=>t.match.test(e));return n?n.id:null}function He(e,n){const t=W(e[n].name);for(let o=n+1;o<e.length;o+=1){const c=W(e[o].name);if(c&&c!==t)return c}return null}function de(e,n,t){const o=e.stops||[],c=o.map((r,i)=>({stop:r,index:i,campus:W(r.name)})).filter(r=>r.campus===n);if(!c.length)return o[0];const d=c.filter(r=>/출발/.test(r.stop.name)),a=d.length?d:c;if(t){const r=a.find(i=>He(o,i.index)===t);if(r)return r.stop}return a[0].stop}function R(e,n,t,o,c){return!b(e)||n!=="weekend"||o!=="main"||c!=="hwaam"?t:t.filter(d=>d.trim()!=="11:30")}function le(e,n){var d,a;const t=_(e,n);if(b(e)){let r=de({...e,stops:t},s.campusFrom,s.campusTo);return(((d=r==null?void 0:r.times)==null?void 0:d[n])||[]).length||(r=t.find(l=>{var u;return(((u=l.times)==null?void 0:u[n])||[]).length})||t[0]||e.stops[0]),r}let o=t.find(r=>r.id===s.stopId)||t.find(r=>r.default)||t[0]||e.stops[0];return(((a=o==null?void 0:o.times)==null?void 0:a[n])||[]).length||(o=t.find(r=>{var i;return(((i=r.times)==null?void 0:i[n])||[]).length})||t[0]||e.stops[0]),o}function ue(e){const n=document.querySelector("[data-route-title]"),t=document.querySelector("[data-route-subtitle]"),o=document.querySelector("[data-route-badge]"),c=document.querySelector("[data-weekday]"),d=document.querySelector("#shareNotice");if(n&&(n.textContent=e.name),t&&(t.textContent=b(e)?`${I(s.campusFrom)} → ${I(s.campusTo)}`:e.subtitle||""),d&&(d.textContent=s.sharedFromLink?"공유된 링크로 열림":"",d.style.display=d.textContent?"":"none"),o){const a=e.stops.some(r=>{var i;return(((i=r.times)==null?void 0:i.weekend)||[]).length});o.textContent=a?"매일 운영":"평일 운영",o.classList.toggle("is-daily",a),o.classList.toggle("is-weekday",!a)}if(c){const a=x(s.now)==="weekday"?"평일":"휴일";c.textContent=`${Le(s.now)} (${a}) ·`}}function G(){const e=document.querySelector("[data-clock]"),n=document.querySelector("[data-date]");if(!e||!n)return;e.textContent=he(s.now);const t=ye(s.now);n.textContent=t.replace(/^\d{4}년\s*/,"")}function Re(){try{return localStorage.getItem(te)}catch{return null}}function Oe(e){try{localStorage.setItem(te,e)}catch{}}function K(e){const n=Re();let t=!0;if(n==="dark")t=!1;else if(n==="light")t=!0;else{const c=e.getHours();t=c>=6&&c<18}document.body.classList.toggle("theme-night",!t),document.documentElement.classList.toggle("theme-night",!t);const o=document.querySelector('meta[name="theme-color"]');o&&o.setAttribute("content",t?"#e9ecff":"#05070f"),t?(document.documentElement.style.removeProperty("--night-sky"),document.documentElement.style.removeProperty("--app-bg")):Pe()}function Pe(){!L&&window.__nightSkyCss&&(L=window.__nightSkyCss);let e=null;try{e=JSON.parse(localStorage.getItem(q)||sessionStorage.getItem(q)||"null")}catch{e=null}const n=Date.now(),t=!e||e.version!==J||!e.createdAt||n-e.createdAt>Te;if(!L&&!t)try{L=localStorage.getItem(N)||sessionStorage.getItem(N)}catch{L=null}if(!L||t){L=Be();try{const o=JSON.stringify({version:J,createdAt:n});localStorage.setItem(N,L),localStorage.setItem(q,o),sessionStorage.setItem(N,L),sessionStorage.setItem(q,o)}catch{}}window.__nightSkyCss=L,document.documentElement.style.setProperty("--night-sky",L),document.documentElement.style.setProperty("--app-bg",L)}function Be(){const e=[],t=typeof window<"u"?window.innerWidth:1200,o=typeof window<"u"?window.innerHeight:800;for(let c=0;c<28;c+=1){const d=Math.floor(Math.random()*t),a=Math.floor(Math.random()*o),r=(Math.random()*1.8+.6).toFixed(2),i=(Math.random()*.5+.35).toFixed(2),u=Math.random()<.25?`rgba(255, 238, 180, ${i})`:`rgba(255, 255, 255, ${i})`;e.push(`radial-gradient(circle at ${d}px ${a}px, ${u} 0 ${r}px, transparent ${(Number(r)+1.6).toFixed(2)}px)`)}if(Math.random()<De){const c=Math.floor(Math.random()*t),d=Math.floor(Math.random()*(o*.6));e.push(`radial-gradient(circle at ${c}px ${d}px, rgba(255, 244, 190, 0.6) 0 6px, transparent 12px)`)}return e.push("linear-gradient(180deg, #05070f 0%, #0b1026 55%, #141b3f 100%)"),e.join(", ")}function je(){const e=()=>Math.random()<.7?Math.random()<.5?-15+Math.random()*20:95+Math.random()*20:15+Math.random()*70,n=(c,d)=>{const a=Math.round(e()),r=Math.round(e()),i=Math.floor(420+Math.random()*420),l=Math.floor(320+Math.random()*360),u=(d+Math.random()*.06).toFixed(2);return`radial-gradient(${i}px ${l}px at ${a}% ${r}%, rgba(${c}, ${u}), transparent 72%)`},t=["246, 226, 138","255, 181, 201","171, 228, 255","160, 255, 224","198, 176, 255","255, 214, 165"],o=[];for(let c=0;c<10;c+=1){const d=t[c%t.length];o.push(n(d,.045))}return o}function We(){if(!document.body.classList.contains("theme-night"))return;const e=document.querySelectorAll(".hero-card, .next-card, .notice-card, .route-card, .time-table");let n={};try{n=JSON.parse(sessionStorage.getItem(Q)||"{}")}catch{n={}}const t=c=>c.classList.contains("hero-card")?"hero":c.classList.contains("next-card")?"next":c.classList.contains("notice-card")?"notice":c.classList.contains("route-card")?"route":c.classList.contains("time-table")?"table":"card",o=location.pathname.replace(/\W+/g,"")||"route";e.forEach((c,d)=>{const a=t(c),r=`${o}:${a}:${d}`;n[r]||(n[r]=je());const[i,l,u]=n[r];c.style.setProperty("--card-glow-1",i),c.style.setProperty("--card-glow-2",l),c.style.setProperty("--card-glow-3",u)});try{sessionStorage.setItem(Q,JSON.stringify(n))}catch{}}function Ge(e,n){const t=document.querySelector("#routeSelect"),o=document.querySelector("#stopSelect"),c=document.querySelector("#stopSelectLabel"),d=document.querySelector("#stopSelectRow"),a=document.querySelector("#routeSearch"),r=document.querySelector("#stopSearch"),i=document.querySelector("#campusSelector");if(!t||!o)return;t.innerHTML=e.map(u=>`<option value="${u.id}">${u.name}${u.subtitle?` ${u.subtitle}`:""}</option>`).join(""),t.value=n.id;const l=b(n);if(t.disabled=!1,t.classList.remove("route-select--static"),l)o.innerHTML="";else{const u=_(n,s.serviceDay);o.innerHTML=u.map(p=>`<option value="${p.id}">${p.name}</option>`).join("")}if(l)o.disabled=!0;else{const u=_(n,s.serviceDay),p=u.find(h=>h.default)||u[0];s.stopId=u.some(h=>h.id===s.stopId)?s.stopId:p==null?void 0:p.id,o.value=s.stopId,o.disabled=u.length<=1}o.classList.toggle("is-hidden",l),o.style.display=l?"none":"inline-flex",o.hidden=l,o.setAttribute("aria-hidden",l?"true":"false"),o.tabIndex=l?-1:0,c&&(c.classList.toggle("is-hidden",l),c.hidden=l,c.style.display=l?"none":"inline-flex"),d&&(d.classList.toggle("is-hidden",l),d.hidden=l,d.style.display=l?"none":"flex"),i&&(i.style.display=l?"flex":"none"),E(t),E(o),t.onchange=u=>{s.routeId=u.target.value,s.stopId="",k()},o.onchange=u=>{s.stopId=u.target.value,k()},a&&(a.dataset.bound||(a.dataset.bound="true",a.addEventListener("input",()=>{s.routeSearch=a.value,E(t)})),a.value!==s.routeSearch&&(a.value=s.routeSearch)),r&&(r.dataset.bound||(r.dataset.bound="true",r.addEventListener("input",()=>{s.stopSearch=r.value,E(o)})),r.value!==s.stopSearch&&(r.value=s.stopSearch))}function Ke(e){const n=document.querySelector("#campusSelector");if(!n||!b(e))return;const t=n.querySelector("[data-campus-role='from']"),o=n.querySelector("[data-campus-role='to']"),c=n.querySelector("#campusSwap"),d=(i,l)=>{if(i!==l)return{fromId:i,toId:l};const u=T.find(p=>p.id!==i);return{fromId:i,toId:u?u.id:l}},a=i=>{const l=d(i,s.campusTo);s.campusFrom=l.fromId,s.campusTo=l.toId,k()},r=i=>{const l=d(s.campusFrom,i);s.campusFrom=l.fromId,s.campusTo=l.toId,k()};t&&(t.innerHTML=T.map(i=>`
        <button class="campus-pill ${i.id===s.campusFrom?"is-active":""}" data-campus-from="${i.id}">
          ${i.label}
        </button>
      `).join(""),t.querySelectorAll("[data-campus-from]").forEach(i=>{i.addEventListener("click",()=>a(i.dataset.campusFrom))})),o&&(o.innerHTML=T.map(i=>`
        <button class="campus-pill ${i.id===s.campusTo?"is-active":""} ${i.id===s.campusFrom?"is-disabled":""}" data-campus-to="${i.id}" ${i.id===s.campusFrom?"disabled":""}>
          ${i.label}
        </button>
      `).join(""),o.querySelectorAll("[data-campus-to]").forEach(i=>{i.addEventListener("click",()=>r(i.dataset.campusTo))})),c&&(c.onclick=()=>{const i=s.campusTo,l=s.campusFrom;s.campusFrom=i,s.campusTo=l,k()})}function Ue(e){const n=document.querySelector("#stopPills"),t=document.querySelector("#stopPillsToggle");if(!n)return;const o=n.closest("section");if(b(e)){o&&(o.style.display="none");return}if(e.stops.length<=1){o&&(o.style.display="none");return}o&&(o.style.display="block");const c=_(e,s.serviceDay);n.innerHTML=c.map(a=>`
      <button class="stop-pill ${a.id===s.stopId?"is-active":""}" data-stop="${a.id}">
        ${P(e.id,a.name)}
      </button>
    `).join("");const d=()=>{if(!t)return;const a=n.scrollHeight>n.clientHeight+4;t.style.display=a||s.stopPillsExpanded?"inline-flex":"none",t.innerHTML="",t.classList.toggle("is-open",s.stopPillsExpanded)};n.classList.toggle("is-collapsed",!s.stopPillsExpanded),n.querySelectorAll("[data-stop]").forEach(a=>{a.addEventListener("click",()=>{s.stopId=a.dataset.stop,k()})}),t&&(t.onclick=()=>{s.stopPillsExpanded=!s.stopPillsExpanded,n.classList.toggle("is-collapsed",!s.stopPillsExpanded),d()}),requestAnimationFrame(d)}function Ve(e,n){var l;const t=document.querySelector("#nextPanel");if(!t)return;if(s.serviceOverride){t.style.display="";const p=b(e)?`${I(s.campusFrom)} → ${I(s.campusTo)}`:`${n.name} 기준`;t.innerHTML=`
      <div class="next-header">
        <div>
          <h3>${e.name}</h3>
          <p>${p}</p>
        </div>
        <span class="next-badge">가까운 예정</span>
      </div>
      <div class="next-list">
        <div class="next-empty-inline">오늘 기준에서만 가까운 예정이 표시됩니다.</div>
      </div>
    `;return}const o=ae(s.now,s.serviceDay),c=R(e,s.serviceDay,((l=n.times)==null?void 0:l[s.serviceDay])||[],s.campusFrom,s.campusTo);if(c.length===0){t.style.display="none";return}t.style.display="";const d=c[c.length-1],a=ee(c,o-2,5),i=b(e)?`${I(s.campusFrom)} → ${I(s.campusTo)}`:`${n.name} 기준`;t.innerHTML=`
    <div class="next-header">
      <div>
        <h3>${e.name}</h3>
        <p>${i}</p>
      </div>
      <span class="next-badge">가까운 예정</span>
    </div>
    <div class="next-list">
      ${a.map(u=>`
          <div class="next-chip">
            ${u}
            ${d&&u===d?'<span class="last-tag">막차</span>':""}
          </div>
        `).join("")}
    </div>
    <p class="next-note">실시간 위치 아님 · 실제 운행과 차이 가능</p>
  `}function Ye(e,n){var a;const t=document.querySelector("#timeTable"),o=document.querySelector("#timeTableSection");if(!t)return;const c=R(e,s.serviceDay,((a=n.times)==null?void 0:a[s.serviceDay])||[],s.campusFrom,s.campusTo).slice().sort((r,i)=>B(r)-B(i)),d=c[c.length-1];if(c.length===0){t.innerHTML=`
      <div class="time-empty">
        선택한 운행일에는 시간표가 없습니다.
      </div>
    `,o&&(o.style.display="");return}o&&(o.style.display=""),t.innerHTML=c.map(r=>`
      <div class="time-row ${d&&r===d?"last-run":""}">
        <span>${r}</span>
        <span class="time-label">${d&&r===d?"막차":"예정"}</span>
      </div>
    `).join("")}function ze(e,n){var i;const t=document.querySelector("#routeNote");if(!t)return;const c=R(e,s.serviceDay,((i=n==null?void 0:n.times)==null?void 0:i[s.serviceDay])||[],s.campusFrom,s.campusTo).length===0?"선택한 운행일에는 운행하지 않습니다.":"",d=b(e)&&s.serviceDay==="weekend"&&s.campusFrom==="main"&&s.campusTo==="hwaam"?`주말에는 기사님께 요청하시면 화암관을 경유합니다.

단, 본교출발 11:30회차는 기사님 점심시간 확보를 위해 요청이 불가합니다.`:"",a=e.note||"",r=[c,d,a].filter(Boolean).join(`
`).trim();t.textContent=r,t.style.display=r?"":"none"}function Je(e,n){var u;const t=document.querySelector("#favoriteToggleRoute"),o=document.querySelector("#favoriteHelp");if(!t)return;const c=A(),d=b(e)?`${e.id}:${s.campusFrom}->${s.campusTo}`:`${e.id}:${s.stopId||n.id}`,r=(((u=n==null?void 0:n.times)==null?void 0:u[s.serviceDay])||[]).length===0,i=c.some(p=>p.key===d);t.textContent=i?"즐겨찾기 해제":"즐겨찾기 추가";const l=r&&!i;t.disabled=!1,t.classList.toggle("is-disabled",l),t.setAttribute("aria-disabled",l?"true":"false"),t.setAttribute("data-disabled",l?"true":"false"),o&&(r&&!i?(o.textContent="선택한 운행일에는 운행하지 않아 즐겨찾기를 추가할 수 없어요.",s.favoriteHelpVisible?(o.classList.add("is-visible"),o.setAttribute("aria-hidden","false")):(o.classList.remove("is-visible"),o.setAttribute("aria-hidden","true"))):(o.textContent="",o.classList.remove("is-visible"),o.setAttribute("aria-hidden","true")))}function k(){var o;s.now=new Date;const e=ce(x(s.now)),n=Y(e,s.routeId||((o=e[0])==null?void 0:o.id));if(!n)return;s.routeId=n.id,s.serviceDay=re(s.now,n);const t=le(n,s.serviceDay);ue(n),G(),K(s.now),Ge(e,n),Ke(n),Ve(n,t),Ye(n,t),ze(n,t),Ue(n),Je(n,t),ie(),We()}function Qe(){const e=document.querySelector("#serviceDayToggle");if(!e)return;const n=()=>{const t=x(s.now),o=s.serviceOverride||t;e.querySelectorAll("button[data-day]").forEach(c=>{const d=c.dataset.day,r=d==="auto"?!s.serviceOverride:d===o;c.classList.toggle("is-active",r)})};e.addEventListener("click",t=>{const o=t.target.closest("button[data-day]");if(!o)return;const c=o.dataset.day,d=x(s.now);c==="auto"?s.serviceOverride=null:s.serviceOverride=c===d?null:c,n(),k()}),n()}function Xe(){const e=document.querySelector("#favoriteToggleRoute"),n=document.querySelector("#favoriteHelp");if(!e)return;const t=()=>{n&&e.getAttribute("data-disabled")==="true"&&n.textContent.trim()&&(s.favoriteHelpVisible=!0,n.classList.add("is-visible"),n.setAttribute("aria-hidden","false"),n.classList.remove("is-flipped"),requestAnimationFrame(()=>{const c=n.getBoundingClientRect(),d=c.right>window.innerWidth-12,a=c.left<12;d&&!a&&n.classList.add("is-flipped")}))},o=()=>{n&&e.getAttribute("data-disabled")==="true"&&(s.favoriteHelpVisible=!1,n.classList.remove("is-visible"),n.setAttribute("aria-hidden","true"))};e.addEventListener("mouseenter",t),e.addEventListener("focus",t),e.addEventListener("mouseleave",o),e.addEventListener("blur",o),e.addEventListener("click",()=>{if(e.getAttribute("data-disabled")==="true"){s.favoriteHelpVisible?o():t();return}const c=A(),d=M.find(l=>l.id===s.routeId),a=d?le(d,s.serviceDay):null,r=d&&b(d)?`${d.id}:${s.campusFrom}->${s.campusTo}`:`${s.routeId}:${s.stopId}`,i=c.some(l=>l.key===r)?c.filter(l=>l.key!==r):[{key:r,routeId:s.routeId,stopId:(a==null?void 0:a.id)||s.stopId,campusFrom:d&&b(d)?s.campusFrom:void 0,campusTo:d&&b(d)?s.campusTo:void 0,savedAt:Date.now()},...c];localStorage.setItem(U,JSON.stringify(i.slice(0,10))),k()})}function Ze(){const e=document.querySelector("#shareLink");e&&e.addEventListener("click",async()=>{const n=new URL(qe(),window.location.origin).toString();try{await navigator.clipboard.writeText(n),e.textContent="복사됨!",window.setTimeout(()=>{e.textContent="링크 공유"},1200)}catch{window.prompt("링크를 복사해 주세요.",n)}})}function et(){const e=document.querySelector("[data-theme-toggle]");e&&(e.addEventListener("click",()=>{const n=document.body.classList.contains("theme-night");Oe(n?"light":"dark"),K(new Date)}),K(new Date))}function tt(){const e=document.querySelector("#favoriteDock"),n=document.querySelector("[data-favorite-tab]"),t=document.querySelector("#favoriteDockPanel");if(!e||!n)return;let o=!1;const c=()=>{n.classList.toggle("is-active",e.classList.contains("is-open"))},d=()=>{e.classList.add("is-open"),c(),r()},a=()=>{o||(e.classList.remove("is-open"),c())};e.addEventListener("mouseenter",()=>d()),e.addEventListener("mouseleave",()=>a()),n.addEventListener("mouseenter",()=>d()),n.addEventListener("mouseleave",()=>a()),e.addEventListener("click",()=>{o=!o,o?e.classList.add("is-open"):e.classList.remove("is-open"),c()}),n.addEventListener("click",()=>{o=!o,o?e.classList.add("is-open"):e.classList.remove("is-open"),c()});const r=()=>{if(!window.matchMedia("(max-width: 640px)").matches||!e.classList.contains("is-open"))return;const l=n.getBoundingClientRect();e.style.top=`${Math.round(l.bottom+8)}px`};document.addEventListener("click",i=>{e.classList.contains("is-open")&&(e.contains(i.target)||n.contains(i.target)||(o=!1,e.classList.remove("is-open"),c()))}),t&&(t.addEventListener("click",i=>{i.stopPropagation();const l=i.target.closest("[data-move-favorite]");if(l){const g=l.dataset.key,S=l.dataset.moveFavorite;if(!g||!S)return;const v=A(),m=v.findIndex(w=>w.key===g),f=S==="up"?m-1:m+1;if(m<0||f<0||f>=v.length)return;const y=v.slice();[y[m],y[f]]=[y[f],y[m]],j(y),ie(Y(M,s.routeId));return}const u=i.target.closest("[data-remove-favorite]");if(!u)return;const p=u.dataset.removeFavorite;if(!p)return;const h=A().filter(g=>g.key!==p);j(h),k()}),t.addEventListener("click",i=>{if(i.target.closest("[data-remove-favorite]")||i.target.closest("[data-move-favorite]"))return;const p=i.target.closest("[data-jump-route]");if(!p)return;const h=Ne({routeId:p.dataset.jumpRoute,stopId:p.dataset.jumpStop,campusFrom:p.dataset.jumpFrom,campusTo:p.dataset.jumpTo});window.location.href=h})),c(),window.addEventListener("scroll",r,{passive:!0}),window.addEventListener("resize",r),n.addEventListener("click",r),e.addEventListener("mouseenter",r)}function H(){const e=document.querySelector("header.navbar"),n=e==null?void 0:e.querySelector(".brand"),t=e==null?void 0:e.querySelector(".primary-nav"),o=t==null?void 0:t.querySelector(".nav-links"),c=t==null?void 0:t.querySelector(".nav-actions");if(!e||!n||!t||(e.classList.contains("is-wrapped")&&e.classList.remove("is-wrapped"),!o||!c))return;const a=Array.from(o.children).some(C=>C.scrollHeight>C.clientHeight+2),r=Array.from(c.children).some(C=>C.scrollHeight>C.clientHeight+2),i=parseFloat(getComputedStyle(e).gap||"0")||0,l=parseFloat(getComputedStyle(t).gap||"0")||0,u=C=>{const O=Array.from(C.children);if(!O.length)return 0;const me=parseFloat(getComputedStyle(C).gap||"0")||0;return O.reduce((fe,ve)=>fe+ve.getBoundingClientRect().width,0)+me*(O.length-1)},p=u(o)+u(c)+l,h=e.clientWidth-n.getBoundingClientRect().width-i,g=o.getBoundingClientRect(),S=c.getBoundingClientRect(),v=t.getBoundingClientRect(),m=e.getBoundingClientRect(),f=n.getBoundingClientRect(),y=g.right>S.left-8,w=v.left<f.right+8,D=v.right>m.right-8,F=p>h-_e,pe=a||r||y||w||D||F;e.classList.toggle("is-wrapped",pe)}function nt(){var e;H(),window.addEventListener("resize",H),window.addEventListener("load",H),(e=document.fonts)!=null&&e.ready&&document.fonts.ready.then(H)}function ot(){let e;window.addEventListener("resize",()=>{e&&window.clearTimeout(e),e=window.setTimeout(()=>{s.dropdownOpen&&se(),k()},120)})}function st(){var n;const e=(n=window.getSelection)==null?void 0:n.call(window);return e?!e.isCollapsed&&e.toString().trim().length>0:!1}(()=>{const e=new URLSearchParams(window.location.search),n=e.get("route"),t=e.get("stop"),o=e.get("from"),c=e.get("to"),d=e.get("day"),a=e.get("shared");if(n&&M.some(r=>r.id===n)&&(s.routeId=n),t&&(s.stopId=t),(d==="weekday"||d==="weekend")&&(s.serviceOverride=d),a==="1"&&(s.sharedFromLink=!0),o&&T.some(r=>r.id===o)&&(s.campusFrom=o),c&&T.some(r=>r.id===c)&&(s.campusTo=c),s.campusFrom===s.campusTo){const r=T.find(i=>i.id!==s.campusFrom);r&&(s.campusTo=r.id)}})();k();Xe();et();tt();Qe();Ze();nt();ot();setInterval(()=>{var e;if(s.dropdownOpen){s.now=new Date,G();const n=ce(x(s.now)),t=Y(n,s.routeId||((e=n[0])==null?void 0:e.id));t&&(s.serviceDay=re(s.now,t),ue(t));return}if(st()){s.now=new Date,G();return}k()},1e3);
