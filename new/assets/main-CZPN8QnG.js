import{t as z,h as K,i as lt,r as ut,f as mt,a as pt,b as ft,g as X,c as T}from"./stopLabels-BHifznrE.js";const gt=[{id:"notice-2026-02-01",title:"2월 1일 설 연휴 운행 안내",body:"해당일은 휴일 시간표로 운행됩니다. 출발 전 꼭 시간표를 확인해 주세요.",startDate:"2026-01-28",endDate:"2026-02-02",tag:"휴일"},{id:"notice-2026-02-25",title:"2월 25일 특별휴일 운행",body:"특별 휴일 시간표가 적용됩니다.",startDate:"2026-02-24",endDate:"2026-02-26",tag:"공지"}],ht=[{id:"wolpyeong",name:"월평-본교-시내 순환셔틀",stops:[{routeId:"wolpyeong",stopId:"stop-1"}]},{id:"wolpyeong-early",name:"월평-유성온천역-본교 (얼리월평 셔틀)",stops:[{routeId:"wolpyeong-early",stopId:"stop-1"}]},{id:"campus-loop",name:"본교-문지-화암 왕복셔틀",stops:[{routeId:"campus-loop",stopId:"stop-2"}]},{id:"olev",name:"OLEV 교내셔틀",stops:[{routeId:"olev",stopId:"stop-1"}]}],yt={destinations:ht},Q="kaist-bus-favorites",Z="kaist-bus-theme",M="kaist-bus-night-sky",E="kaist-bus-night-sky-meta",Y="v2",vt=24*60*60*1e3,wt=1/7,J="kaist-bus-card-glow";let w=null;const St="campus-loop",kt=12,G=4*60,tt=[{id:"main",label:"본교",match:/본교/},{id:"munji",label:"문지",match:/문지/},{id:"hwaam",label:"화암",match:/화암/}];function bt(t){const n=new Map;return t.forEach(e=>{if(!n.has(e.id)){n.set(e.id,{...e,stops:e.stops.map(a=>{var r,c;return{...a,times:{weekday:[...((r=a.times)==null?void 0:r.weekday)||[]],weekend:[...((c=a.times)==null?void 0:c.weekend)||[]]}}})});return}const o=n.get(e.id);!o.note&&e.note&&(o.note=e.note);const s=new Map(o.stops.map(a=>[a.name,a]));e.stops.forEach(a=>{var c,d;const r=s.get(a.name);if(!r){const u={...a,times:{weekday:[...((c=a.times)==null?void 0:c.weekday)||[]],weekend:[...((d=a.times)==null?void 0:d.weekend)||[]]}};o.stops.push(u),s.set(a.name,u);return}["weekday","weekend"].forEach(u=>{var g,m;const i=((g=r.times)==null?void 0:g[u])||[],l=((m=a.times)==null?void 0:m[u])||[];if(!i.length&&l.length){r.times[u]=[...l];return}l.forEach(f=>{i.includes(f)||i.push(f)})})})}),Array.from(n.values())}const x=bt(ut.routes);function et(t,n){const e=t.stops.filter(o=>{var s;return(((s=o.times)==null?void 0:s[n])||[]).length});return e.length?e:t.stops}function nt(t,n,e){const o=t.stops.filter(a=>a.id===n);return o.length?o.find(a=>{var r;return(((r=a.times)==null?void 0:r[e])||[]).length})||o[0]:null}function Lt(t){const[n,e]=t.split(":").map(Number);if(Number.isNaN(n)||Number.isNaN(e))return 0;let o=n*60+e;return n<4&&(o+=1440),o}function ot(t){return!t||t.length===0?null:Math.max(...t.map(Lt))}function $t(t,n){if(!t)return null;const e=t.stops.flatMap(o=>{var s;return((s=o.times)==null?void 0:s[n])||[]});return ot(e)}function _(t,n,e){var l;const o=R(t),s=new Date(t);s.setDate(t.getDate()-1);const a=R(s);if(o===a)return o;const r=t.getHours()*60+t.getMinutes();if(r>=G)return o;const c=e?$t(e,a):ot(((l=n==null?void 0:n.times)==null?void 0:l[a])||[]),d=c!=null&&c>=r+1440,u=g=>{var m;return(((m=n==null?void 0:n.times)==null?void 0:m[g])||[]).length>0};let i=d?a:o;return i===a&&!u(a)&&u(o)&&(i=o),i===o&&!u(o)&&u(a)&&d&&(i=a),i}const p={now:new Date,serviceDay:"weekday",holidayLabel:"",selectedRouteId:"",selectedStopId:"",selectedDestinationId:""};function L(){try{const t=localStorage.getItem(Q);return t?JSON.parse(t):[]}catch{return[]}}function $(t){return(t==null?void 0:t.id)===St}function C(t){var n;return((n=tt.find(e=>e.id===t))==null?void 0:n.label)||t}function A(t){const n=tt.find(e=>e.match.test(t));return n?n.id:null}function xt(t,n){const e=A(t[n].name);for(let o=n+1;o<t.length;o+=1){const s=A(t[o].name);if(s&&s!==e)return s}return null}function st(t,n,e){const o=t.stops||[],s=o.map((c,d)=>({stop:c,index:d,campus:A(c.name)})).filter(c=>c.campus===n);if(!s.length)return o[0];const a=s.filter(c=>/출발/.test(c.stop.name)),r=a.length?a:s;if(e){const c=r.find(d=>xt(o,d.index)===e);if(c)return c.stop}return r[0].stop}function at(t,n,e,o,s){return!$(t)||n!=="weekend"||o!=="main"||s!=="hwaam"?e:e.filter(a=>a.trim()!=="11:30")}function q(t){localStorage.setItem(Q,JSON.stringify(t))}function W(t){var e;const n=z(t);return K.forcedWeekends.includes(n)?{day:"weekend",label:((e=K.labels)==null?void 0:e[n])||"휴일"}:lt(t)?{day:"weekend",label:"주말"}:{day:"weekday",label:"평일"}}function R(t){return W(t).day}function Dt(){try{return localStorage.getItem(Z)}catch{return null}}function Mt(t){try{localStorage.setItem(Z,t)}catch{}}function B(t){const n=Dt();let e=!0;if(n==="dark")e=!1;else if(n==="light")e=!0;else{const s=t.getHours();e=s>=6&&s<18}document.body.classList.toggle("theme-night",!e),document.documentElement.classList.toggle("theme-night",!e);const o=document.querySelector('meta[name="theme-color"]');o&&o.setAttribute("content",e?"#e9ecff":"#05070f"),e?(document.documentElement.style.removeProperty("--night-sky"),document.documentElement.style.removeProperty("--app-bg")):Et()}function Et(){!w&&window.__nightSkyCss&&(w=window.__nightSkyCss);let t=null;try{t=JSON.parse(localStorage.getItem(E)||sessionStorage.getItem(E)||"null")}catch{t=null}const n=Date.now(),e=!t||t.version!==Y||!t.createdAt||n-t.createdAt>vt;if(!w&&!e)try{w=localStorage.getItem(M)||sessionStorage.getItem(M)}catch{w=null}if(!w||e){w=It();try{const o=JSON.stringify({version:Y,createdAt:n});localStorage.setItem(M,w),localStorage.setItem(E,o),sessionStorage.setItem(M,w),sessionStorage.setItem(E,o)}catch{}}window.__nightSkyCss=w,document.documentElement.style.setProperty("--night-sky",w),document.documentElement.style.setProperty("--app-bg",w)}function It(){const t=[],e=typeof window<"u"?window.innerWidth:1200,o=typeof window<"u"?window.innerHeight:800;for(let s=0;s<28;s+=1){const a=Math.floor(Math.random()*e),r=Math.floor(Math.random()*o),c=(Math.random()*1.8+.6).toFixed(2),d=(Math.random()*.5+.35).toFixed(2),i=Math.random()<.25?`rgba(255, 238, 180, ${d})`:`rgba(255, 255, 255, ${d})`;t.push(`radial-gradient(circle at ${a}px ${r}px, ${i} 0 ${c}px, transparent ${(Number(c)+1.6).toFixed(2)}px)`)}if(Math.random()<wt){const s=Math.floor(Math.random()*e),a=Math.floor(Math.random()*(o*.6));t.push(`radial-gradient(circle at ${s}px ${a}px, rgba(255, 244, 190, 0.6) 0 6px, transparent 12px)`)}return t.push("linear-gradient(180deg, #05070f 0%, #0b1026 55%, #141b3f 100%)"),t.join(", ")}function Tt(){const t=()=>Math.random()<.7?Math.random()<.5?-15+Math.random()*20:95+Math.random()*20:15+Math.random()*70,n=(s,a)=>{const r=Math.round(t()),c=Math.round(t()),d=Math.floor(420+Math.random()*420),u=Math.floor(320+Math.random()*360),i=(a+Math.random()*.06).toFixed(2);return`radial-gradient(${d}px ${u}px at ${r}% ${c}%, rgba(${s}, ${i}), transparent 72%)`},e=["246, 226, 138","255, 181, 201","171, 228, 255","160, 255, 224","198, 176, 255","255, 214, 165"],o=[];for(let s=0;s<10;s+=1){const a=e[s%e.length];o.push(n(a,.045))}return o}function H(){if(!document.body.classList.contains("theme-night"))return;const t=document.querySelectorAll(".hero-card, .next-card, .notice-card, .route-card, .time-table");let n={};try{n=JSON.parse(sessionStorage.getItem(J)||"{}")}catch{n={}}const e=s=>s.classList.contains("hero-card")?"hero":s.classList.contains("next-card")?"next":s.classList.contains("notice-card")?"notice":s.classList.contains("route-card")?"route":s.classList.contains("time-table")?"table":"card",o=location.pathname.replace(/\W+/g,"")||"index";t.forEach((s,a)=>{const r=e(s),c=`${o}:${r}:${a}`;n[c]||(n[c]=Tt());const[d,u,i]=n[c];s.style.setProperty("--card-glow-1",d),s.style.setProperty("--card-glow-2",u),s.style.setProperty("--card-glow-3",i)});try{sessionStorage.setItem(J,JSON.stringify(n))}catch{}}function O(t){const n=["olev","campus-loop","wolpyeong","wolpyeong-early"];return x.filter(e=>e.stops.some(o=>{var s,a;return(a=(s=o.times)==null?void 0:s[t])==null?void 0:a.length})).slice().sort((e,o)=>{const s=n.indexOf(e.id),a=n.indexOf(o.id),r=s===-1?Number.MAX_SAFE_INTEGER:s,c=a===-1?Number.MAX_SAFE_INTEGER:a;return r!==c?r-c:e.name.localeCompare(o.name)})}function _t(){return["olev","campus-loop","wolpyeong","wolpyeong-early"].map(n=>x.find(e=>e.id===n)).filter(Boolean)}function P({routeId:t,stopId:n,campusFrom:e,campusTo:o}){const s=new URLSearchParams;t&&s.set("route",t),n&&s.set("stop",n),e&&s.set("from",e),o&&s.set("to",o);const a=s.toString();return a?`./route.html?${a}`:"./route.html"}function Ct(t){return t.find(n=>n.stops.some(e=>e.default))||t[0]}function V(){const t=document.querySelectorAll("[data-clock]"),n=document.querySelectorAll("[data-date]"),e=document.querySelectorAll("[data-weekday]"),o=document.querySelectorAll("[data-clock-card]"),s=document.querySelectorAll("[data-date-card]"),a=document.querySelectorAll("[data-weekday-card]"),r=document.querySelector("[data-weekday-badge]");if(!t.length||!n.length||!e.length)return;p.now=new Date;const c=mt(p.now);t.forEach(f=>{f.textContent=c}),o.forEach(f=>{f.textContent=c});const u=pt(p.now).replace(/^\d{4}년\s*/,"");n.forEach(f=>{f.textContent=u}),s.forEach(f=>{f.textContent=u});const{day:i,label:l}=W(p.now);p.serviceDay=i,p.holidayLabel=l;const g=i==="weekday"?"평일":"휴일",m=ft(p.now);e.forEach(f=>{f.textContent=`${m} (${g}) ·`}),a.forEach(f=>{f.textContent=m}),r&&(r.textContent=g),B(p.now)}function Rt(){const t=document.querySelector("#noticeList");if(!t)return;const n=z(p.now),e=gt.filter(o=>(!o.startDate||o.startDate<=n)&&(!o.endDate||o.endDate>=n));t.innerHTML=e.length?e.map(o=>`
          <article class="notice-card">
            <div class="notice-tag">${o.tag||"공지"}</div>
            <h3>${o.title}</h3>
            <p>${o.body}</p>
            <span class="notice-date">${o.startDate||""}</span>
          </article>
        `).join(""):`
        <div class="notice-empty">
          현재 등록된 공지가 없습니다.
        </div>
      `}function Ft(t){const n=document.querySelector("#routeList");n&&(n.innerHTML=t.map(e=>`
      <a class="route-card" href="./route.html?route=${e.id}">
        <div>
          <h3>${e.name}</h3>
          <p>${e.subtitle||""}</p>
        </div>
        <div class="route-tags">
          ${(e.tags||[]).map(o=>`<span>${o}</span>`).join("")}
        </div>
      </a>
    `).join(""))}function F(t){const n=document.querySelector("#favoritesList");n&&(n.innerHTML="");const e=document.querySelector("#favoriteDockPanel"),o=document.querySelector("#favoriteDock"),s=document.querySelector("[data-favorite-tab]");if(!e)return;let a=L();if(!a.length){if(e.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,e.setAttribute("aria-live","polite"),o&&o.classList.add("is-empty"),s){const i=o==null?void 0:o.classList.contains("is-open");s.classList.toggle("is-active",!!i)}return}o&&o.classList.remove("is-empty"),e.style.display="";const r=p.now.getHours()*60+p.now.getMinutes(),c=[],d=[];if(a.forEach(i=>{var D;const l=x.find(N=>N.id===i.routeId);if(!l)return;const g=_(p.now,null,l);let m=nt(l,i.stopId,g);if($(l)&&i.campusFrom&&(m=st({...l,stops:et(l,g)},i.campusFrom,i.campusTo)),!m)return;c.push(i);const f=_(p.now,m,l),h=at(l,f,((D=m.times)==null?void 0:D[f])||[],i.campusFrom,i.campusTo),v=f!==R(p.now)&&r<G?r+1440:r,y=h.length?X(h,v-2,2):[],S=h[h.length-1],b=$(l)&&i.campusFrom?`${C(i.campusFrom)} → ${C(i.campusTo)}`:m.direction&&m.direction!==l.name?`${T(l.id,m.name)} → ${m.direction}`:`${T(l.id,m.name)}`;d.push({item:i,route:l,stop:m,label:b,upcoming:y,lastTime:S})}),c.length!==a.length&&(a=c,q(c)),!d.length){e.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,o&&o.classList.add("is-empty"),s&&s.classList.remove("is-active");return}const u=d.map((i,l)=>{const g=l===0,m=l===d.length-1,f=[`data-jump-route="${i.route.id}"`,`data-jump-stop="${i.stop.id}"`,i.item.campusFrom?`data-jump-from="${i.item.campusFrom}"`:"",i.item.campusTo?`data-jump-to="${i.item.campusTo}"`:""].filter(Boolean).join(" ");return`
      <div class="favorite-dock__item" data-fav="${i.item.key}" ${f}>
        <div class="favorite-dock__title">
          <span>${i.route.name}</span>
          <span>${i.label}</span>
        </div>
        <div class="favorite-dock__row">
          <div class="favorite-dock__times">
            ${i.upcoming.length?i.upcoming.map(h=>`
                      <span>
                        ${h}
                        ${i.lastTime&&h===i.lastTime?'<em class="last-tag">막차</em>':""}
                      </span>
                    `).join(""):'<span class="favorite-dock__empty-text">미운행</span>'}
          </div>
          <div class="favorite-dock__actions">
            <button class="favorite-dock__move" type="button" data-move-favorite="up" data-key="${i.item.key}" ${g?"disabled":""} aria-label="위로">
              ↑
            </button>
            <button class="favorite-dock__move" type="button" data-move-favorite="down" data-key="${i.item.key}" ${m?"disabled":""} aria-label="아래로">
              ↓
            </button>
            <button class="favorite-dock__remove" type="button" data-remove-favorite="${i.item.key}">
              삭제
            </button>
          </div>
        </div>
      </div>
    `});e.innerHTML=u.join("")}function U(t){const n=document.querySelector("#nextDepartures");if(!n)return;const e=L().slice(0,3);if(!e.length){n.innerHTML=`
      <div class="next-empty">
        즐겨찾기한 노선이 아직 없어요. 노선 상세에서 즐겨찾기를 추가하면
        여기에서 가까운 출발을 빠르게 확인할 수 있어요.
      </div>
    `,F(),H();return}const o=p.now.getHours()*60+p.now.getMinutes(),s=e.map(a=>{var v;const r=x.find(y=>y.id===a.routeId);if(!r)return"";const c=_(p.now,null,r);let d=nt(r,a.stopId,c);if($(r)&&a.campusFrom&&(d=st({...r,stops:et(r,c)},a.campusFrom,a.campusTo)),!d)return"";const u=_(p.now,d,r),i=at(r,u,((v=d.times)==null?void 0:v[u])||[],a.campusFrom,a.campusTo);if(!i.length)return"";const l=u!==R(p.now)&&o<G?o+1440:o,g=X(i,l-2,4),m=i[i.length-1],f=$(r)&&a.campusFrom?`${C(a.campusFrom)} → ${C(a.campusTo)}`:d.direction&&d.direction!==r.name?`${T(r.id,d.name)} → ${d.direction}`:`${T(r.id,d.name)}`;return`
        <div class="next-card" ${[`data-jump-route="${r.id}"`,`data-jump-stop="${d.id}"`,a.campusFrom?`data-jump-from="${a.campusFrom}"`:"",a.campusTo?`data-jump-to="${a.campusTo}"`:""].filter(Boolean).join(" ")} role="button" tabindex="0">
          <div class="next-header">
            <div>
              <h3>${r.name}</h3>
              <p>${f}</p>
            </div>
            <span class="next-badge">시간표 기준</span>
          </div>
          <div class="next-list">
            ${g.map(y=>`
                <div class="next-chip">
                  ${y}
                  ${m&&y===m?'<span class="last-tag">막차</span>':""}
                </div>
              `).join("")}
          </div>
          <p class="next-note">실시간 위치 아님 · 실제 운행과 차이 가능</p>
        </div>
      `}).filter(Boolean).join("");n.innerHTML=s||`
    <div class="next-empty">
      즐겨찾기한 노선이 아직 없어요. 노선 상세에서 즐겨찾기를 추가하면
      여기에서 가까운 출발을 빠르게 확인할 수 있어요.
    </div>
  `,n.onclick=a=>{const r=a.target.closest("[data-jump-route]");if(!r)return;const c=P({routeId:r.dataset.jumpRoute,stopId:r.dataset.jumpStop,campusFrom:r.dataset.jumpFrom,campusTo:r.dataset.jumpTo});window.location.href=c},n.onkeydown=a=>{if(a.key!=="Enter"&&a.key!==" ")return;const r=a.target.closest("[data-jump-route]");if(!r)return;a.preventDefault();const c=P({routeId:r.dataset.jumpRoute,stopId:r.dataset.jumpStop,campusFrom:r.dataset.jumpFrom,campusTo:r.dataset.jumpTo});window.location.href=c},F(),H()}function Nt(){const t=document.querySelector("[data-theme-toggle]");t&&(t.addEventListener("click",()=>{const n=document.body.classList.contains("theme-night");Mt(n?"light":"dark"),B(new Date)}),B(new Date))}function jt(){const t=document.querySelector("#favoriteDock"),n=document.querySelector("[data-favorite-tab]"),e=document.querySelector("#favoriteDockPanel");if(!t||!n)return;let o=!1;const s=()=>{n.classList.toggle("is-active",t.classList.contains("is-open"))},a=()=>{t.classList.add("is-open"),s(),c()},r=()=>{o||(t.classList.remove("is-open"),s())};t.addEventListener("mouseenter",()=>a()),t.addEventListener("mouseleave",()=>r()),n.addEventListener("mouseenter",()=>a()),n.addEventListener("mouseleave",()=>r()),t.addEventListener("click",()=>{o=!o,o?(t.classList.add("is-open"),s()):(t.classList.remove("is-open"),s())}),n.addEventListener("click",()=>{o=!o,o?(t.classList.add("is-open"),s()):(t.classList.remove("is-open"),s())});const c=()=>{if(!window.matchMedia("(max-width: 640px)").matches||!t.classList.contains("is-open"))return;const u=n.getBoundingClientRect();t.style.top=`${Math.round(u.bottom+8)}px`};document.addEventListener("click",d=>{t.classList.contains("is-open")&&(t.contains(d.target)||n.contains(d.target)||(o=!1,t.classList.remove("is-open"),s()))}),e&&(e.addEventListener("click",d=>{d.stopPropagation();const u=d.target.closest("[data-move-favorite]");if(u){const m=u.dataset.key,f=u.dataset.moveFavorite;if(!m||!f)return;const h=L(),v=h.findIndex(b=>b.key===m),y=f==="up"?v-1:v+1;if(v<0||y<0||y>=h.length)return;const S=h.slice();[S[v],S[y]]=[S[y],S[v]],q(S),F(O(p.serviceDay));return}const i=d.target.closest("[data-remove-favorite]");if(!i)return;const l=i.dataset.removeFavorite;if(!l)return;const g=L().filter(m=>m.key!==l);q(g),F(O(p.serviceDay))}),e.addEventListener("click",d=>{if(d.target.closest("[data-remove-favorite]")||d.target.closest("[data-move-favorite]"))return;const l=d.target.closest("[data-jump-route]");if(!l)return;const g=P({routeId:l.dataset.jumpRoute,stopId:l.dataset.jumpStop,campusFrom:l.dataset.jumpFrom,campusTo:l.dataset.jumpTo});window.location.href=g})),s(),window.addEventListener("scroll",c,{passive:!0}),window.addEventListener("resize",c),n.addEventListener("click",c),t.addEventListener("mouseenter",c)}function I(){const t=document.querySelector("header.navbar"),n=t==null?void 0:t.querySelector(".brand"),e=t==null?void 0:t.querySelector(".primary-nav"),o=e==null?void 0:e.querySelector(".nav-links"),s=e==null?void 0:e.querySelector(".nav-actions");if(!t||!n||!e||(t.classList.contains("is-wrapped")&&t.classList.remove("is-wrapped"),!o||!s))return;const r=Array.from(o.children).some(k=>k.scrollHeight>k.clientHeight+2),c=Array.from(s.children).some(k=>k.scrollHeight>k.clientHeight+2),d=parseFloat(getComputedStyle(t).gap||"0")||0,u=parseFloat(getComputedStyle(e).gap||"0")||0,i=k=>{const j=Array.from(k.children);if(!j.length)return 0;const it=parseFloat(getComputedStyle(k).gap||"0")||0;return j.reduce((ct,dt)=>ct+dt.getBoundingClientRect().width,0)+it*(j.length-1)},l=i(o)+i(s)+u,g=t.clientWidth-n.getBoundingClientRect().width-d,m=o.getBoundingClientRect(),f=s.getBoundingClientRect(),h=e.getBoundingClientRect(),v=t.getBoundingClientRect(),y=n.getBoundingClientRect(),S=m.right>f.left-8,b=h.left<y.right+8,D=h.right>v.right-8,N=l>g-kt,rt=r||c||S||b||D||N;t.classList.toggle("is-wrapped",rt)}function At(){var t;I(),window.addEventListener("resize",I),window.addEventListener("load",I),(t=document.fonts)!=null&&t.ready&&document.fonts.ready.then(I)}function qt(){var n;const t=(n=window.getSelection)==null?void 0:n.call(window);return t?!t.isCollapsed&&t.toString().trim().length>0:!1}function Bt(){const{day:t}=W(p.now);p.serviceDay=t;const n=O(p.serviceDay);if(n.length===0)return;const e=L();if(e.length){p.selectedRouteId=e[0].routeId,p.selectedStopId=e[0].stopId;const o=x.find(r=>r.id===p.selectedRouteId),s=o==null?void 0:o.stops.find(r=>r.id===p.selectedStopId),a=yt.destinations.find(r=>r.name===(s==null?void 0:s.direction));a&&(p.selectedDestinationId=a.id)}else p.selectedRouteId=Ct(n).id;V(),Rt(),Ft(_t()),U(),H(),Nt(),jt(),At(),setInterval(()=>{V(),qt()||U()},1e3)}Bt();
