import{r as de,t as ue,h as pe,i as me,b as fe,f as ge,a as ye,g as j,d as H,c as _}from"./stopLabels-5QDnVXaU.js";const N="kaist-bus-favorites",G="kaist-bus-theme",M="kaist-bus-night-sky",O="kaist-bus-card-glow";let m=null;const ve="campus-loop",k=[{id:"main",label:"본교",match:/본교/},{id:"munji",label:"문지",match:/문지/},{id:"hwaam",label:"화암",match:/화암/}],l={now:new Date,serviceDay:"weekday",serviceOverride:null,routeId:"",stopId:"",campusFrom:"main",campusTo:"munji",stopPillsExpanded:!1,dropdownOpen:!1},L=new Map,he=12,R=4*60;function we(e){const n=new Map;return e.forEach(t=>{if(!n.has(t.id)){n.set(t.id,{...t,stops:t.stops.map(r=>{var i,o;return{...r,times:{weekday:[...((i=r.times)==null?void 0:i.weekday)||[]],weekend:[...((o=r.times)==null?void 0:o.weekend)||[]]}}})});return}const s=n.get(t.id);!s.note&&t.note&&(s.note=t.note);const a=new Map(s.stops.map(r=>[r.name,r]));t.stops.forEach(r=>{var o,c;const i=a.get(r.name);if(!i){const d={...r,times:{weekday:[...((o=r.times)==null?void 0:o.weekday)||[]],weekend:[...((c=r.times)==null?void 0:c.weekend)||[]]}};s.stops.push(d),a.set(r.name,d);return}["weekday","weekend"].forEach(d=>{var v,h;const u=((v=i.times)==null?void 0:v[d])||[],p=((h=r.times)==null?void 0:h[d])||[];if(!u.length&&p.length){i.times[d]=[...p];return}p.forEach(b=>{u.includes(b)||u.push(b)})})})}),Array.from(n.values())}const T=we(de.routes);function be(e){const[n,t]=e.split(":").map(Number);if(Number.isNaN(n)||Number.isNaN(t))return 0;let s=n*60+t;return n<4&&(s+=1440),s}function K(e){return!e||e.length===0?null:Math.max(...e.map(be))}function z(e,n){if(!e)return null;const t=e.stops.flatMap(s=>{var a;return((a=s.times)==null?void 0:a[n])||[]});return K(t)}function E(e,n){const t=e.stops.filter(s=>{var a;return(((a=s.times)==null?void 0:a[n])||[]).length});return t.length?t:e.stops}function Se(e,n,t){const s=e.stops.filter(r=>r.id===n);return s.length?s.find(r=>{var i;return(((i=r.times)==null?void 0:i[t])||[]).length})||s[0]:null}function P(e){l.dropdownOpen=e,document.documentElement.classList.toggle("dropdown-open",e)}function U(){L.forEach(e=>{e.open&&e.close()})}function xe(e){if(L.has(e)){const o=L.get(e);return(!o.wrapper.isConnected||o.wrapper.previousSibling!==e)&&e.after(o.wrapper),o}const n=document.createElement("div");n.className="dropdown";const t=document.createElement("button");t.type="button",t.className="dropdown__button",t.setAttribute("aria-haspopup","listbox"),t.setAttribute("aria-expanded","false");const s=document.createElement("span");s.className="dropdown__label";const a=document.createElement("span");a.className="dropdown__chevron",t.append(s,a);const r=document.createElement("div");r.className="dropdown__list",r.setAttribute("role","listbox"),r.tabIndex=-1,n.append(t,r),e.after(n),e.classList.add("native-select"),e.setAttribute("aria-hidden","true"),e.tabIndex=-1;const i={wrapper:n,button:t,label:s,list:r,optionsKey:"",options:[],activeIndex:0,open:!1,openDropdown(){i.open||(U(),i.open=!0,n.classList.add("is-open"),t.setAttribute("aria-expanded","true"),P(!0),i.syncActiveIndex(),r.tabIndex=-1)},close(){if(!i.open)return;i.open=!1,n.classList.remove("is-open"),t.setAttribute("aria-expanded","false"),r.tabIndex=-1,t.focus();const o=Array.from(L.values()).some(c=>c.open);P(o)},syncActiveIndex(){const o=e.selectedIndex>=0?e.selectedIndex:0;i.setActive(o)},setActive(o){if(!i.options.length)return;const c=Math.max(0,Math.min(o,i.options.length-1));i.activeIndex=c,i.options.forEach((d,u)=>{const p=u===c;d.classList.toggle("is-active",p),d.setAttribute("aria-selected",p?"true":"false"),p&&d.scrollIntoView({block:"nearest"})})}};return t.addEventListener("click",()=>{i.open?i.close():i.openDropdown()}),t.addEventListener("keydown",o=>{if(o.key==="ArrowDown"||o.key==="ArrowUp"){if(o.preventDefault(),!i.open){i.openDropdown();return}i.setActive(i.activeIndex+(o.key==="ArrowDown"?1:-1));return}if(i.open&&o.key==="Enter"){o.preventDefault();const c=i.options[i.activeIndex];c&&(e.value=c.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),i.close());return}i.open&&o.key==="Escape"&&(o.preventDefault(),i.close())}),r.addEventListener("click",o=>{const c=o.target.closest(".dropdown__option");if(!c)return;const d=c.dataset.value;d!=null&&(e.value=d,e.dispatchEvent(new Event("change",{bubbles:!0})),i.close())}),r.addEventListener("keydown",o=>{if(o.key==="Escape"){o.preventDefault(),i.close();return}if(o.key==="ArrowDown"){o.preventDefault(),i.setActive(i.activeIndex+1);return}if(o.key==="ArrowUp"){o.preventDefault(),i.setActive(i.activeIndex-1);return}if(o.key==="Enter"){o.preventDefault();const c=i.options[i.activeIndex];c&&(e.value=c.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),i.close())}}),document.addEventListener("click",o=>{i.open&&(n.contains(o.target)||i.close())}),L.set(e,i),i}function B(e){var i;const n=xe(e),t=e.hidden||e.style.display==="none"||e.classList.contains("is-hidden");n.wrapper.style.display=t?"none":"",n.button.disabled=e.disabled,n.button.setAttribute("aria-disabled",e.disabled?"true":"false");const s=Array.from(e.options).map(o=>({value:o.value,label:o.textContent})),a=s.map(o=>`${o.value}:${o.label}`).join("|");a!==n.optionsKey&&(n.optionsKey=a,n.list.innerHTML="",n.options=s.map(o=>{const c=document.createElement("button");return c.type="button",c.className="dropdown__option",c.setAttribute("role","option"),c.dataset.value=o.value,c.textContent=o.label,n.list.append(c),c}));const r=e.selectedIndex>=0?e.selectedIndex:0;n.label.textContent=((i=s[r])==null?void 0:i.label)||"",n.setActive(r)}function A(){try{const e=localStorage.getItem(N);return e?JSON.parse(e):[]}catch{return[]}}function Le(e){const n=document.querySelector("#favoriteDockPanel"),t=document.querySelector("#favoriteDock"),s=document.querySelector("[data-favorite-tab]");if(!n)return;const a=A();if(!a.length){if(n.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,t&&t.classList.add("is-empty"),s){const i=t==null?void 0:t.classList.contains("is-open");s.classList.toggle("is-active",!!i)}return}t&&t.classList.remove("is-empty"),l.now.getHours()*60+l.now.getMinutes();const r=a.map(i=>{var $;const o=T.find(S=>S.id===i.routeId);if(!o)return"";const c=W(l.now,null,o);let d=Se(o,i.stopId,c);if(f(o)&&i.campusFrom&&(d=Q({...o,stops:E(o,c)},i.campusFrom,i.campusTo)),!d)return"";const u=W(l.now,d,o),p=(($=d.times)==null?void 0:$[u])||[],v=J(l.now,u),h=p.length?j(p,v-2,2):[],b=p[p.length-1],D=f(o)&&i.campusFrom?`${x(i.campusFrom)} → ${x(i.campusTo)}`:d.direction&&d.direction!==o.name?`${_(o.id,d.name)} → ${d.direction}`:`${_(o.id,d.name)}`;return`
        <div class="favorite-dock__item">
          <div class="favorite-dock__title">
            <span>${o.name}</span>
            <span>${D}</span>
          </div>
          <div class="favorite-dock__row">
            <div class="favorite-dock__times">
              ${h.length?h.map(S=>`
                        <span>
                          ${S}
                          ${b&&S===b?'<em class="last-tag">막차</em>':""}
                        </span>
                      `).join(""):'<span class="favorite-dock__empty-text">미운행</span>'}
            </div>
            <button class="favorite-dock__remove" type="button" data-remove-favorite="${i.key}">
              삭제
            </button>
          </div>
        </div>
      `}).filter(Boolean);if(!r.length){if(n.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,t&&t.classList.add("is-empty"),s){const i=t==null?void 0:t.classList.contains("is-open");s.classList.toggle("is-active",!!i)}return}n.innerHTML=r.join("")}function y(e){const n=ue(e);return pe.forcedWeekends.includes(n)||me(e)?"weekend":"weekday"}function W(e,n,t){var p;const s=y(e),a=new Date(e);a.setDate(e.getDate()-1);const r=y(a);if(s===r)return s;const i=e.getHours()*60+e.getMinutes();if(i>=R)return s;const o=t?z(t,r):K(((p=n==null?void 0:n.times)==null?void 0:p[r])||[]),c=o!=null&&o>=i+1440,d=v=>{var h;return(((h=n==null?void 0:n.times)==null?void 0:h[v])||[]).length>0};let u=c?r:s;return u===r&&!d(r)&&d(s)&&(u=s),u===s&&!d(s)&&d(r)&&c&&(u=r),u}function J(e,n){const t=e.getHours()*60+e.getMinutes(),s=y(e);return n!==s&&t<R?t+1440:t}function V(e,n){if(l.serviceOverride)return l.serviceOverride;if(!n)return y(e);const t=new Date(e);t.setDate(e.getDate()-1);const s=y(t),a=y(e);if(s===a)return a;const r=e.getHours()*60+e.getMinutes();if(r>=R)return a;const i=z(n,s);return i==null?a:i>=r+1440?s:a}function Y(e){const n=["olev","campus-loop","wolpyeong","wolpyeong-early"];return T.sort((t,s)=>{const a=n.indexOf(t.id),r=n.indexOf(s.id),i=a===-1?Number.MAX_SAFE_INTEGER:a,o=r===-1?Number.MAX_SAFE_INTEGER:r;return i!==o?i-o:t.name.localeCompare(s.name)})}function X(e,n){return e.find(t=>t.id===n)||e[0]}function f(e){return(e==null?void 0:e.id)===ve}function x(e){var n;return((n=k.find(t=>t.id===e))==null?void 0:n.label)||e}function F(e){const n=k.find(t=>t.match.test(e));return n?n.id:null}function ke(e,n){const t=F(e[n].name);for(let s=n+1;s<e.length;s+=1){const a=F(e[s].name);if(a&&a!==t)return a}return null}function Q(e,n,t){const s=e.stops||[],a=s.map((o,c)=>({stop:o,index:c,campus:F(o.name)})).filter(o=>o.campus===n);if(!a.length)return s[0];const r=a.filter(o=>/출발/.test(o.stop.name)),i=r.length?r:a;if(t){const o=i.find(c=>ke(s,c.index)===t);if(o)return o.stop}return i[0].stop}function Z(e,n){var r,i;const t=E(e,n);if(f(e)){let o=Q({...e,stops:t},l.campusFrom,l.campusTo);return(((r=o==null?void 0:o.times)==null?void 0:r[n])||[]).length||(o=t.find(d=>{var u;return(((u=d.times)==null?void 0:u[n])||[]).length})||t[0]||e.stops[0]),o}let s=t.find(o=>o.id===l.stopId)||t.find(o=>o.default)||t[0]||e.stops[0];return(((i=s==null?void 0:s.times)==null?void 0:i[n])||[]).length||(s=t.find(o=>{var c;return(((c=o.times)==null?void 0:c[n])||[]).length})||t[0]||e.stops[0]),s}function ee(e){const n=document.querySelector("[data-route-title]"),t=document.querySelector("[data-route-subtitle]"),s=document.querySelector("[data-route-badge]"),a=document.querySelector("[data-weekday]");if(n&&(n.textContent=e.name),t&&(t.textContent=f(e)?`${x(l.campusFrom)} → ${x(l.campusTo)}`:e.subtitle||""),s){const r=e.stops.some(i=>{var o;return(((o=i.times)==null?void 0:o.weekend)||[]).length});s.textContent=r?"매일 운영":"평일 운영",s.classList.toggle("is-daily",r),s.classList.toggle("is-weekday",!r)}if(a){const r=y(l.now)==="weekday"?"평일":"휴일";a.textContent=`${fe(l.now)} (${r}) ·`}}function te(){const e=document.querySelector("[data-clock]"),n=document.querySelector("[data-date]");if(!e||!n)return;e.textContent=ge(l.now);const t=ye(l.now);n.textContent=t.replace(/^\d{4}년\s*/,"")}function Ee(){try{return localStorage.getItem(G)}catch{return null}}function De(e){try{localStorage.setItem(G,e)}catch{}}function q(e){const n=Ee();let t=!0;if(n==="dark")t=!1;else if(n==="light")t=!0;else{const a=e.getHours();t=a>=6&&a<18}document.body.classList.toggle("theme-night",!t),document.documentElement.classList.toggle("theme-night",!t);const s=document.querySelector('meta[name="theme-color"]');s&&s.setAttribute("content",t?"#e9ecff":"#05070f"),t?(document.documentElement.style.removeProperty("--night-sky"),document.documentElement.style.removeProperty("--app-bg")):$e()}function $e(){if(!m&&window.__nightSkyCss&&(m=window.__nightSkyCss),!m)try{m=localStorage.getItem(M)||sessionStorage.getItem(M)}catch{m=null}if(!m){m=Me();try{localStorage.setItem(M,m),sessionStorage.setItem(M,m)}catch{}}window.__nightSkyCss=m,document.documentElement.style.setProperty("--night-sky",m),document.documentElement.style.setProperty("--app-bg",m)}function Me(){const e=[],t=typeof window<"u"?window.innerWidth:1200,s=typeof window<"u"?window.innerHeight:800;for(let a=0;a<28;a+=1){const r=Math.floor(Math.random()*t),i=Math.floor(Math.random()*s),o=(Math.random()*1.8+.6).toFixed(2),c=(Math.random()*.5+.35).toFixed(2),u=Math.random()<.25?`rgba(255, 238, 180, ${c})`:`rgba(255, 255, 255, ${c})`;e.push(`radial-gradient(circle at ${r}px ${i}px, ${u} 0 ${o}px, transparent ${(Number(o)+1.6).toFixed(2)}px)`)}if(Math.random()<.65){const a=Math.floor(Math.random()*t),r=Math.floor(Math.random()*(s*.6));e.push(`radial-gradient(circle at ${a}px ${r}px, rgba(255, 244, 190, 0.95) 0 4px, transparent 7px)`)}return e.push("linear-gradient(180deg, #05070f 0%, #0b1026 55%, #141b3f 100%)"),e.join(", ")}function Ie(){const e=()=>Math.random()<.7?Math.random()<.5?-15+Math.random()*20:95+Math.random()*20:15+Math.random()*70,n=(a,r)=>{const i=Math.round(e()),o=Math.round(e()),c=Math.floor(420+Math.random()*420),d=Math.floor(320+Math.random()*360),u=(r+Math.random()*.06).toFixed(2);return`radial-gradient(${c}px ${d}px at ${i}% ${o}%, rgba(${a}, ${u}), transparent 72%)`},t=["246, 226, 138","255, 181, 201","171, 228, 255","160, 255, 224","198, 176, 255","255, 214, 165"],s=[];for(let a=0;a<10;a+=1){const r=t[a%t.length];s.push(n(r,.045))}return s}function Te(){if(!document.body.classList.contains("theme-night"))return;const e=document.querySelectorAll(".hero-card, .next-card, .notice-card, .route-card, .time-table");let n={};try{n=JSON.parse(sessionStorage.getItem(O)||"{}")}catch{n={}}const t=a=>a.classList.contains("hero-card")?"hero":a.classList.contains("next-card")?"next":a.classList.contains("notice-card")?"notice":a.classList.contains("route-card")?"route":a.classList.contains("time-table")?"table":"card",s=location.pathname.replace(/\W+/g,"")||"route";e.forEach((a,r)=>{const i=t(a),o=`${s}:${i}:${r}`;n[o]||(n[o]=Ie());const[c,d,u]=n[o];a.style.setProperty("--card-glow-1",c),a.style.setProperty("--card-glow-2",d),a.style.setProperty("--card-glow-3",u)});try{sessionStorage.setItem(O,JSON.stringify(n))}catch{}}function Ae(e,n){const t=document.querySelector("#routeSelect"),s=document.querySelector("#stopSelect"),a=document.querySelector("#stopSelectLabel"),r=document.querySelector("#stopSelectRow"),i=document.querySelector("#campusSelector");if(!t||!s)return;t.innerHTML=e.map(c=>`<option value="${c.id}">${c.name}${c.subtitle?` ${c.subtitle}`:""}</option>`).join(""),t.value=n.id;const o=f(n);if(t.disabled=!1,t.classList.remove("route-select--static"),o)s.innerHTML="";else{const c=E(n,l.serviceDay);s.innerHTML=c.map(d=>`<option value="${d.id}">${d.name}</option>`).join("")}if(o)s.disabled=!0;else{const c=E(n,l.serviceDay),d=c.find(u=>u.default)||c[0];l.stopId=c.some(u=>u.id===l.stopId)?l.stopId:d==null?void 0:d.id,s.value=l.stopId,s.disabled=c.length<=1}s.classList.toggle("is-hidden",o),s.style.display=o?"none":"inline-flex",s.hidden=o,s.setAttribute("aria-hidden",o?"true":"false"),s.tabIndex=o?-1:0,a&&(a.classList.toggle("is-hidden",o),a.hidden=o,a.style.display=o?"none":"inline-flex"),r&&(r.classList.toggle("is-hidden",o),r.hidden=o,r.style.display=o?"none":"flex"),i&&(i.style.display=o?"flex":"none"),B(t),B(s),t.onchange=c=>{l.routeId=c.target.value,l.stopId="",g()},s.onchange=c=>{l.stopId=c.target.value,g()}}function Ce(e){const n=document.querySelector("#campusSelector");if(!n||!f(e))return;const t=n.querySelector("[data-campus-role='from']"),s=n.querySelector("[data-campus-role='to']"),a=n.querySelector("#campusSwap"),r=(c,d)=>{if(c!==d)return{fromId:c,toId:d};const u=k.find(p=>p.id!==c);return{fromId:c,toId:u?u.id:d}},i=c=>{const d=r(c,l.campusTo);l.campusFrom=d.fromId,l.campusTo=d.toId,g()},o=c=>{const d=r(l.campusFrom,c);l.campusFrom=d.fromId,l.campusTo=d.toId,g()};t&&(t.innerHTML=k.map(c=>`
        <button class="campus-pill ${c.id===l.campusFrom?"is-active":""}" data-campus-from="${c.id}">
          ${c.label}
        </button>
      `).join(""),t.querySelectorAll("[data-campus-from]").forEach(c=>{c.addEventListener("click",()=>i(c.dataset.campusFrom))})),s&&(s.innerHTML=k.map(c=>`
        <button class="campus-pill ${c.id===l.campusTo?"is-active":""} ${c.id===l.campusFrom?"is-disabled":""}" data-campus-to="${c.id}" ${c.id===l.campusFrom?"disabled":""}>
          ${c.label}
        </button>
      `).join(""),s.querySelectorAll("[data-campus-to]").forEach(c=>{c.addEventListener("click",()=>o(c.dataset.campusTo))})),a&&(a.onclick=()=>{const c=l.campusTo,d=l.campusFrom;l.campusFrom=c,l.campusTo=d,g()})}function _e(e){const n=document.querySelector("#stopPills"),t=document.querySelector("#stopPillsToggle");if(!n)return;const s=n.closest("section");if(f(e)){s&&(s.style.display="none");return}if(e.stops.length<=1){s&&(s.style.display="none");return}s&&(s.style.display="block");const a=E(e,l.serviceDay);n.innerHTML=a.map(i=>`
      <button class="stop-pill ${i.id===l.stopId?"is-active":""}" data-stop="${i.id}">
        ${_(e.id,i.name)}
      </button>
    `).join("");const r=()=>{if(!t)return;const i=n.scrollHeight>n.clientHeight+4;t.style.display=i||l.stopPillsExpanded?"inline-flex":"none",t.innerHTML="",t.classList.toggle("is-open",l.stopPillsExpanded)};n.classList.toggle("is-collapsed",!l.stopPillsExpanded),n.querySelectorAll("[data-stop]").forEach(i=>{i.addEventListener("click",()=>{l.stopId=i.dataset.stop,g()})}),t&&(t.onclick=()=>{l.stopPillsExpanded=!l.stopPillsExpanded,n.classList.toggle("is-collapsed",!l.stopPillsExpanded),r()}),requestAnimationFrame(r)}function Fe(e,n){var d;const t=document.querySelector("#nextPanel");if(!t)return;const s=J(l.now,l.serviceDay),a=((d=n.times)==null?void 0:d[l.serviceDay])||[];if(a.length===0){t.style.display="none";return}t.style.display="";const r=a[a.length-1],i=j(a,s-2,5),c=f(e)?`${x(l.campusFrom)} → ${x(l.campusTo)}`:`${n.name} 기준`;t.innerHTML=`
    <div class="next-header">
      <div>
        <h3>${e.name}</h3>
        <p>${c}</p>
      </div>
      <span class="next-badge">가까운 예정</span>
    </div>
    <div class="next-list">
      ${i.map(u=>`
          <div class="next-chip">
            ${u}
            ${r&&u===r?'<span class="last-tag">막차</span>':""}
          </div>
        `).join("")}
    </div>
    <p class="next-note">실시간 위치 아님 · 실제 운행과 차이 가능</p>
  `}function qe(e,n){var i;const t=document.querySelector("#timeTable"),s=document.querySelector("#timeTableSection");if(!t)return;const a=(((i=n.times)==null?void 0:i[l.serviceDay])||[]).slice().sort((o,c)=>H(o)-H(c)),r=a[a.length-1];if(a.length===0){t.innerHTML=`
      <div class="time-empty">
        선택한 운행일에는 시간표가 없습니다.
      </div>
    `,s&&(s.style.display="");return}s&&(s.style.display=""),t.innerHTML=a.map(o=>`
      <div class="time-row ${r&&o===r?"last-run":""}">
        <span>${o}</span>
        <span class="time-label">${r&&o===r?"막차":"예정"}</span>
      </div>
    `).join("")}function Ne(e,n){var i;const t=document.querySelector("#routeNote");if(!t)return;const a=(((i=n==null?void 0:n.times)==null?void 0:i[l.serviceDay])||[]).length===0?"선택한 운행일에는 운행하지 않습니다.":"",r=e.note||"";t.textContent=[a,r].filter(Boolean).join(`
`),t.style.display=t.textContent?"":"none"}function Re(e,n){var c;const t=document.querySelector("#favoriteToggleRoute"),s=document.querySelector("#favoriteHelp");if(!t)return;const a=A(),r=f(e)?`${e.id}:${l.campusFrom}->${l.campusTo}`:`${e.id}:${n.id}`,o=(((c=n==null?void 0:n.times)==null?void 0:c[l.serviceDay])||[]).length===0;t.textContent=a.some(d=>d.key===r)?"즐겨찾기 해제":"즐겨찾기 추가",t.disabled=o,t.classList.toggle("is-disabled",o),t.setAttribute("aria-disabled",o?"true":"false"),s&&(o?(s.textContent="선택한 운행일에는 운행하지 않아 즐겨찾기를 추가할 수 없어요.",s.classList.add("is-visible"),s.setAttribute("aria-hidden","false")):(s.textContent="",s.classList.remove("is-visible"),s.setAttribute("aria-hidden","true")))}function g(){var s;l.now=new Date;const e=Y(y(l.now)),n=X(e,l.routeId||((s=e[0])==null?void 0:s.id));if(!n)return;l.routeId=n.id,l.serviceDay=V(l.now,n);const t=Z(n,l.serviceDay);ee(n),te(),q(l.now),Ae(e,n),Ce(n),Fe(n,t),qe(n,t),Ne(n,t),_e(n),Re(n,t),Le(),Te()}function He(){const e=document.querySelector("#serviceDayToggle");if(!e)return;const n=()=>{const t=y(l.now),s=l.serviceOverride||t;e.querySelectorAll("button[data-day]").forEach(a=>{const r=a.dataset.day,o=r==="auto"?!l.serviceOverride:r===s;a.classList.toggle("is-active",o)})};e.addEventListener("click",t=>{const s=t.target.closest("button[data-day]");if(!s)return;const a=s.dataset.day,r=y(l.now);a==="auto"?l.serviceOverride=null:l.serviceOverride=a===r?null:a,n(),g()}),n()}function Oe(){const e=document.querySelector("#favoriteToggleRoute");e&&e.addEventListener("click",()=>{if(e.disabled)return;const n=A(),t=T.find(i=>i.id===l.routeId),s=t?Z(t,l.serviceDay):null,a=t&&f(t)?`${t.id}:${l.campusFrom}->${l.campusTo}`:`${l.routeId}:${l.stopId}`,r=n.some(i=>i.key===a)?n.filter(i=>i.key!==a):[{key:a,routeId:l.routeId,stopId:(s==null?void 0:s.id)||l.stopId,campusFrom:t&&f(t)?l.campusFrom:void 0,campusTo:t&&f(t)?l.campusTo:void 0,savedAt:Date.now()},...n];localStorage.setItem(N,JSON.stringify(r.slice(0,10))),g()})}function Pe(){const e=document.querySelector("[data-theme-toggle]");e&&(e.addEventListener("click",()=>{const n=document.body.classList.contains("theme-night");De(n?"light":"dark"),q(new Date)}),q(new Date))}function Be(){const e=document.querySelector("#favoriteDock"),n=document.querySelector("[data-favorite-tab]"),t=document.querySelector("#favoriteDockPanel");if(!e||!n)return;let s=!1;const a=()=>{n.classList.toggle("is-active",e.classList.contains("is-open"))},r=()=>{e.classList.add("is-open"),a(),o()},i=()=>{s||(e.classList.remove("is-open"),a())};e.addEventListener("mouseenter",()=>r()),e.addEventListener("mouseleave",()=>i()),n.addEventListener("mouseenter",()=>r()),n.addEventListener("mouseleave",()=>i()),e.addEventListener("click",()=>{s=!s,s?e.classList.add("is-open"):e.classList.remove("is-open"),a()}),n.addEventListener("click",()=>{s=!s,s?e.classList.add("is-open"):e.classList.remove("is-open"),a()});const o=()=>{if(!window.matchMedia("(max-width: 640px)").matches||!e.classList.contains("is-open"))return;const d=n.getBoundingClientRect();e.style.top=`${Math.round(d.bottom+8)}px`};document.addEventListener("click",c=>{e.classList.contains("is-open")&&(e.contains(c.target)||n.contains(c.target)||(s=!1,e.classList.remove("is-open"),a()))}),t&&t.addEventListener("click",c=>{c.stopPropagation();const d=c.target.closest("[data-remove-favorite]");if(!d)return;const u=d.dataset.removeFavorite;if(!u)return;const p=A().filter(v=>v.key!==u);localStorage.setItem(N,JSON.stringify(p)),g()}),a(),window.addEventListener("scroll",o,{passive:!0}),window.addEventListener("resize",o),n.addEventListener("click",o),e.addEventListener("mouseenter",o)}function I(){const e=document.querySelector("header.navbar"),n=e==null?void 0:e.querySelector(".brand"),t=e==null?void 0:e.querySelector(".primary-nav"),s=t==null?void 0:t.querySelector(".nav-links"),a=t==null?void 0:t.querySelector(".nav-actions");if(!e||!n||!t||(e.classList.contains("is-wrapped")&&e.classList.remove("is-wrapped"),!s||!a))return;const i=Array.from(s.children).some(w=>w.scrollHeight>w.clientHeight+2),o=Array.from(a.children).some(w=>w.scrollHeight>w.clientHeight+2),c=parseFloat(getComputedStyle(e).gap||"0")||0,d=parseFloat(getComputedStyle(t).gap||"0")||0,u=w=>{const C=Array.from(w.children);if(!C.length)return 0;const re=parseFloat(getComputedStyle(w).gap||"0")||0;return C.reduce((ce,le)=>ce+le.getBoundingClientRect().width,0)+re*(C.length-1)},p=u(s)+u(a)+d,v=e.clientWidth-n.getBoundingClientRect().width-c,h=s.getBoundingClientRect(),b=a.getBoundingClientRect(),D=t.getBoundingClientRect(),$=e.getBoundingClientRect(),S=n.getBoundingClientRect(),ne=h.right>b.left-8,se=D.left<S.right+8,oe=D.right>$.right-8,ie=p>v-he,ae=i||o||ne||se||oe||ie;e.classList.toggle("is-wrapped",ae)}function We(){var e;I(),window.addEventListener("resize",I),window.addEventListener("load",I),(e=document.fonts)!=null&&e.ready&&document.fonts.ready.then(I)}function je(){let e;window.addEventListener("resize",()=>{e&&window.clearTimeout(e),e=window.setTimeout(()=>{l.dropdownOpen&&U(),g()},120)})}(()=>{const n=new URLSearchParams(window.location.search).get("route");n&&T.some(t=>t.id===n)&&(l.routeId=n)})();g();Oe();Pe();Be();He();We();je();setInterval(()=>{var e;if(l.dropdownOpen){l.now=new Date,te();const n=Y(y(l.now)),t=X(n,l.routeId||((e=n[0])==null?void 0:e.id));t&&(l.serviceDay=V(l.now,t),ee(t));return}g()},1e3);
