import{r as he,f as ge,a as ye,t as we,h as be,i as Se,b as Le,d as ee,e as P,j as ke,k as xe,l as z,g as Ee,m as Ie,c as Te}from"./recentSearch-DFj3PCu6.js";const V="kaist-bus-favorites",te="kaist-bus-theme",N="kaist-bus-night-sky",q="kaist-bus-night-sky-meta",J="v2",Ce=24*60*60*1e3,$e=1/7,Q="kaist-bus-card-glow";let L=null;const De="campus-loop",C=[{id:"main",label:"본교",match:/본교/},{id:"munji",label:"문지",match:/문지/},{id:"hwaam",label:"화암",match:/화암/}],s={now:new Date,serviceDay:"weekday",serviceOverride:null,routeId:"",stopId:"",campusFrom:"main",campusTo:"munji",stopPillsExpanded:!1,dropdownOpen:!1,favoriteHelpVisible:!1,sharedFromLink:!1,routeSearch:"",stopSearch:""},D=new Map,_e=12,U=4*60;function Ae(e){const n=new Map;return e.forEach(t=>{if(!n.has(t.id)){n.set(t.id,{...t,stops:t.stops.map(l=>{var c,r;return{...l,times:{weekday:[...((c=l.times)==null?void 0:c.weekday)||[]],weekend:[...((r=l.times)==null?void 0:r.weekend)||[]]}}})});return}const o=n.get(t.id);!o.note&&t.note&&(o.note=t.note);const a=new Map(o.stops.map(l=>[l.name,l]));t.stops.forEach(l=>{var r,i;const c=a.get(l.name);if(!c){const d={...l,times:{weekday:[...((r=l.times)==null?void 0:r.weekday)||[]],weekend:[...((i=l.times)==null?void 0:i.weekend)||[]]}};o.stops.push(d),a.set(l.name,d);return}["weekday","weekend"].forEach(d=>{var g,h;const u=((g=c.times)==null?void 0:g[d])||[],p=((h=l.times)==null?void 0:h[d])||[];if(!u.length&&p.length){c.times[d]=[...p];return}p.forEach(S=>{u.includes(S)||u.push(S)})})})}),Array.from(n.values())}const M=Ae(he.routes);function B(e){const[n,t]=e.split(":").map(Number);if(Number.isNaN(n)||Number.isNaN(t))return 0;let o=n*60+t;return n<4&&(o+=1440),o}function ne(e){return!e||e.length===0?null:Math.max(...e.map(B))}function oe(e,n){if(!e)return null;const t=e.stops.flatMap(o=>{var a;return((a=o.times)==null?void 0:a[n])||[]});return ne(t)}function _(e,n){const t=e.stops.filter(o=>{var a;return(((a=o.times)==null?void 0:a[n])||[]).length});return t.length?t:e.stops}function Me(e,n,t){const o=e.stops.filter(l=>l.id===n);return o.length?o.find(l=>{var c;return(((c=l.times)==null?void 0:c[t])||[]).length})||o[0]:null}function X(e){s.dropdownOpen=e,document.documentElement.classList.toggle("dropdown-open",e)}function se(){D.forEach(e=>{e.open&&e.close()})}function Fe(e){if(D.has(e)){const r=D.get(e);return(!r.wrapper.isConnected||r.wrapper.previousSibling!==e)&&e.after(r.wrapper),r}const n=document.createElement("div");n.className="dropdown";const t=document.createElement("button");t.type="button",t.className="dropdown__button",t.setAttribute("aria-haspopup","listbox"),t.setAttribute("aria-expanded","false");const o=document.createElement("span");o.className="dropdown__label";const a=document.createElement("span");a.className="dropdown__chevron",t.append(o,a);const l=document.createElement("div");l.className="dropdown__list",l.setAttribute("role","listbox"),l.tabIndex=-1,n.append(t,l),e.after(n),e.classList.add("native-select"),e.setAttribute("aria-hidden","true"),e.tabIndex=-1;const c={wrapper:n,button:t,label:o,list:l,optionsKey:"",options:[],activeIndex:0,open:!1,openDropdown(){if(c.open)return;se(),c.open=!0,n.classList.add("is-open"),t.setAttribute("aria-expanded","true"),X(!0),c.syncActiveIndex(),l.tabIndex=-1;const r=/Android/i.test(navigator.userAgent||"");c.searchInput&&!r&&c.searchInput.focus()},close(){if(!c.open)return;c.open=!1,n.classList.remove("is-open"),t.setAttribute("aria-expanded","false"),l.tabIndex=-1,t.focus();const r=Array.from(D.values()).some(i=>i.open);X(r)},syncActiveIndex(){const r=e.selectedIndex>=0?e.selectedIndex:0;c.setActive(r)},setActive(r){if(!c.options.length)return;const i=Math.max(0,Math.min(r,c.options.length-1));c.activeIndex=i,c.options.forEach((d,u)=>{const p=u===i;d.classList.toggle("is-active",p),d.setAttribute("aria-selected",p?"true":"false"),p&&d.scrollIntoView({block:"nearest"})})}};return t.addEventListener("click",()=>{c.open?c.close():c.openDropdown()}),t.addEventListener("keydown",r=>{if(r.key==="ArrowDown"||r.key==="ArrowUp"){if(r.preventDefault(),!c.open){c.openDropdown();return}c.setActive(c.activeIndex+(r.key==="ArrowDown"?1:-1));return}if(c.open&&r.key==="Enter"){r.preventDefault();const i=c.options[c.activeIndex];i&&(e.value=i.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),c.close());return}c.open&&r.key==="Escape"&&(r.preventDefault(),c.close())}),l.addEventListener("click",r=>{const i=r.target.closest(".dropdown__option");if(!i)return;const d=i.dataset.value;d!=null&&(e.value=d,e.dispatchEvent(new Event("change",{bubbles:!0})),c.close())}),l.addEventListener("keydown",r=>{if(r.key==="Escape"){r.preventDefault(),c.close();return}if(r.key==="ArrowDown"){r.preventDefault(),c.setActive(c.activeIndex+1);return}if(r.key==="ArrowUp"){r.preventDefault(),c.setActive(c.activeIndex-1);return}if(r.key==="Enter"){r.preventDefault();const i=c.options[c.activeIndex];i&&(e.value=i.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),c.close())}}),document.addEventListener("click",r=>{if(c.ignoreDocumentClick){c.ignoreDocumentClick=!1;return}c.open&&(n.contains(r.target)||c.close())}),D.set(e,c),c}function x(e,n=null){var S;const t=Fe(e),o=e.hidden||e.style.display==="none"||e.classList.contains("is-hidden");t.wrapper.style.display=o?"none":"",t.button.disabled=e.disabled,t.button.setAttribute("aria-disabled",e.disabled?"true":"false");const a=e.id==="routeSelect"||e.id==="stopSelect",l=a?e.id:"",c=Array.from(e.options).map(v=>({value:v.value,label:v.textContent})),r=e.id==="routeSelect"?s.routeSearch:e.id==="stopSelect"?s.stopSearch:"",i=n??r,d=[l,c.map(v=>`${v.value}:${v.label}`).join("|")].join("|");if(d!==t.optionsKey){if(t.optionsKey=d,a){if(!t.searchWrap){const v=document.createElement("div");v.className="dropdown__search";const m=document.createElement("input");m.type="search",m.className="dropdown__search-input",m.placeholder=e.id==="routeSelect"?"노선 검색":"정류장 검색";const f=document.createElement("button");f.type="button",f.className="search-clear search-clear--dropdown",f.setAttribute("aria-label","검색어 삭제"),f.textContent="×";const y=()=>{f.classList.toggle("is-visible",!!m.value)};m.addEventListener("compositionstart",()=>{t.isComposing=!0,t.compositionBase=e.id==="routeSelect"?s.routeSearch:s.stopSearch}),m.addEventListener("compositionupdate",()=>{x(e,m.value),y()}),m.addEventListener("compositionend",()=>{t.isComposing=!1,e.id==="routeSelect"?s.routeSearch=m.value:s.stopSearch=m.value,t.compositionBase="",x(e,m.value),y()}),m.addEventListener("input",()=>{if(t.isComposing){x(e,m.value),y();return}e.id==="routeSelect"?s.routeSearch=m.value:s.stopSearch=m.value,x(e,m.value),y()}),m.addEventListener("keydown",w=>{if(w.key!=="Enter")return;const $=e.id==="routeSelect"?"route":"stop";ke($,m.value),x(e,m.value),y()}),f.addEventListener("click",()=>{m.value="",e.id==="routeSelect"?s.routeSearch="":s.stopSearch="",t.compositionBase="",x(e,""),y(),m.focus()}),v.append(m),v.append(f),t.searchWrap=v,t.searchInput=m,t.searchClear=f}!t.isComposing&&document.activeElement!==t.searchInput&&(t.searchInput.value=i||""),t.searchClear&&t.searchClear.classList.toggle("is-visible",!!t.searchInput.value),t.recentWrap||(t.recentWrap=document.createElement("div"),t.recentWrap.className="dropdown__recent",t.recentWrap.addEventListener("click",v=>{v.stopPropagation(),t.ignoreDocumentClick=!0;const m=v.target.closest("[data-recent]");if(!m)return;const f=m.dataset.recent||"";e.id==="routeSelect"?s.routeSearch=f:s.stopSearch=f,x(e,f)})),t.optionsContainer||(t.optionsContainer=document.createElement("div")),t.list.replaceChildren(t.searchWrap,t.recentWrap,t.optionsContainer)}else t.list.innerHTML="",t.optionsContainer=t.list;t.optionsContainer.innerHTML="",t.options=c.map((v,m)=>{const f=document.createElement("button");return f.type="button",f.className="dropdown__option",f.setAttribute("role","option"),f.dataset.value=v.value,f.dataset.label=v.label,f.addEventListener("mouseenter",()=>{t.setActive(m)}),t.optionsContainer.append(f),f})}const u=(v,m=v)=>{if(!t.optionsContainer)return;let f=0;t.options.forEach(w=>{const $=w.dataset.label||"",F=v?Ie($,v):!0;w.style.display=F?"":"none",F&&(w.innerHTML=Te($,m),f+=1)});const y=t.optionsContainer.querySelector(".dropdown__empty");if(f)y&&y.remove();else if(!y){const w=document.createElement("div");w.className="dropdown__empty",w.textContent="검색 결과가 없습니다.",t.optionsContainer.append(w)}return f};if(a&&t.searchInput&&!t.isComposing&&document.activeElement!==t.searchInput&&t.searchInput.value!==(i||"")&&(t.searchInput.value=i||""),a&&t.recentWrap){const v=e.id==="routeSelect"?"route":"stop",m=xe(v);t.recentWrap.innerHTML=m.length?`
        <div class="dropdown__recent-label">최근 검색</div>
        <div class="dropdown__recent-items">
          ${m.map(f=>`<button type="button" class="dropdown__recent-chip" data-recent="${z(f)}">${z(f)}</button>`).join("")}
        </div>
      `:""}const p=(t.isComposing,i||""),g=u(i||"",p);if(t.isComposing&&(!g||g===0)){const v=i||"",m=Ee(v,c.map(f=>f.label||""),t.compositionBase);m&&u(m,t.isComposing?m:v)}const h=e.selectedIndex>=0?e.selectedIndex:0;t.label.textContent=((S=c[h])==null?void 0:S.label)||"",t.setActive(h)}function A(){try{const e=localStorage.getItem(V);return e?JSON.parse(e):[]}catch{return[]}}function j(e){localStorage.setItem(V,JSON.stringify(e))}function ie(e){const n=document.querySelector("#favoriteDockPanel"),t=document.querySelector("#favoriteDock"),o=document.querySelector("[data-favorite-tab]");if(!n)return;const a=A();if(!a.length){if(n.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,t&&t.classList.add("is-empty"),o){const i=t==null?void 0:t.classList.contains("is-open");o.classList.toggle("is-active",!!i)}return}t&&t.classList.remove("is-empty"),s.now.getHours()*60+s.now.getMinutes();const l=[],c=[];if(a.forEach(i=>{var y;const d=M.find(w=>w.id===i.routeId);if(!d)return;const u=Z(s.now,null,d);let p=Me(d,i.stopId,u);if(b(d)&&i.campusFrom&&(p=le({...d,stops:_(d,u)},i.campusFrom,i.campusTo)),!p)return;c.push(i);const g=Z(s.now,p,d),h=R(d,g,((y=p.times)==null?void 0:y[g])||[],i.campusFrom,i.campusTo),S=ae(s.now,g),v=h.length?ee(h,S-2,2):[],m=h[h.length-1],f=b(d)&&i.campusFrom?`${T(i.campusFrom)} → ${T(i.campusTo)}`:p.direction&&p.direction!==d.name?`${P(d.id,p.name)} → ${p.direction}`:`${P(d.id,p.name)}`;l.push({item:i,route:d,stop:p,label:f,upcoming:v,lastTime:m})}),c.length!==a.length&&j(c),!l.length){if(n.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,t&&t.classList.add("is-empty"),o){const i=t==null?void 0:t.classList.contains("is-open");o.classList.toggle("is-active",!!i)}return}const r=l.map((i,d)=>{const u=d===0,p=d===l.length-1;return`
      <div class="favorite-dock__item" ${[`data-jump-route="${i.route.id}"`,`data-jump-stop="${i.stop.id}"`,i.item.campusFrom?`data-jump-from="${i.item.campusFrom}"`:"",i.item.campusTo?`data-jump-to="${i.item.campusTo}"`:""].filter(Boolean).join(" ")}>
        <div class="favorite-dock__title">
          <span>${i.route.name}</span>
          <span>${i.label}</span>
        </div>
        <div class="favorite-dock__row">
          <div class="favorite-dock__times">
            ${i.upcoming.length?i.upcoming.map(h=>`
                      <span>
                        ${h}
                        ${i.lastTime&&h===i.lastTime?'<em class="last-tag">막차</em>':""}
                      </span>
                    `).join(""):'<span class="favorite-dock__empty-text">미운행</span>'}
          </div>
          <div class="favorite-dock__actions">
            <button class="favorite-dock__move" type="button" data-move-favorite="up" data-key="${i.item.key}" ${u?"disabled":""} aria-label="위로">
              ↑
            </button>
            <button class="favorite-dock__move" type="button" data-move-favorite="down" data-key="${i.item.key}" ${p?"disabled":""} aria-label="아래로">
              ↓
            </button>
            <button class="favorite-dock__remove" type="button" data-remove-favorite="${i.item.key}">
              삭제
            </button>
          </div>
        </div>
      </div>
    `});n.innerHTML=r.join("")}function E(e){const n=we(e);return be.forcedWeekends.includes(n)||Se(e)?"weekend":"weekday"}function Z(e,n,t){var p;const o=E(e),a=new Date(e);a.setDate(e.getDate()-1);const l=E(a);if(o===l)return o;const c=e.getHours()*60+e.getMinutes();if(c>=U)return o;const r=t?oe(t,l):ne(((p=n==null?void 0:n.times)==null?void 0:p[l])||[]),i=r!=null&&r>=c+1440,d=g=>{var h;return(((h=n==null?void 0:n.times)==null?void 0:h[g])||[]).length>0};let u=i?l:o;return u===l&&!d(l)&&d(o)&&(u=o),u===o&&!d(o)&&d(l)&&i&&(u=l),u}function ae(e,n){const t=e.getHours()*60+e.getMinutes(),o=E(e);return n!==o&&t<U?t+1440:t}function re(e,n){if(s.serviceOverride)return s.serviceOverride;if(!n)return E(e);const t=new Date(e);t.setDate(e.getDate()-1);const o=E(t),a=E(e);if(o===a)return a;const l=e.getHours()*60+e.getMinutes();if(l>=U)return a;const c=oe(n,o);return c==null?a:c>=l+1440?o:a}function ce(e){const n=["olev","campus-loop","wolpyeong","wolpyeong-early"];return M.sort((t,o)=>{const a=n.indexOf(t.id),l=n.indexOf(o.id),c=a===-1?Number.MAX_SAFE_INTEGER:a,r=l===-1?Number.MAX_SAFE_INTEGER:l;return c!==r?c-r:t.name.localeCompare(o.name)})}function Y(e,n){return e.find(t=>t.id===n)||e[0]}function Ne({routeId:e,stopId:n,campusFrom:t,campusTo:o}){const a=new URLSearchParams;e&&a.set("route",e),n&&a.set("stop",n),t&&a.set("from",t),o&&a.set("to",o),s.serviceOverride&&a.set("day",s.serviceOverride);const l=a.toString();return l?`./route.html?${l}`:"./route.html"}function qe(){const e=new URLSearchParams;return s.routeId&&e.set("route",s.routeId),s.stopId&&e.set("stop",s.stopId),s.campusFrom&&e.set("from",s.campusFrom),s.campusTo&&e.set("to",s.campusTo),s.serviceOverride&&e.set("day",s.serviceOverride),e.set("shared","1"),`./route.html?${e.toString()}`}function b(e){return(e==null?void 0:e.id)===De}function T(e){var n;return((n=C.find(t=>t.id===e))==null?void 0:n.label)||e}function W(e){const n=C.find(t=>t.match.test(e));return n?n.id:null}function He(e,n){const t=W(e[n].name);for(let o=n+1;o<e.length;o+=1){const a=W(e[o].name);if(a&&a!==t)return a}return null}function le(e,n,t){const o=e.stops||[],a=o.map((r,i)=>({stop:r,index:i,campus:W(r.name)})).filter(r=>r.campus===n);if(!a.length)return o[0];const l=a.filter(r=>/출발/.test(r.stop.name)),c=l.length?l:a;if(t){const r=c.find(i=>He(o,i.index)===t);if(r)return r.stop}return c[0].stop}function R(e,n,t,o,a){return!b(e)||n!=="weekend"||o!=="main"||a!=="hwaam"?t:t.filter(l=>l.trim()!=="11:30")}function de(e,n){var l,c;const t=_(e,n);if(b(e)){let r=le({...e,stops:t},s.campusFrom,s.campusTo);return(((l=r==null?void 0:r.times)==null?void 0:l[n])||[]).length||(r=t.find(d=>{var u;return(((u=d.times)==null?void 0:u[n])||[]).length})||t[0]||e.stops[0]),r}let o=t.find(r=>r.id===s.stopId)||t.find(r=>r.default)||t[0]||e.stops[0];return(((c=o==null?void 0:o.times)==null?void 0:c[n])||[]).length||(o=t.find(r=>{var i;return(((i=r.times)==null?void 0:i[n])||[]).length})||t[0]||e.stops[0]),o}function ue(e){const n=document.querySelector("[data-route-title]"),t=document.querySelector("[data-route-subtitle]"),o=document.querySelector("[data-route-badge]"),a=document.querySelector("[data-weekday]"),l=document.querySelector("#shareNotice");if(n&&(n.textContent=e.name),t&&(t.textContent=b(e)?`${T(s.campusFrom)} → ${T(s.campusTo)}`:e.subtitle||""),l&&(l.textContent=s.sharedFromLink?"공유된 링크로 열림":"",l.style.display=l.textContent?"":"none"),o){const c=e.stops.some(r=>{var i;return(((i=r.times)==null?void 0:i.weekend)||[]).length});o.textContent=c?"매일 운영":"평일 운영",o.classList.toggle("is-daily",c),o.classList.toggle("is-weekday",!c)}if(a){const c=E(s.now)==="weekday"?"평일":"휴일";a.textContent=`${Le(s.now)} (${c}) ·`}}function G(){const e=document.querySelector("[data-clock]"),n=document.querySelector("[data-date]");if(!e||!n)return;e.textContent=ge(s.now);const t=ye(s.now);n.textContent=t.replace(/^\d{4}년\s*/,"")}function Re(){try{return localStorage.getItem(te)}catch{return null}}function Oe(e){try{localStorage.setItem(te,e)}catch{}}function K(e){const n=Re();let t=!0;if(n==="dark")t=!1;else if(n==="light")t=!0;else{const a=e.getHours();t=a>=6&&a<18}document.body.classList.toggle("theme-night",!t),document.documentElement.classList.toggle("theme-night",!t);const o=document.querySelector('meta[name="theme-color"]');o&&o.setAttribute("content",t?"#e9ecff":"#05070f"),t?(document.documentElement.style.removeProperty("--night-sky"),document.documentElement.style.removeProperty("--app-bg")):Pe()}function Pe(){!L&&window.__nightSkyCss&&(L=window.__nightSkyCss);let e=null;try{e=JSON.parse(localStorage.getItem(q)||sessionStorage.getItem(q)||"null")}catch{e=null}const n=Date.now(),t=!e||e.version!==J||!e.createdAt||n-e.createdAt>Ce;if(!L&&!t)try{L=localStorage.getItem(N)||sessionStorage.getItem(N)}catch{L=null}if(!L||t){L=Be();try{const o=JSON.stringify({version:J,createdAt:n});localStorage.setItem(N,L),localStorage.setItem(q,o),sessionStorage.setItem(N,L),sessionStorage.setItem(q,o)}catch{}}window.__nightSkyCss=L,document.documentElement.style.setProperty("--night-sky",L),document.documentElement.style.setProperty("--app-bg",L)}function Be(){const e=[],t=typeof window<"u"?window.innerWidth:1200,o=typeof window<"u"?window.innerHeight:800;for(let a=0;a<28;a+=1){const l=Math.floor(Math.random()*t),c=Math.floor(Math.random()*o),r=(Math.random()*1.8+.6).toFixed(2),i=(Math.random()*.5+.35).toFixed(2),u=Math.random()<.25?`rgba(255, 238, 180, ${i})`:`rgba(255, 255, 255, ${i})`;e.push(`radial-gradient(circle at ${l}px ${c}px, ${u} 0 ${r}px, transparent ${(Number(r)+1.6).toFixed(2)}px)`)}if(Math.random()<$e){const a=Math.floor(Math.random()*t),l=Math.floor(Math.random()*(o*.6));e.push(`radial-gradient(circle at ${a}px ${l}px, rgba(255, 244, 190, 0.6) 0 6px, transparent 12px)`)}return e.push("linear-gradient(180deg, #05070f 0%, #0b1026 55%, #141b3f 100%)"),e.join(", ")}function je(){const e=()=>Math.random()<.7?Math.random()<.5?-15+Math.random()*20:95+Math.random()*20:15+Math.random()*70,n=(a,l)=>{const c=Math.round(e()),r=Math.round(e()),i=Math.floor(420+Math.random()*420),d=Math.floor(320+Math.random()*360),u=(l+Math.random()*.06).toFixed(2);return`radial-gradient(${i}px ${d}px at ${c}% ${r}%, rgba(${a}, ${u}), transparent 72%)`},t=["246, 226, 138","255, 181, 201","171, 228, 255","160, 255, 224","198, 176, 255","255, 214, 165"],o=[];for(let a=0;a<10;a+=1){const l=t[a%t.length];o.push(n(l,.045))}return o}function We(){if(!document.body.classList.contains("theme-night"))return;const e=document.querySelectorAll(".hero-card, .next-card, .notice-card, .route-card, .time-table");let n={};try{n=JSON.parse(sessionStorage.getItem(Q)||"{}")}catch{n={}}const t=a=>a.classList.contains("hero-card")?"hero":a.classList.contains("next-card")?"next":a.classList.contains("notice-card")?"notice":a.classList.contains("route-card")?"route":a.classList.contains("time-table")?"table":"card",o=location.pathname.replace(/\W+/g,"")||"route";e.forEach((a,l)=>{const c=t(a),r=`${o}:${c}:${l}`;n[r]||(n[r]=je());const[i,d,u]=n[r];a.style.setProperty("--card-glow-1",i),a.style.setProperty("--card-glow-2",d),a.style.setProperty("--card-glow-3",u)});try{sessionStorage.setItem(Q,JSON.stringify(n))}catch{}}function Ge(e,n){const t=document.querySelector("#routeSelect"),o=document.querySelector("#stopSelect"),a=document.querySelector("#stopSelectLabel"),l=document.querySelector("#stopSelectRow"),c=document.querySelector("#routeSearch"),r=document.querySelector("#stopSearch"),i=document.querySelector("#campusSelector");if(!t||!o)return;t.innerHTML=e.map(u=>`<option value="${u.id}">${u.name}${u.subtitle?` ${u.subtitle}`:""}</option>`).join(""),t.value=n.id;const d=b(n);if(t.disabled=!1,t.classList.remove("route-select--static"),d)o.innerHTML="";else{const u=_(n,s.serviceDay);o.innerHTML=u.map(p=>`<option value="${p.id}">${p.name}</option>`).join("")}if(d)o.disabled=!0;else{const u=_(n,s.serviceDay),p=u.find(g=>g.default)||u[0];s.stopId=u.some(g=>g.id===s.stopId)?s.stopId:p==null?void 0:p.id,o.value=s.stopId,o.disabled=u.length<=1}o.classList.toggle("is-hidden",d),o.style.display=d?"none":"inline-flex",o.hidden=d,o.setAttribute("aria-hidden",d?"true":"false"),o.tabIndex=d?-1:0,a&&(a.classList.toggle("is-hidden",d),a.hidden=d,a.style.display=d?"none":"inline-flex"),l&&(l.classList.toggle("is-hidden",d),l.hidden=d,l.style.display=d?"none":"flex"),i&&(i.style.display=d?"flex":"none"),x(t),x(o),t.onchange=u=>{s.routeId=u.target.value,s.stopId="",k()},o.onchange=u=>{s.stopId=u.target.value,k()},c&&(c.dataset.bound||(c.dataset.bound="true",c.addEventListener("input",()=>{s.routeSearch=c.value,x(t)})),c.value!==s.routeSearch&&(c.value=s.routeSearch)),r&&(r.dataset.bound||(r.dataset.bound="true",r.addEventListener("input",()=>{s.stopSearch=r.value,x(o)})),r.value!==s.stopSearch&&(r.value=s.stopSearch))}function Ke(e){const n=document.querySelector("#campusSelector");if(!n||!b(e))return;const t=n.querySelector("[data-campus-role='from']"),o=n.querySelector("[data-campus-role='to']"),a=n.querySelector("#campusSwap"),l=(i,d)=>{if(i!==d)return{fromId:i,toId:d};const u=C.find(p=>p.id!==i);return{fromId:i,toId:u?u.id:d}},c=i=>{const d=l(i,s.campusTo);s.campusFrom=d.fromId,s.campusTo=d.toId,k()},r=i=>{const d=l(s.campusFrom,i);s.campusFrom=d.fromId,s.campusTo=d.toId,k()};t&&(t.innerHTML=C.map(i=>`
        <button class="campus-pill ${i.id===s.campusFrom?"is-active":""}" data-campus-from="${i.id}">
          ${i.label}
        </button>
      `).join(""),t.querySelectorAll("[data-campus-from]").forEach(i=>{i.addEventListener("click",()=>c(i.dataset.campusFrom))})),o&&(o.innerHTML=C.map(i=>`
        <button class="campus-pill ${i.id===s.campusTo?"is-active":""} ${i.id===s.campusFrom?"is-disabled":""}" data-campus-to="${i.id}" ${i.id===s.campusFrom?"disabled":""}>
          ${i.label}
        </button>
      `).join(""),o.querySelectorAll("[data-campus-to]").forEach(i=>{i.addEventListener("click",()=>r(i.dataset.campusTo))})),a&&(a.onclick=()=>{const i=s.campusTo,d=s.campusFrom;s.campusFrom=i,s.campusTo=d,k()})}function Ve(e){const n=document.querySelector("#stopPills"),t=document.querySelector("#stopPillsToggle");if(!n)return;const o=n.closest("section");if(b(e)){o&&(o.style.display="none");return}if(e.stops.length<=1){o&&(o.style.display="none");return}o&&(o.style.display="block");const a=_(e,s.serviceDay);n.innerHTML=a.map(c=>`
      <button class="stop-pill ${c.id===s.stopId?"is-active":""}" data-stop="${c.id}">
        ${P(e.id,c.name)}
      </button>
    `).join("");const l=()=>{if(!t)return;const c=n.scrollHeight>n.clientHeight+4;t.style.display=c||s.stopPillsExpanded?"inline-flex":"none",t.innerHTML="",t.classList.toggle("is-open",s.stopPillsExpanded)};n.classList.toggle("is-collapsed",!s.stopPillsExpanded),n.querySelectorAll("[data-stop]").forEach(c=>{c.addEventListener("click",()=>{s.stopId=c.dataset.stop,k()})}),t&&(t.onclick=()=>{s.stopPillsExpanded=!s.stopPillsExpanded,n.classList.toggle("is-collapsed",!s.stopPillsExpanded),l()}),requestAnimationFrame(l)}function Ue(e,n){var d;const t=document.querySelector("#nextPanel");if(!t)return;if(s.serviceOverride){t.style.display="";const p=b(e)?`${T(s.campusFrom)} → ${T(s.campusTo)}`:`${n.name} 기준`;t.innerHTML=`
      <div class="next-header">
        <div>
          <h3>${e.name}</h3>
          <p>${p}</p>
        </div>
        <span class="next-badge">가까운 예정</span>
      </div>
      <div class="next-list">
        <div class="next-empty-inline">오늘 기준에서만 가까운 예정이 표시됩니다.</div>
      </div>
    `;return}const o=ae(s.now,s.serviceDay),a=R(e,s.serviceDay,((d=n.times)==null?void 0:d[s.serviceDay])||[],s.campusFrom,s.campusTo);if(a.length===0){t.style.display="none";return}t.style.display="";const l=a[a.length-1],c=ee(a,o-2,5),i=b(e)?`${T(s.campusFrom)} → ${T(s.campusTo)}`:`${n.name} 기준`;t.innerHTML=`
    <div class="next-header">
      <div>
        <h3>${e.name}</h3>
        <p>${i}</p>
      </div>
      <span class="next-badge">가까운 예정</span>
    </div>
    <div class="next-list">
      ${c.map(u=>`
          <div class="next-chip">
            ${u}
            ${l&&u===l?'<span class="last-tag">막차</span>':""}
          </div>
        `).join("")}
    </div>
    <p class="next-note">실시간 위치 아님 · 실제 운행과 차이 가능</p>
  `}function Ye(e,n){var c;const t=document.querySelector("#timeTable"),o=document.querySelector("#timeTableSection");if(!t)return;const a=R(e,s.serviceDay,((c=n.times)==null?void 0:c[s.serviceDay])||[],s.campusFrom,s.campusTo).slice().sort((r,i)=>B(r)-B(i)),l=a[a.length-1];if(a.length===0){t.innerHTML=`
      <div class="time-empty">
        선택한 운행일에는 시간표가 없습니다.
      </div>
    `,o&&(o.style.display="");return}o&&(o.style.display=""),t.innerHTML=a.map(r=>`
      <div class="time-row ${l&&r===l?"last-run":""}">
        <span>${r}</span>
        <span class="time-label">${l&&r===l?"막차":"예정"}</span>
      </div>
    `).join("")}function ze(e,n){var i;const t=document.querySelector("#routeNote");if(!t)return;const a=R(e,s.serviceDay,((i=n==null?void 0:n.times)==null?void 0:i[s.serviceDay])||[],s.campusFrom,s.campusTo).length===0?"선택한 운행일에는 운행하지 않습니다.":"",l=b(e)&&s.serviceDay==="weekend"&&s.campusFrom==="main"&&s.campusTo==="hwaam"?`주말에는 기사님께 요청하시면 화암관을 경유합니다.

단, 본교출발 11:30회차는 기사님 점심시간 확보를 위해 요청이 불가합니다.`:"",c=e.note||"",r=[a,l,c].filter(Boolean).join(`
`).trim();t.textContent=r,t.style.display=r?"":"none"}function Je(e,n){var u;const t=document.querySelector("#favoriteToggleRoute"),o=document.querySelector("#favoriteHelp");if(!t)return;const a=A(),l=b(e)?`${e.id}:${s.campusFrom}->${s.campusTo}`:`${e.id}:${s.stopId||n.id}`,r=(((u=n==null?void 0:n.times)==null?void 0:u[s.serviceDay])||[]).length===0,i=a.some(p=>p.key===l);t.textContent=i?"즐겨찾기 해제":"즐겨찾기 추가";const d=r&&!i;t.disabled=!1,t.classList.toggle("is-disabled",d),t.setAttribute("aria-disabled",d?"true":"false"),t.setAttribute("data-disabled",d?"true":"false"),o&&(r&&!i?(o.textContent="선택한 운행일에는 운행하지 않아 즐겨찾기를 추가할 수 없어요.",s.favoriteHelpVisible?(o.classList.add("is-visible"),o.setAttribute("aria-hidden","false")):(o.classList.remove("is-visible"),o.setAttribute("aria-hidden","true"))):(o.textContent="",o.classList.remove("is-visible"),o.setAttribute("aria-hidden","true")))}function k(){var o;s.now=new Date;const e=ce(E(s.now)),n=Y(e,s.routeId||((o=e[0])==null?void 0:o.id));if(!n)return;s.routeId=n.id,s.serviceDay=re(s.now,n);const t=de(n,s.serviceDay);ue(n),G(),K(s.now),Ge(e,n),Ke(n),Ue(n,t),Ye(n,t),ze(n,t),Ve(n),Je(n,t),ie(),We()}function Qe(){const e=document.querySelector("#serviceDayToggle");if(!e)return;const n=()=>{const t=E(s.now),o=s.serviceOverride||t;e.querySelectorAll("button[data-day]").forEach(a=>{const l=a.dataset.day,r=l==="auto"?!s.serviceOverride:l===o;a.classList.toggle("is-active",r)})};e.addEventListener("click",t=>{const o=t.target.closest("button[data-day]");if(!o)return;const a=o.dataset.day,l=E(s.now);a==="auto"?s.serviceOverride=null:s.serviceOverride=a===l?null:a,n(),k()}),n()}function Xe(){const e=document.querySelector("#favoriteToggleRoute"),n=document.querySelector("#favoriteHelp");if(!e)return;const t=()=>{n&&e.getAttribute("data-disabled")==="true"&&n.textContent.trim()&&(s.favoriteHelpVisible=!0,n.classList.add("is-visible"),n.setAttribute("aria-hidden","false"),n.classList.remove("is-flipped"),requestAnimationFrame(()=>{const a=n.getBoundingClientRect(),l=a.right>window.innerWidth-12,c=a.left<12;l&&!c&&n.classList.add("is-flipped")}))},o=()=>{n&&e.getAttribute("data-disabled")==="true"&&(s.favoriteHelpVisible=!1,n.classList.remove("is-visible"),n.setAttribute("aria-hidden","true"))};e.addEventListener("mouseenter",t),e.addEventListener("focus",t),e.addEventListener("mouseleave",o),e.addEventListener("blur",o),e.addEventListener("click",()=>{if(e.getAttribute("data-disabled")==="true"){s.favoriteHelpVisible?o():t();return}const a=A(),l=M.find(d=>d.id===s.routeId),c=l?de(l,s.serviceDay):null,r=l&&b(l)?`${l.id}:${s.campusFrom}->${s.campusTo}`:`${s.routeId}:${s.stopId}`,i=a.some(d=>d.key===r)?a.filter(d=>d.key!==r):[{key:r,routeId:s.routeId,stopId:(c==null?void 0:c.id)||s.stopId,campusFrom:l&&b(l)?s.campusFrom:void 0,campusTo:l&&b(l)?s.campusTo:void 0,savedAt:Date.now()},...a];localStorage.setItem(V,JSON.stringify(i.slice(0,10))),k()})}function Ze(){const e=document.querySelector("#shareLink");e&&e.addEventListener("click",async()=>{const n=new URL(qe(),window.location.origin).toString();try{await navigator.clipboard.writeText(n),e.textContent="복사됨!",window.setTimeout(()=>{e.textContent="링크 공유"},1200)}catch{window.prompt("링크를 복사해 주세요.",n)}})}function et(){const e=document.querySelector("[data-theme-toggle]");e&&(e.addEventListener("click",()=>{const n=document.body.classList.contains("theme-night");Oe(n?"light":"dark"),K(new Date)}),K(new Date))}function tt(){const e=document.querySelector("#favoriteDock"),n=document.querySelector("[data-favorite-tab]"),t=document.querySelector("#favoriteDockPanel");if(!e||!n)return;let o=!1;const a=()=>{n.classList.toggle("is-active",e.classList.contains("is-open"))},l=()=>{e.classList.add("is-open"),a(),r()},c=()=>{o||(e.classList.remove("is-open"),a())};e.addEventListener("mouseenter",()=>l()),e.addEventListener("mouseleave",()=>c()),n.addEventListener("mouseenter",()=>l()),n.addEventListener("mouseleave",()=>c()),e.addEventListener("click",()=>{o=!o,o?e.classList.add("is-open"):e.classList.remove("is-open"),a()}),n.addEventListener("click",()=>{o=!o,o?e.classList.add("is-open"):e.classList.remove("is-open"),a()});const r=()=>{if(!window.matchMedia("(max-width: 640px)").matches||!e.classList.contains("is-open"))return;const d=n.getBoundingClientRect();e.style.top=`${Math.round(d.bottom+8)}px`};document.addEventListener("click",i=>{e.classList.contains("is-open")&&(e.contains(i.target)||n.contains(i.target)||(o=!1,e.classList.remove("is-open"),a()))}),t&&(t.addEventListener("click",i=>{i.stopPropagation();const d=i.target.closest("[data-move-favorite]");if(d){const h=d.dataset.key,S=d.dataset.moveFavorite;if(!h||!S)return;const v=A(),m=v.findIndex(w=>w.key===h),f=S==="up"?m-1:m+1;if(m<0||f<0||f>=v.length)return;const y=v.slice();[y[m],y[f]]=[y[f],y[m]],j(y),ie(Y(M,s.routeId));return}const u=i.target.closest("[data-remove-favorite]");if(!u)return;const p=u.dataset.removeFavorite;if(!p)return;const g=A().filter(h=>h.key!==p);j(g),k()}),t.addEventListener("click",i=>{if(i.target.closest("[data-remove-favorite]")||i.target.closest("[data-move-favorite]"))return;const p=i.target.closest("[data-jump-route]");if(!p)return;const g=Ne({routeId:p.dataset.jumpRoute,stopId:p.dataset.jumpStop,campusFrom:p.dataset.jumpFrom,campusTo:p.dataset.jumpTo});window.location.href=g})),a(),window.addEventListener("scroll",r,{passive:!0}),window.addEventListener("resize",r),n.addEventListener("click",r),e.addEventListener("mouseenter",r)}function H(){const e=document.querySelector("header.navbar"),n=e==null?void 0:e.querySelector(".brand"),t=e==null?void 0:e.querySelector(".primary-nav"),o=t==null?void 0:t.querySelector(".nav-links"),a=t==null?void 0:t.querySelector(".nav-actions");if(!e||!n||!t||(e.classList.contains("is-wrapped")&&e.classList.remove("is-wrapped"),!o||!a))return;const c=Array.from(o.children).some(I=>I.scrollHeight>I.clientHeight+2),r=Array.from(a.children).some(I=>I.scrollHeight>I.clientHeight+2),i=parseFloat(getComputedStyle(e).gap||"0")||0,d=parseFloat(getComputedStyle(t).gap||"0")||0,u=I=>{const O=Array.from(I.children);if(!O.length)return 0;const me=parseFloat(getComputedStyle(I).gap||"0")||0;return O.reduce((fe,ve)=>fe+ve.getBoundingClientRect().width,0)+me*(O.length-1)},p=u(o)+u(a)+d,g=e.clientWidth-n.getBoundingClientRect().width-i,h=o.getBoundingClientRect(),S=a.getBoundingClientRect(),v=t.getBoundingClientRect(),m=e.getBoundingClientRect(),f=n.getBoundingClientRect(),y=h.right>S.left-8,w=v.left<f.right+8,$=v.right>m.right-8,F=p>g-_e,pe=c||r||y||w||$||F;e.classList.toggle("is-wrapped",pe)}function nt(){var e;H(),window.addEventListener("resize",H),window.addEventListener("load",H),(e=document.fonts)!=null&&e.ready&&document.fonts.ready.then(H)}function ot(){let e;window.addEventListener("resize",()=>{e&&window.clearTimeout(e),e=window.setTimeout(()=>{s.dropdownOpen&&se(),k()},120)})}function st(){var n;const e=(n=window.getSelection)==null?void 0:n.call(window);return e?!e.isCollapsed&&e.toString().trim().length>0:!1}(()=>{const e=new URLSearchParams(window.location.search),n=e.get("route"),t=e.get("stop"),o=e.get("from"),a=e.get("to"),l=e.get("day"),c=e.get("shared");if(n&&M.some(r=>r.id===n)&&(s.routeId=n),t&&(s.stopId=t),(l==="weekday"||l==="weekend")&&(s.serviceOverride=l),c==="1"&&(s.sharedFromLink=!0),o&&C.some(r=>r.id===o)&&(s.campusFrom=o),a&&C.some(r=>r.id===a)&&(s.campusTo=a),s.campusFrom===s.campusTo){const r=C.find(i=>i.id!==s.campusFrom);r&&(s.campusTo=r.id)}})();k();Xe();et();tt();Qe();Ze();nt();ot();setInterval(()=>{var e;if(s.dropdownOpen){s.now=new Date,G();const n=ce(E(s.now)),t=Y(n,s.routeId||((e=n[0])==null?void 0:e.id));t&&(s.serviceDay=re(s.now,t),ue(t));return}if(st()){s.now=new Date,G();return}k()},1e3);
