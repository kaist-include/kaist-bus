import{r as ge,f as he,a as ye,t as we,h as be,i as Se,b as Le,d as ee,e as P,j as ke,k as xe,l as z,g as Ee,m as Ie,c as Te}from"./recentSearch-Dr5NxNh1.js";const V="kaist-bus-favorites",te="kaist-bus-theme",N="kaist-bus-night-sky",q="kaist-bus-night-sky-meta",J="v2",Ce=24*60*60*1e3,De=1/7,Q="kaist-bus-card-glow";let L=null;const $e="campus-loop",C=[{id:"main",label:"본교",match:/본교/},{id:"munji",label:"문지",match:/문지/},{id:"hwaam",label:"화암",match:/화암/}],s={now:new Date,serviceDay:"weekday",serviceOverride:null,routeId:"",stopId:"",campusFrom:"main",campusTo:"munji",stopPillsExpanded:!1,dropdownOpen:!1,favoriteHelpVisible:!1,sharedFromLink:!1,routeSearch:"",stopSearch:""},$=new Map,_e=12,U=4*60;function Ae(e){const n=new Map;return e.forEach(t=>{if(!n.has(t.id)){n.set(t.id,{...t,stops:t.stops.map(d=>{var r,c;return{...d,times:{weekday:[...((r=d.times)==null?void 0:r.weekday)||[]],weekend:[...((c=d.times)==null?void 0:c.weekend)||[]]}}})});return}const o=n.get(t.id);!o.note&&t.note&&(o.note=t.note);const a=new Map(o.stops.map(d=>[d.name,d]));t.stops.forEach(d=>{var c,i;const r=a.get(d.name);if(!r){const l={...d,times:{weekday:[...((c=d.times)==null?void 0:c.weekday)||[]],weekend:[...((i=d.times)==null?void 0:i.weekend)||[]]}};o.stops.push(l),a.set(d.name,l);return}["weekday","weekend"].forEach(l=>{var h,g;const u=((h=r.times)==null?void 0:h[l])||[],p=((g=d.times)==null?void 0:g[l])||[];if(!u.length&&p.length){r.times[l]=[...p];return}p.forEach(S=>{u.includes(S)||u.push(S)})})})}),Array.from(n.values())}const M=Ae(ge.routes);function B(e){const[n,t]=e.split(":").map(Number);if(Number.isNaN(n)||Number.isNaN(t))return 0;let o=n*60+t;return n<4&&(o+=1440),o}function ne(e){return!e||e.length===0?null:Math.max(...e.map(B))}function oe(e,n){if(!e)return null;const t=e.stops.flatMap(o=>{var a;return((a=o.times)==null?void 0:a[n])||[]});return ne(t)}function _(e,n){const t=e.stops.filter(o=>{var a;return(((a=o.times)==null?void 0:a[n])||[]).length});return t.length?t:e.stops}function Me(e,n,t){const o=e.stops.filter(d=>d.id===n);return o.length?o.find(d=>{var r;return(((r=d.times)==null?void 0:r[t])||[]).length})||o[0]:null}function X(e){s.dropdownOpen=e,document.documentElement.classList.toggle("dropdown-open",e)}function se(){$.forEach(e=>{e.open&&e.close()})}function Fe(e){if($.has(e)){const c=$.get(e);return(!c.wrapper.isConnected||c.wrapper.previousSibling!==e)&&e.after(c.wrapper),c}const n=document.createElement("div");n.className="dropdown";const t=document.createElement("button");t.type="button",t.className="dropdown__button",t.setAttribute("aria-haspopup","listbox"),t.setAttribute("aria-expanded","false");const o=document.createElement("span");o.className="dropdown__label";const a=document.createElement("span");a.className="dropdown__chevron",t.append(o,a);const d=document.createElement("div");d.className="dropdown__list",d.setAttribute("role","listbox"),d.tabIndex=-1,n.append(t,d),e.after(n),e.classList.add("native-select"),e.setAttribute("aria-hidden","true"),e.tabIndex=-1;const r={wrapper:n,button:t,label:o,list:d,optionsKey:"",options:[],activeIndex:0,open:!1,openDropdown(){if(r.open)return;se(),r.open=!0,n.classList.add("is-open"),t.setAttribute("aria-expanded","true"),X(!0),r.syncActiveIndex(),d.tabIndex=-1;const c=/Android/i.test(navigator.userAgent||"");r.searchInput&&!c&&r.searchInput.focus()},close(){if(!r.open)return;r.open=!1,n.classList.remove("is-open"),t.setAttribute("aria-expanded","false"),d.tabIndex=-1,t.focus();const c=Array.from($.values()).some(i=>i.open);X(c)},syncActiveIndex(){const c=e.selectedIndex>=0?e.selectedIndex:0;r.setActive(c)},setActive(c){if(!r.options.length)return;const i=Math.max(0,Math.min(c,r.options.length-1));r.activeIndex=i,r.options.forEach((l,u)=>{const p=u===i;l.classList.toggle("is-active",p),l.setAttribute("aria-selected",p?"true":"false"),p&&l.scrollIntoView({block:"nearest"})})}};return n.addEventListener("pointerdown",()=>{r.ignoreDocumentClick=!0,window.setTimeout(()=>{r.ignoreDocumentClick=!1},0)}),d.addEventListener("pointerdown",()=>{r.ignoreDocumentClick=!0,window.setTimeout(()=>{r.ignoreDocumentClick=!1},0)}),t.addEventListener("click",()=>{r.open?r.close():r.openDropdown()}),t.addEventListener("keydown",c=>{if(c.key==="ArrowDown"||c.key==="ArrowUp"){if(c.preventDefault(),!r.open){r.openDropdown();return}r.setActive(r.activeIndex+(c.key==="ArrowDown"?1:-1));return}if(r.open&&c.key==="Enter"){c.preventDefault();const i=r.options[r.activeIndex];i&&(e.value=i.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),r.close());return}r.open&&c.key==="Escape"&&(c.preventDefault(),r.close())}),d.addEventListener("click",c=>{const i=c.target.closest(".dropdown__option");if(!i)return;const l=i.dataset.value;l!=null&&(e.value=l,e.dispatchEvent(new Event("change",{bubbles:!0})),r.close())}),d.addEventListener("keydown",c=>{if(c.key==="Escape"){c.preventDefault(),r.close();return}if(c.key==="ArrowDown"){c.preventDefault(),r.setActive(r.activeIndex+1);return}if(c.key==="ArrowUp"){c.preventDefault(),r.setActive(r.activeIndex-1);return}if(c.key==="Enter"){c.preventDefault();const i=r.options[r.activeIndex];i&&(e.value=i.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),r.close())}}),document.addEventListener("pointerdown",c=>{r.open&&(r.ignoreDocumentClick||n.contains(c.target)||r.close())}),$.set(e,r),r}function x(e,n=null){var S;const t=Fe(e),o=e.hidden||e.style.display==="none"||e.classList.contains("is-hidden");t.wrapper.style.display=o?"none":"",t.button.disabled=e.disabled,t.button.setAttribute("aria-disabled",e.disabled?"true":"false");const a=e.id==="routeSelect"||e.id==="stopSelect",d=a?e.id:"",r=Array.from(e.options).map(v=>({value:v.value,label:v.textContent})),c=e.id==="routeSelect"?s.routeSearch:e.id==="stopSelect"?s.stopSearch:"",i=n??c,l=[d,r.map(v=>`${v.value}:${v.label}`).join("|")].join("|");if(l!==t.optionsKey){if(t.optionsKey=l,a){if(!t.searchWrap){const v=document.createElement("div");v.className="dropdown__search";const m=document.createElement("input");m.type="search",m.className="dropdown__search-input",m.placeholder=e.id==="routeSelect"?"노선 검색":"정류장 검색",m.addEventListener("pointerdown",()=>{t.ignoreDocumentClick=!0});const f=document.createElement("button");f.type="button",f.className="search-clear search-clear--dropdown",f.setAttribute("aria-label","검색어 삭제"),f.textContent="×";const y=()=>{f.classList.toggle("is-visible",!!m.value)};m.addEventListener("compositionstart",()=>{t.isComposing=!0,t.compositionBase=e.id==="routeSelect"?s.routeSearch:s.stopSearch}),m.addEventListener("compositionupdate",()=>{x(e,m.value),y()}),m.addEventListener("compositionend",()=>{t.isComposing=!1,e.id==="routeSelect"?s.routeSearch=m.value:s.stopSearch=m.value,t.compositionBase="",x(e,m.value),y()}),m.addEventListener("input",()=>{if(t.isComposing){x(e,m.value),y();return}e.id==="routeSelect"?s.routeSearch=m.value:s.stopSearch=m.value,x(e,m.value),y()}),m.addEventListener("keydown",w=>{if(w.key!=="Enter")return;const D=e.id==="routeSelect"?"route":"stop";ke(D,m.value),x(e,m.value),y()}),f.addEventListener("click",()=>{m.value="",e.id==="routeSelect"?s.routeSearch="":s.stopSearch="",t.compositionBase="",x(e,""),y(),m.focus()}),v.append(m),v.append(f),t.searchWrap=v,t.searchInput=m,t.searchClear=f}!t.isComposing&&document.activeElement!==t.searchInput&&(t.searchInput.value=i||""),t.searchClear&&t.searchClear.classList.toggle("is-visible",!!t.searchInput.value),t.recentWrap||(t.recentWrap=document.createElement("div"),t.recentWrap.className="dropdown__recent",t.recentWrap.addEventListener("click",v=>{v.stopPropagation(),t.ignoreDocumentClick=!0;const m=v.target.closest("[data-recent]");if(!m)return;const f=m.dataset.recent||"";e.id==="routeSelect"?s.routeSearch=f:s.stopSearch=f,x(e,f)})),t.optionsContainer||(t.optionsContainer=document.createElement("div")),t.list.replaceChildren(t.searchWrap,t.recentWrap,t.optionsContainer)}else t.list.innerHTML="",t.optionsContainer=t.list;t.optionsContainer.innerHTML="",t.options=r.map((v,m)=>{const f=document.createElement("button");return f.type="button",f.className="dropdown__option",f.setAttribute("role","option"),f.dataset.value=v.value,f.dataset.label=v.label,f.addEventListener("mouseenter",()=>{t.setActive(m)}),t.optionsContainer.append(f),f})}const u=(v,m=v)=>{if(!t.optionsContainer)return;let f=0;t.options.forEach(w=>{const D=w.dataset.label||"",F=v?Ie(D,v):!0;w.style.display=F?"":"none",F&&(w.innerHTML=Te(D,m),f+=1)});const y=t.optionsContainer.querySelector(".dropdown__empty");if(f)y&&y.remove();else if(!y){const w=document.createElement("div");w.className="dropdown__empty",w.textContent="검색 결과가 없습니다.",t.optionsContainer.append(w)}return f};if(a&&t.searchInput&&!t.isComposing&&document.activeElement!==t.searchInput&&t.searchInput.value!==(i||"")&&(t.searchInput.value=i||""),a&&t.recentWrap){const v=e.id==="routeSelect"?"route":"stop",m=xe(v);t.recentWrap.innerHTML=m.length?`
        <div class="dropdown__recent-label">최근 검색</div>
        <div class="dropdown__recent-items">
          ${m.map(f=>`<button type="button" class="dropdown__recent-chip" data-recent="${z(f)}">${z(f)}</button>`).join("")}
        </div>
      `:`
        <div class="dropdown__recent-label">최근 검색</div>
        <div class="search-recent__empty">-</div>
      `}const p=(t.isComposing,i||""),h=u(i||"",p);if(t.isComposing&&(!h||h===0)){const v=i||"",m=Ee(v,r.map(f=>f.label||""),t.compositionBase);m&&u(m,t.isComposing?m:v)}const g=e.selectedIndex>=0?e.selectedIndex:0;t.label.textContent=((S=r[g])==null?void 0:S.label)||"",t.setActive(g)}function A(){try{const e=localStorage.getItem(V);return e?JSON.parse(e):[]}catch{return[]}}function j(e){localStorage.setItem(V,JSON.stringify(e))}function ie(e){const n=document.querySelector("#favoriteDockPanel"),t=document.querySelector("#favoriteDock"),o=document.querySelector("[data-favorite-tab]");if(!n)return;const a=A();if(!a.length){if(n.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,t&&t.classList.add("is-empty"),o){const i=t==null?void 0:t.classList.contains("is-open");o.classList.toggle("is-active",!!i)}return}t&&t.classList.remove("is-empty"),s.now.getHours()*60+s.now.getMinutes();const d=[],r=[];if(a.forEach(i=>{var y;const l=M.find(w=>w.id===i.routeId);if(!l)return;const u=Z(s.now,null,l);let p=Me(l,i.stopId,u);if(b(l)&&i.campusFrom&&(p=de({...l,stops:_(l,u)},i.campusFrom,i.campusTo)),!p)return;r.push(i);const h=Z(s.now,p,l),g=R(l,h,((y=p.times)==null?void 0:y[h])||[],i.campusFrom,i.campusTo),S=ae(s.now,h),v=g.length?ee(g,S-2,2):[],m=g[g.length-1],f=b(l)&&i.campusFrom?`${T(i.campusFrom)} → ${T(i.campusTo)}`:p.direction&&p.direction!==l.name?`${P(l.id,p.name)} → ${p.direction}`:`${P(l.id,p.name)}`;d.push({item:i,route:l,stop:p,label:f,upcoming:v,lastTime:m})}),r.length!==a.length&&j(r),!d.length){if(n.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,t&&t.classList.add("is-empty"),o){const i=t==null?void 0:t.classList.contains("is-open");o.classList.toggle("is-active",!!i)}return}const c=d.map((i,l)=>{const u=l===0,p=l===d.length-1;return`
      <div class="favorite-dock__item" ${[`data-jump-route="${i.route.id}"`,`data-jump-stop="${i.stop.id}"`,i.item.campusFrom?`data-jump-from="${i.item.campusFrom}"`:"",i.item.campusTo?`data-jump-to="${i.item.campusTo}"`:""].filter(Boolean).join(" ")}>
        <div class="favorite-dock__title">
          <span>${i.route.name}</span>
          <span>${i.label}</span>
        </div>
        <div class="favorite-dock__row">
          <div class="favorite-dock__times">
            ${i.upcoming.length?i.upcoming.map(g=>`
                      <span>
                        ${g}
                        ${i.lastTime&&g===i.lastTime?'<em class="last-tag">막차</em>':""}
                      </span>
                    `).join(""):'<span class="favorite-dock__empty-text">미운행</span>'}
          </div>
          <div class="favorite-dock__actions">
            <button class="favorite-dock__move" type="button" data-move-favorite="up" data-key="${i.item.key}" ${u?"disabled":""} aria-label="위로">
              ↑
            </button>
            <button class="favorite-dock__move" type="button" data-move-favorite="down" data-key="${i.item.key}" ${p?"disabled":""} aria-label="아래로">
              ↓
            </button>
            <button class="favorite-dock__remove" type="button" data-remove-favorite="${i.item.key}">
              삭제
            </button>
          </div>
        </div>
      </div>
    `});n.innerHTML=c.join("")}function E(e){const n=we(e);return be.forcedWeekends.includes(n)||Se(e)?"weekend":"weekday"}function Z(e,n,t){var p;const o=E(e),a=new Date(e);a.setDate(e.getDate()-1);const d=E(a);if(o===d)return o;const r=e.getHours()*60+e.getMinutes();if(r>=U)return o;const c=t?oe(t,d):ne(((p=n==null?void 0:n.times)==null?void 0:p[d])||[]),i=c!=null&&c>=r+1440,l=h=>{var g;return(((g=n==null?void 0:n.times)==null?void 0:g[h])||[]).length>0};let u=i?d:o;return u===d&&!l(d)&&l(o)&&(u=o),u===o&&!l(o)&&l(d)&&i&&(u=d),u}function ae(e,n){const t=e.getHours()*60+e.getMinutes(),o=E(e);return n!==o&&t<U?t+1440:t}function re(e,n){if(s.serviceOverride)return s.serviceOverride;if(!n)return E(e);const t=new Date(e);t.setDate(e.getDate()-1);const o=E(t),a=E(e);if(o===a)return a;const d=e.getHours()*60+e.getMinutes();if(d>=U)return a;const r=oe(n,o);return r==null?a:r>=d+1440?o:a}function ce(e){const n=["olev","campus-loop","wolpyeong","wolpyeong-early"];return M.sort((t,o)=>{const a=n.indexOf(t.id),d=n.indexOf(o.id),r=a===-1?Number.MAX_SAFE_INTEGER:a,c=d===-1?Number.MAX_SAFE_INTEGER:d;return r!==c?r-c:t.name.localeCompare(o.name)})}function Y(e,n){return e.find(t=>t.id===n)||e[0]}function Ne({routeId:e,stopId:n,campusFrom:t,campusTo:o}){const a=new URLSearchParams;e&&a.set("route",e),n&&a.set("stop",n),t&&a.set("from",t),o&&a.set("to",o),s.serviceOverride&&a.set("day",s.serviceOverride);const d=a.toString();return d?`./route.html?${d}`:"./route.html"}function qe(){const e=new URLSearchParams;return s.routeId&&e.set("route",s.routeId),s.stopId&&e.set("stop",s.stopId),s.campusFrom&&e.set("from",s.campusFrom),s.campusTo&&e.set("to",s.campusTo),s.serviceOverride&&e.set("day",s.serviceOverride),e.set("shared","1"),`./route.html?${e.toString()}`}function b(e){return(e==null?void 0:e.id)===$e}function T(e){var n;return((n=C.find(t=>t.id===e))==null?void 0:n.label)||e}function W(e){const n=C.find(t=>t.match.test(e));return n?n.id:null}function He(e,n){const t=W(e[n].name);for(let o=n+1;o<e.length;o+=1){const a=W(e[o].name);if(a&&a!==t)return a}return null}function de(e,n,t){const o=e.stops||[],a=o.map((c,i)=>({stop:c,index:i,campus:W(c.name)})).filter(c=>c.campus===n);if(!a.length)return o[0];const d=a.filter(c=>/출발/.test(c.stop.name)),r=d.length?d:a;if(t){const c=r.find(i=>He(o,i.index)===t);if(c)return c.stop}return r[0].stop}function R(e,n,t,o,a){return!b(e)||n!=="weekend"||o!=="main"||a!=="hwaam"?t:t.filter(d=>d.trim()!=="11:30")}function le(e,n){var d,r;const t=_(e,n);if(b(e)){let c=de({...e,stops:t},s.campusFrom,s.campusTo);return(((d=c==null?void 0:c.times)==null?void 0:d[n])||[]).length||(c=t.find(l=>{var u;return(((u=l.times)==null?void 0:u[n])||[]).length})||t[0]||e.stops[0]),c}let o=t.find(c=>c.id===s.stopId)||t.find(c=>c.default)||t[0]||e.stops[0];return(((r=o==null?void 0:o.times)==null?void 0:r[n])||[]).length||(o=t.find(c=>{var i;return(((i=c.times)==null?void 0:i[n])||[]).length})||t[0]||e.stops[0]),o}function ue(e){const n=document.querySelector("[data-route-title]"),t=document.querySelector("[data-route-subtitle]"),o=document.querySelector("[data-route-badge]"),a=document.querySelector("[data-weekday]"),d=document.querySelector("#shareNotice");if(n&&(n.textContent=e.name),t&&(t.textContent=b(e)?`${T(s.campusFrom)} → ${T(s.campusTo)}`:e.subtitle||""),d&&(d.textContent=s.sharedFromLink?"공유된 링크로 열림":"",d.style.display=d.textContent?"":"none"),o){const r=e.stops.some(c=>{var i;return(((i=c.times)==null?void 0:i.weekend)||[]).length});o.textContent=r?"매일 운영":"평일 운영",o.classList.toggle("is-daily",r),o.classList.toggle("is-weekday",!r)}if(a){const r=E(s.now)==="weekday"?"평일":"휴일";a.textContent=`${Le(s.now)} (${r}) ·`}}function G(){const e=document.querySelector("[data-clock]"),n=document.querySelector("[data-date]");if(!e||!n)return;e.textContent=he(s.now);const t=ye(s.now);n.textContent=t.replace(/^\d{4}년\s*/,"")}function Re(){try{return localStorage.getItem(te)}catch{return null}}function Oe(e){try{localStorage.setItem(te,e)}catch{}}function K(e){const n=Re();let t=!0;if(n==="dark")t=!1;else if(n==="light")t=!0;else{const a=e.getHours();t=a>=6&&a<18}document.body.classList.toggle("theme-night",!t),document.documentElement.classList.toggle("theme-night",!t);const o=document.querySelector('meta[name="theme-color"]');o&&o.setAttribute("content",t?"#e9ecff":"#05070f"),t?(document.documentElement.style.removeProperty("--night-sky"),document.documentElement.style.removeProperty("--app-bg")):Pe()}function Pe(){!L&&window.__nightSkyCss&&(L=window.__nightSkyCss);let e=null;try{e=JSON.parse(localStorage.getItem(q)||sessionStorage.getItem(q)||"null")}catch{e=null}const n=Date.now(),t=!e||e.version!==J||!e.createdAt||n-e.createdAt>Ce;if(!L&&!t)try{L=localStorage.getItem(N)||sessionStorage.getItem(N)}catch{L=null}if(!L||t){L=Be();try{const o=JSON.stringify({version:J,createdAt:n});localStorage.setItem(N,L),localStorage.setItem(q,o),sessionStorage.setItem(N,L),sessionStorage.setItem(q,o)}catch{}}window.__nightSkyCss=L,document.documentElement.style.setProperty("--night-sky",L),document.documentElement.style.setProperty("--app-bg",L)}function Be(){const e=[],t=typeof window<"u"?window.innerWidth:1200,o=typeof window<"u"?window.innerHeight:800;for(let a=0;a<28;a+=1){const d=Math.floor(Math.random()*t),r=Math.floor(Math.random()*o),c=(Math.random()*1.8+.6).toFixed(2),i=(Math.random()*.5+.35).toFixed(2),u=Math.random()<.25?`rgba(255, 238, 180, ${i})`:`rgba(255, 255, 255, ${i})`;e.push(`radial-gradient(circle at ${d}px ${r}px, ${u} 0 ${c}px, transparent ${(Number(c)+1.6).toFixed(2)}px)`)}if(Math.random()<De){const a=Math.floor(Math.random()*t),d=Math.floor(Math.random()*(o*.6));e.push(`radial-gradient(circle at ${a}px ${d}px, rgba(255, 244, 190, 0.6) 0 6px, transparent 12px)`)}return e.push("linear-gradient(180deg, #05070f 0%, #0b1026 55%, #141b3f 100%)"),e.join(", ")}function je(){const e=()=>Math.random()<.7?Math.random()<.5?-15+Math.random()*20:95+Math.random()*20:15+Math.random()*70,n=(a,d)=>{const r=Math.round(e()),c=Math.round(e()),i=Math.floor(420+Math.random()*420),l=Math.floor(320+Math.random()*360),u=(d+Math.random()*.06).toFixed(2);return`radial-gradient(${i}px ${l}px at ${r}% ${c}%, rgba(${a}, ${u}), transparent 72%)`},t=["246, 226, 138","255, 181, 201","171, 228, 255","160, 255, 224","198, 176, 255","255, 214, 165"],o=[];for(let a=0;a<10;a+=1){const d=t[a%t.length];o.push(n(d,.045))}return o}function We(){if(!document.body.classList.contains("theme-night"))return;const e=document.querySelectorAll(".hero-card, .next-card, .notice-card, .route-card, .time-table");let n={};try{n=JSON.parse(sessionStorage.getItem(Q)||"{}")}catch{n={}}const t=a=>a.classList.contains("hero-card")?"hero":a.classList.contains("next-card")?"next":a.classList.contains("notice-card")?"notice":a.classList.contains("route-card")?"route":a.classList.contains("time-table")?"table":"card",o=location.pathname.replace(/\W+/g,"")||"route";e.forEach((a,d)=>{const r=t(a),c=`${o}:${r}:${d}`;n[c]||(n[c]=je());const[i,l,u]=n[c];a.style.setProperty("--card-glow-1",i),a.style.setProperty("--card-glow-2",l),a.style.setProperty("--card-glow-3",u)});try{sessionStorage.setItem(Q,JSON.stringify(n))}catch{}}function Ge(e,n){const t=document.querySelector("#routeSelect"),o=document.querySelector("#stopSelect"),a=document.querySelector("#stopSelectLabel"),d=document.querySelector("#stopSelectRow"),r=document.querySelector("#routeSearch"),c=document.querySelector("#stopSearch"),i=document.querySelector("#campusSelector");if(!t||!o)return;t.innerHTML=e.map(u=>`<option value="${u.id}">${u.name}${u.subtitle?` ${u.subtitle}`:""}</option>`).join(""),t.value=n.id;const l=b(n);if(t.disabled=!1,t.classList.remove("route-select--static"),l)o.innerHTML="";else{const u=_(n,s.serviceDay);o.innerHTML=u.map(p=>`<option value="${p.id}">${p.name}</option>`).join("")}if(l)o.disabled=!0;else{const u=_(n,s.serviceDay),p=u.find(h=>h.default)||u[0];s.stopId=u.some(h=>h.id===s.stopId)?s.stopId:p==null?void 0:p.id,o.value=s.stopId,o.disabled=u.length<=1}o.classList.toggle("is-hidden",l),o.style.display=l?"none":"inline-flex",o.hidden=l,o.setAttribute("aria-hidden",l?"true":"false"),o.tabIndex=l?-1:0,a&&(a.classList.toggle("is-hidden",l),a.hidden=l,a.style.display=l?"none":"inline-flex"),d&&(d.classList.toggle("is-hidden",l),d.hidden=l,d.style.display=l?"none":"flex"),i&&(i.style.display=l?"flex":"none"),x(t),x(o),t.onchange=u=>{s.routeId=u.target.value,s.stopId="",k()},o.onchange=u=>{s.stopId=u.target.value,k()},r&&(r.dataset.bound||(r.dataset.bound="true",r.addEventListener("input",()=>{s.routeSearch=r.value,x(t)})),r.value!==s.routeSearch&&(r.value=s.routeSearch)),c&&(c.dataset.bound||(c.dataset.bound="true",c.addEventListener("input",()=>{s.stopSearch=c.value,x(o)})),c.value!==s.stopSearch&&(c.value=s.stopSearch))}function Ke(e){const n=document.querySelector("#campusSelector");if(!n||!b(e))return;const t=n.querySelector("[data-campus-role='from']"),o=n.querySelector("[data-campus-role='to']"),a=n.querySelector("#campusSwap"),d=(i,l)=>{if(i!==l)return{fromId:i,toId:l};const u=C.find(p=>p.id!==i);return{fromId:i,toId:u?u.id:l}},r=i=>{const l=d(i,s.campusTo);s.campusFrom=l.fromId,s.campusTo=l.toId,k()},c=i=>{const l=d(s.campusFrom,i);s.campusFrom=l.fromId,s.campusTo=l.toId,k()};t&&(t.innerHTML=C.map(i=>`
        <button class="campus-pill ${i.id===s.campusFrom?"is-active":""}" data-campus-from="${i.id}">
          ${i.label}
        </button>
      `).join(""),t.querySelectorAll("[data-campus-from]").forEach(i=>{i.addEventListener("click",()=>r(i.dataset.campusFrom))})),o&&(o.innerHTML=C.map(i=>`
        <button class="campus-pill ${i.id===s.campusTo?"is-active":""} ${i.id===s.campusFrom?"is-disabled":""}" data-campus-to="${i.id}" ${i.id===s.campusFrom?"disabled":""}>
          ${i.label}
        </button>
      `).join(""),o.querySelectorAll("[data-campus-to]").forEach(i=>{i.addEventListener("click",()=>c(i.dataset.campusTo))})),a&&(a.onclick=()=>{const i=s.campusTo,l=s.campusFrom;s.campusFrom=i,s.campusTo=l,k()})}function Ve(e){const n=document.querySelector("#stopPills"),t=document.querySelector("#stopPillsToggle");if(!n)return;const o=n.closest("section");if(b(e)){o&&(o.style.display="none");return}if(e.stops.length<=1){o&&(o.style.display="none");return}o&&(o.style.display="block");const a=_(e,s.serviceDay);n.innerHTML=a.map(r=>`
      <button class="stop-pill ${r.id===s.stopId?"is-active":""}" data-stop="${r.id}">
        ${P(e.id,r.name)}
      </button>
    `).join("");const d=()=>{if(!t)return;const r=n.scrollHeight>n.clientHeight+4;t.style.display=r||s.stopPillsExpanded?"inline-flex":"none",t.innerHTML="",t.classList.toggle("is-open",s.stopPillsExpanded)};n.classList.toggle("is-collapsed",!s.stopPillsExpanded),n.querySelectorAll("[data-stop]").forEach(r=>{r.addEventListener("click",()=>{s.stopId=r.dataset.stop,k()})}),t&&(t.onclick=()=>{s.stopPillsExpanded=!s.stopPillsExpanded,n.classList.toggle("is-collapsed",!s.stopPillsExpanded),d()}),requestAnimationFrame(d)}function Ue(e,n){var l;const t=document.querySelector("#nextPanel");if(!t)return;if(s.serviceOverride){t.style.display="";const p=b(e)?`${T(s.campusFrom)} → ${T(s.campusTo)}`:`${n.name} 기준`;t.innerHTML=`
      <div class="next-header">
        <div>
          <h3>${e.name}</h3>
          <p>${p}</p>
        </div>
        <span class="next-badge">가까운 예정</span>
      </div>
      <div class="next-list">
        <div class="next-empty-inline">오늘 기준에서만 가까운 예정이 표시됩니다.</div>
      </div>
    `;return}const o=ae(s.now,s.serviceDay),a=R(e,s.serviceDay,((l=n.times)==null?void 0:l[s.serviceDay])||[],s.campusFrom,s.campusTo);if(a.length===0){t.style.display="none";return}t.style.display="";const d=a[a.length-1],r=ee(a,o-2,5),i=b(e)?`${T(s.campusFrom)} → ${T(s.campusTo)}`:`${n.name} 기준`;t.innerHTML=`
    <div class="next-header">
      <div>
        <h3>${e.name}</h3>
        <p>${i}</p>
      </div>
      <span class="next-badge">가까운 예정</span>
    </div>
    <div class="next-list">
      ${r.map(u=>`
          <div class="next-chip">
            ${u}
            ${d&&u===d?'<span class="last-tag">막차</span>':""}
          </div>
        `).join("")}
    </div>
    <p class="next-note">실시간 위치 아님 · 실제 운행과 차이 가능</p>
  `}function Ye(e,n){var r;const t=document.querySelector("#timeTable"),o=document.querySelector("#timeTableSection");if(!t)return;const a=R(e,s.serviceDay,((r=n.times)==null?void 0:r[s.serviceDay])||[],s.campusFrom,s.campusTo).slice().sort((c,i)=>B(c)-B(i)),d=a[a.length-1];if(a.length===0){t.innerHTML=`
      <div class="time-empty">
        선택한 운행일에는 시간표가 없습니다.
      </div>
    `,o&&(o.style.display="");return}o&&(o.style.display=""),t.innerHTML=a.map(c=>`
      <div class="time-row ${d&&c===d?"last-run":""}">
        <span>${c}</span>
        <span class="time-label">${d&&c===d?"막차":"예정"}</span>
      </div>
    `).join("")}function ze(e,n){var i;const t=document.querySelector("#routeNote");if(!t)return;const a=R(e,s.serviceDay,((i=n==null?void 0:n.times)==null?void 0:i[s.serviceDay])||[],s.campusFrom,s.campusTo).length===0?"선택한 운행일에는 운행하지 않습니다.":"",d=b(e)&&s.serviceDay==="weekend"&&s.campusFrom==="main"&&s.campusTo==="hwaam"?`주말에는 기사님께 요청하시면 화암관을 경유합니다.

단, 본교출발 11:30회차는 기사님 점심시간 확보를 위해 요청이 불가합니다.`:"",r=e.note||"",c=[a,d,r].filter(Boolean).join(`
`).trim();t.textContent=c,t.style.display=c?"":"none"}function Je(e,n){var u;const t=document.querySelector("#favoriteToggleRoute"),o=document.querySelector("#favoriteHelp");if(!t)return;const a=A(),d=b(e)?`${e.id}:${s.campusFrom}->${s.campusTo}`:`${e.id}:${s.stopId||n.id}`,c=(((u=n==null?void 0:n.times)==null?void 0:u[s.serviceDay])||[]).length===0,i=a.some(p=>p.key===d);t.textContent=i?"즐겨찾기 해제":"즐겨찾기 추가";const l=c&&!i;t.disabled=!1,t.classList.toggle("is-disabled",l),t.setAttribute("aria-disabled",l?"true":"false"),t.setAttribute("data-disabled",l?"true":"false"),o&&(c&&!i?(o.textContent="선택한 운행일에는 운행하지 않아 즐겨찾기를 추가할 수 없어요.",s.favoriteHelpVisible?(o.classList.add("is-visible"),o.setAttribute("aria-hidden","false")):(o.classList.remove("is-visible"),o.setAttribute("aria-hidden","true"))):(o.textContent="",o.classList.remove("is-visible"),o.setAttribute("aria-hidden","true")))}function k(){var o;s.now=new Date;const e=ce(E(s.now)),n=Y(e,s.routeId||((o=e[0])==null?void 0:o.id));if(!n)return;s.routeId=n.id,s.serviceDay=re(s.now,n);const t=le(n,s.serviceDay);ue(n),G(),K(s.now),Ge(e,n),Ke(n),Ue(n,t),Ye(n,t),ze(n,t),Ve(n),Je(n,t),ie(),We()}function Qe(){const e=document.querySelector("#serviceDayToggle");if(!e)return;const n=()=>{const t=E(s.now),o=s.serviceOverride||t;e.querySelectorAll("button[data-day]").forEach(a=>{const d=a.dataset.day,c=d==="auto"?!s.serviceOverride:d===o;a.classList.toggle("is-active",c)})};e.addEventListener("click",t=>{const o=t.target.closest("button[data-day]");if(!o)return;const a=o.dataset.day,d=E(s.now);a==="auto"?s.serviceOverride=null:s.serviceOverride=a===d?null:a,n(),k()}),n()}function Xe(){const e=document.querySelector("#favoriteToggleRoute"),n=document.querySelector("#favoriteHelp");if(!e)return;const t=()=>{n&&e.getAttribute("data-disabled")==="true"&&n.textContent.trim()&&(s.favoriteHelpVisible=!0,n.classList.add("is-visible"),n.setAttribute("aria-hidden","false"),n.classList.remove("is-flipped"),requestAnimationFrame(()=>{const a=n.getBoundingClientRect(),d=a.right>window.innerWidth-12,r=a.left<12;d&&!r&&n.classList.add("is-flipped")}))},o=()=>{n&&e.getAttribute("data-disabled")==="true"&&(s.favoriteHelpVisible=!1,n.classList.remove("is-visible"),n.setAttribute("aria-hidden","true"))};e.addEventListener("mouseenter",t),e.addEventListener("focus",t),e.addEventListener("mouseleave",o),e.addEventListener("blur",o),e.addEventListener("click",()=>{if(e.getAttribute("data-disabled")==="true"){s.favoriteHelpVisible?o():t();return}const a=A(),d=M.find(l=>l.id===s.routeId),r=d?le(d,s.serviceDay):null,c=d&&b(d)?`${d.id}:${s.campusFrom}->${s.campusTo}`:`${s.routeId}:${s.stopId}`,i=a.some(l=>l.key===c)?a.filter(l=>l.key!==c):[{key:c,routeId:s.routeId,stopId:(r==null?void 0:r.id)||s.stopId,campusFrom:d&&b(d)?s.campusFrom:void 0,campusTo:d&&b(d)?s.campusTo:void 0,savedAt:Date.now()},...a];localStorage.setItem(V,JSON.stringify(i.slice(0,10))),k()})}function Ze(){const e=document.querySelector("#shareLink");e&&e.addEventListener("click",async()=>{const n=new URL(qe(),window.location.origin).toString();try{await navigator.clipboard.writeText(n),e.textContent="복사됨!",window.setTimeout(()=>{e.textContent="링크 공유"},1200)}catch{window.prompt("링크를 복사해 주세요.",n)}})}function et(){const e=document.querySelector("[data-theme-toggle]");e&&(e.addEventListener("click",()=>{const n=document.body.classList.contains("theme-night");Oe(n?"light":"dark"),K(new Date)}),K(new Date))}function tt(){const e=document.querySelector("#favoriteDock"),n=document.querySelector("[data-favorite-tab]"),t=document.querySelector("#favoriteDockPanel");if(!e||!n)return;let o=!1;const a=()=>{n.classList.toggle("is-active",e.classList.contains("is-open"))},d=()=>{e.classList.add("is-open"),a(),c()},r=()=>{o||(e.classList.remove("is-open"),a())};e.addEventListener("mouseenter",()=>d()),e.addEventListener("mouseleave",()=>r()),n.addEventListener("mouseenter",()=>d()),n.addEventListener("mouseleave",()=>r()),e.addEventListener("click",()=>{o=!o,o?e.classList.add("is-open"):e.classList.remove("is-open"),a()}),n.addEventListener("click",()=>{o=!o,o?e.classList.add("is-open"):e.classList.remove("is-open"),a()});const c=()=>{if(!window.matchMedia("(max-width: 640px)").matches||!e.classList.contains("is-open"))return;const l=n.getBoundingClientRect();e.style.top=`${Math.round(l.bottom+8)}px`};document.addEventListener("click",i=>{e.classList.contains("is-open")&&(e.contains(i.target)||n.contains(i.target)||(o=!1,e.classList.remove("is-open"),a()))}),t&&(t.addEventListener("click",i=>{i.stopPropagation();const l=i.target.closest("[data-move-favorite]");if(l){const g=l.dataset.key,S=l.dataset.moveFavorite;if(!g||!S)return;const v=A(),m=v.findIndex(w=>w.key===g),f=S==="up"?m-1:m+1;if(m<0||f<0||f>=v.length)return;const y=v.slice();[y[m],y[f]]=[y[f],y[m]],j(y),ie(Y(M,s.routeId));return}const u=i.target.closest("[data-remove-favorite]");if(!u)return;const p=u.dataset.removeFavorite;if(!p)return;const h=A().filter(g=>g.key!==p);j(h),k()}),t.addEventListener("click",i=>{if(i.target.closest("[data-remove-favorite]")||i.target.closest("[data-move-favorite]"))return;const p=i.target.closest("[data-jump-route]");if(!p)return;const h=Ne({routeId:p.dataset.jumpRoute,stopId:p.dataset.jumpStop,campusFrom:p.dataset.jumpFrom,campusTo:p.dataset.jumpTo});window.location.href=h})),a(),window.addEventListener("scroll",c,{passive:!0}),window.addEventListener("resize",c),n.addEventListener("click",c),e.addEventListener("mouseenter",c)}function H(){const e=document.querySelector("header.navbar"),n=e==null?void 0:e.querySelector(".brand"),t=e==null?void 0:e.querySelector(".primary-nav"),o=t==null?void 0:t.querySelector(".nav-links"),a=t==null?void 0:t.querySelector(".nav-actions");if(!e||!n||!t||(e.classList.contains("is-wrapped")&&e.classList.remove("is-wrapped"),!o||!a))return;const r=Array.from(o.children).some(I=>I.scrollHeight>I.clientHeight+2),c=Array.from(a.children).some(I=>I.scrollHeight>I.clientHeight+2),i=parseFloat(getComputedStyle(e).gap||"0")||0,l=parseFloat(getComputedStyle(t).gap||"0")||0,u=I=>{const O=Array.from(I.children);if(!O.length)return 0;const me=parseFloat(getComputedStyle(I).gap||"0")||0;return O.reduce((fe,ve)=>fe+ve.getBoundingClientRect().width,0)+me*(O.length-1)},p=u(o)+u(a)+l,h=e.clientWidth-n.getBoundingClientRect().width-i,g=o.getBoundingClientRect(),S=a.getBoundingClientRect(),v=t.getBoundingClientRect(),m=e.getBoundingClientRect(),f=n.getBoundingClientRect(),y=g.right>S.left-8,w=v.left<f.right+8,D=v.right>m.right-8,F=p>h-_e,pe=r||c||y||w||D||F;e.classList.toggle("is-wrapped",pe)}function nt(){var e;H(),window.addEventListener("resize",H),window.addEventListener("load",H),(e=document.fonts)!=null&&e.ready&&document.fonts.ready.then(H)}function ot(){let e;window.addEventListener("resize",()=>{e&&window.clearTimeout(e),e=window.setTimeout(()=>{s.dropdownOpen&&se(),k()},120)})}function st(){var n;const e=(n=window.getSelection)==null?void 0:n.call(window);return e?!e.isCollapsed&&e.toString().trim().length>0:!1}(()=>{const e=new URLSearchParams(window.location.search),n=e.get("route"),t=e.get("stop"),o=e.get("from"),a=e.get("to"),d=e.get("day"),r=e.get("shared");if(n&&M.some(c=>c.id===n)&&(s.routeId=n),t&&(s.stopId=t),(d==="weekday"||d==="weekend")&&(s.serviceOverride=d),r==="1"&&(s.sharedFromLink=!0),o&&C.some(c=>c.id===o)&&(s.campusFrom=o),a&&C.some(c=>c.id===a)&&(s.campusTo=a),s.campusFrom===s.campusTo){const c=C.find(i=>i.id!==s.campusFrom);c&&(s.campusTo=c.id)}})();k();Xe();et();tt();Qe();Ze();nt();ot();setInterval(()=>{var e;if(s.dropdownOpen){s.now=new Date,G();const n=ce(E(s.now)),t=Y(n,s.routeId||((e=n[0])==null?void 0:e.id));t&&(s.serviceDay=re(s.now,t),ue(t));return}if(st()){s.now=new Date,G();return}k()},1e3);
