import{t as te,h as V,i as ke,r as be,f as Le,a as Ee,b as $e,g as ne,c as R}from"./stopLabels-IBM8Cyxe.js";const Me=[{id:"notice-2026-02-01",title:"2월 1일 설 연휴 운행 안내",body:"해당일은 휴일 시간표로 운행됩니다. 출발 전 꼭 시간표를 확인해 주세요.",startDate:"2026-01-28",endDate:"2026-02-02",tag:"휴일"},{id:"notice-2026-02-25",title:"2월 25일 특별휴일 운행",body:"특별 휴일 시간표가 적용됩니다.",startDate:"2026-02-24",endDate:"2026-02-26",tag:"공지"}],Ie=[{id:"wolpyeong",name:"월평-본교-시내 순환셔틀",stops:[{routeId:"wolpyeong",stopId:"stop-1"}]},{id:"wolpyeong-early",name:"월평-유성온천역-본교 (얼리월평 셔틀)",stops:[{routeId:"wolpyeong-early",stopId:"stop-1"}]},{id:"campus-loop",name:"본교-문지-화암 왕복셔틀",stops:[{routeId:"campus-loop",stopId:"stop-2"}]},{id:"olev",name:"OLEV 교내셔틀",stops:[{routeId:"olev",stopId:"stop-1"}]}],xe={destinations:Ie},Te=["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];function b(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function De(e){let t="";for(const o of e){const n=o.charCodeAt(0);if(n>=44032&&n<=55203){const a=Math.floor((n-44032)/588);t+=Te[a]||""}else t+=o}return t}function oe(e){return e&&/^[ㄱ-ㅎ]+$/.test(e)}function U(e,t){const o=e.toLowerCase();return!t||o.includes(t)?!0:oe(t)?De(e).includes(t):!1}function q(e,t){if(!t||oe(t))return b(e);const n=e.toLowerCase().indexOf(t);if(n===-1)return b(e);const a=b(e.slice(0,n)),s=b(e.slice(n,n+t.length)),r=b(e.slice(n+t.length));return`${a}<mark class="search-highlight">${s}</mark>${r}`}const se="kaist-bus-favorites",ae="kaist-bus-theme",D="kaist-bus-night-sky",C="kaist-bus-night-sky-meta",Q="v2",Ce=24*60*60*1e3,_e=1/7,N="kaist-bus-card-glow",re="kaist-bus-recent-search";let w=null;const Re="campus-loop",Ne=12,Y=4*60,ie=[{id:"main",label:"본교",match:/본교/},{id:"munji",label:"문지",match:/문지/},{id:"hwaam",label:"화암",match:/화암/}];function Ae(e){const t=new Map;return e.forEach(o=>{if(!t.has(o.id)){t.set(o.id,{...o,stops:o.stops.map(s=>{var r,c;return{...s,times:{weekday:[...((r=s.times)==null?void 0:r.weekday)||[]],weekend:[...((c=s.times)==null?void 0:c.weekend)||[]]}}})});return}const n=t.get(o.id);!n.note&&o.note&&(n.note=o.note);const a=new Map(n.stops.map(s=>[s.name,s]));o.stops.forEach(s=>{var c,l;const r=a.get(s.name);if(!r){const m={...s,times:{weekday:[...((c=s.times)==null?void 0:c.weekday)||[]],weekend:[...((l=s.times)==null?void 0:l.weekend)||[]]}};n.stops.push(m),a.set(s.name,m);return}["weekday","weekend"].forEach(m=>{var h,p;const i=((h=r.times)==null?void 0:h[m])||[],u=((p=s.times)==null?void 0:p[m])||[];if(!i.length&&u.length){r.times[m]=[...u];return}u.forEach(f=>{i.includes(f)||i.push(f)})})})}),Array.from(t.values())}const x=Ae(be.routes);function ce(e,t){const o=e.stops.filter(n=>{var a;return(((a=n.times)==null?void 0:a[t])||[]).length});return o.length?o:e.stops}function le(e,t,o){const n=e.stops.filter(s=>s.id===t);return n.length?n.find(s=>{var r;return(((r=s.times)==null?void 0:r[o])||[]).length})||n[0]:null}function Fe(e){const[t,o]=e.split(":").map(Number);if(Number.isNaN(t)||Number.isNaN(o))return 0;let n=t*60+o;return t<4&&(n+=1440),n}function de(e){return!e||e.length===0?null:Math.max(...e.map(Fe))}function je(e,t){if(!e)return null;const o=e.stops.flatMap(n=>{var a;return((a=n.times)==null?void 0:a[t])||[]});return de(o)}function A(e,t,o){var u;const n=j(e),a=new Date(e);a.setDate(e.getDate()-1);const s=j(a);if(n===s)return n;const r=e.getHours()*60+e.getMinutes();if(r>=Y)return n;const c=o?je(o,s):de(((u=t==null?void 0:t.times)==null?void 0:u[s])||[]),l=c!=null&&c>=r+1440,m=h=>{var p;return(((p=t==null?void 0:t.times)==null?void 0:p[h])||[]).length>0};let i=l?s:n;return i===s&&!m(s)&&m(n)&&(i=n),i===n&&!m(n)&&m(s)&&l&&(i=s),i}const d={now:new Date,serviceDay:"weekday",holidayLabel:"",selectedRouteId:"",selectedStopId:"",selectedDestinationId:"",routeSearch:"",routeSearchBase:"",routeSearchComposing:!1,routeSearchStable:"",routeSearchLastHtml:"",routeSearchActive:!1,glowLocked:!1};function M(){try{const e=localStorage.getItem(se);return e?JSON.parse(e):[]}catch{return[]}}function ue(){try{const e=localStorage.getItem(re);return e?JSON.parse(e):[]}catch{return[]}}function He(e){localStorage.setItem(re,JSON.stringify(e))}function X(e){const t=e.trim();if(!t||t.length<2)return;const o=ue(),n=[t,...o.filter(a=>a.toLowerCase()!==t.toLowerCase())];He(n.slice(0,6))}function I(e){return(e==null?void 0:e.id)===Re}function F(e){var t;return((t=ie.find(o=>o.id===e))==null?void 0:t.label)||e}function P(e){const t=ie.find(o=>o.match.test(e));return t?t.id:null}function Be(e,t){const o=P(e[t].name);for(let n=t+1;n<e.length;n+=1){const a=P(e[n].name);if(a&&a!==o)return a}return null}function me(e,t,o){const n=e.stops||[],a=n.map((c,l)=>({stop:c,index:l,campus:P(c.name)})).filter(c=>c.campus===t);if(!a.length)return n[0];const s=a.filter(c=>/출발/.test(c.stop.name)),r=s.length?s:a;if(o){const c=r.find(l=>Be(n,l.index)===o);if(c)return c.stop}return r[0].stop}function pe(e,t,o,n,a){return!I(e)||t!=="weekend"||n!=="main"||a!=="hwaam"?o:o.filter(s=>s.trim()!=="11:30")}function G(e){localStorage.setItem(se,JSON.stringify(e))}function z(e){var o;const t=te(e);return V.forcedWeekends.includes(t)?{day:"weekend",label:((o=V.labels)==null?void 0:o[t])||"휴일"}:ke(e)?{day:"weekend",label:"주말"}:{day:"weekday",label:"평일"}}function j(e){return z(e).day}function Oe(){try{return localStorage.getItem(ae)}catch{return null}}function qe(e){try{localStorage.setItem(ae,e)}catch{}}function K(e){const t=Oe();let o=!0;if(t==="dark")o=!1;else if(t==="light")o=!0;else{const a=e.getHours();o=a>=6&&a<18}document.body.classList.toggle("theme-night",!o),document.documentElement.classList.toggle("theme-night",!o);const n=document.querySelector('meta[name="theme-color"]');n&&n.setAttribute("content",o?"#e9ecff":"#05070f"),o?(document.documentElement.style.removeProperty("--night-sky"),document.documentElement.style.removeProperty("--app-bg")):Pe()}function Pe(){!w&&window.__nightSkyCss&&(w=window.__nightSkyCss);let e=null;try{e=JSON.parse(localStorage.getItem(C)||sessionStorage.getItem(C)||"null")}catch{e=null}const t=Date.now(),o=!e||e.version!==Q||!e.createdAt||t-e.createdAt>Ce;if(!w&&!o)try{w=localStorage.getItem(D)||sessionStorage.getItem(D)}catch{w=null}if(!w||o){w=Ge();try{const n=JSON.stringify({version:Q,createdAt:t});localStorage.setItem(D,w),localStorage.setItem(C,n),sessionStorage.setItem(D,w),sessionStorage.setItem(C,n)}catch{}}window.__nightSkyCss=w,document.documentElement.style.setProperty("--night-sky",w),document.documentElement.style.setProperty("--app-bg",w)}function Ge(){const e=[],o=typeof window<"u"?window.innerWidth:1200,n=typeof window<"u"?window.innerHeight:800;for(let a=0;a<28;a+=1){const s=Math.floor(Math.random()*o),r=Math.floor(Math.random()*n),c=(Math.random()*1.8+.6).toFixed(2),l=(Math.random()*.5+.35).toFixed(2),i=Math.random()<.25?`rgba(255, 238, 180, ${l})`:`rgba(255, 255, 255, ${l})`;e.push(`radial-gradient(circle at ${s}px ${r}px, ${i} 0 ${c}px, transparent ${(Number(c)+1.6).toFixed(2)}px)`)}if(Math.random()<_e){const a=Math.floor(Math.random()*o),s=Math.floor(Math.random()*(n*.6));e.push(`radial-gradient(circle at ${a}px ${s}px, rgba(255, 244, 190, 0.6) 0 6px, transparent 12px)`)}return e.push("linear-gradient(180deg, #05070f 0%, #0b1026 55%, #141b3f 100%)"),e.join(", ")}function fe(){const e=()=>Math.random()<.7?Math.random()<.5?-15+Math.random()*20:95+Math.random()*20:15+Math.random()*70,t=(a,s)=>{const r=Math.round(e()),c=Math.round(e()),l=Math.floor(420+Math.random()*420),m=Math.floor(320+Math.random()*360),i=(s+Math.random()*.06).toFixed(2);return`radial-gradient(${l}px ${m}px at ${r}% ${c}%, rgba(${a}, ${i}), transparent 72%)`},o=["246, 226, 138","255, 181, 201","171, 228, 255","160, 255, 224","198, 176, 255","255, 214, 165"],n=[];for(let a=0;a<10;a+=1){const s=o[a%o.length];n.push(t(s,.045))}return n}function he(){if(!document.body.classList.contains("theme-night"))return;const e=document.querySelectorAll(".hero-card, .next-card, .notice-card, .time-table");let t={};try{t=JSON.parse(sessionStorage.getItem(N)||"{}")}catch{t={}}const o=s=>s.classList.contains("hero-card")?"hero":s.classList.contains("next-card")?"next":s.classList.contains("notice-card")?"notice":s.classList.contains("route-card")?"route":s.classList.contains("time-table")?"table":"card",n=location.pathname.replace(/\W+/g,"")||"index",a={};for(const s of e){const r=o(s),c=a[r]??0;a[r]=c+1;const l=s.dataset.glowKey,m=`${n}:${r}:${l||c}`;if(!t[m]){if(d.glowLocked)continue;t[m]=fe()}const[i,u,h]=t[m];s.style.setProperty("--card-glow-1",i),s.style.setProperty("--card-glow-2",u),s.style.setProperty("--card-glow-3",h)}try{sessionStorage.setItem(N,JSON.stringify(t))}catch{}d.glowLocked=!0}function ge(){document.body.classList.contains("theme-night")&&he()}function Ke(){if(!document.body.classList.contains("theme-night"))return;const e=document.querySelector("#routeList");if(!e)return;const t=e.querySelectorAll(".route-card");if(!t.length)return;let o={};try{o=JSON.parse(sessionStorage.getItem(N)||"{}")}catch{o={}}t.forEach(n=>{const a=`route:${n.dataset.glowKey||""}`;o[a]||(o[a]=fe());const[s,r,c]=o[a];n.style.setProperty("--card-glow-1",s),n.style.setProperty("--card-glow-2",r),n.style.setProperty("--card-glow-3",c)});try{sessionStorage.setItem(N,JSON.stringify(o))}catch{}}function W(e){const t=["olev","campus-loop","wolpyeong","wolpyeong-early"];return x.filter(o=>o.stops.some(n=>{var a,s;return(s=(a=n.times)==null?void 0:a[e])==null?void 0:s.length})).slice().sort((o,n)=>{const a=t.indexOf(o.id),s=t.indexOf(n.id),r=a===-1?Number.MAX_SAFE_INTEGER:a,c=s===-1?Number.MAX_SAFE_INTEGER:s;return r!==c?r-c:o.name.localeCompare(n.name)})}function L(){return["olev","campus-loop","wolpyeong","wolpyeong-early"].map(t=>x.find(o=>o.id===t)).filter(Boolean)}function J({routeId:e,stopId:t,campusFrom:o,campusTo:n}){const a=new URLSearchParams;e&&a.set("route",e),t&&a.set("stop",t),o&&a.set("from",o),n&&a.set("to",n);const s=a.toString();return s?`./route.html?${s}`:"./route.html"}function We(e){return e.find(t=>t.stops.some(o=>o.default))||e[0]}function Z(){const e=document.querySelectorAll("[data-clock]"),t=document.querySelectorAll("[data-date]"),o=document.querySelectorAll("[data-weekday]"),n=document.querySelectorAll("[data-clock-card]"),a=document.querySelectorAll("[data-date-card]"),s=document.querySelectorAll("[data-weekday-card]"),r=document.querySelector("[data-weekday-badge]");if(!e.length||!t.length||!o.length)return;d.now=new Date;const c=Le(d.now);e.forEach(f=>{f.textContent=c}),n.forEach(f=>{f.textContent=c});const m=Ee(d.now).replace(/^\d{4}년\s*/,"");t.forEach(f=>{f.textContent=m}),a.forEach(f=>{f.textContent=m});const{day:i,label:u}=z(d.now);d.serviceDay=i,d.holidayLabel=u;const h=i==="weekday"?"평일":"휴일",p=$e(d.now);o.forEach(f=>{f.textContent=`${p} (${h}) ·`}),s.forEach(f=>{f.textContent=p}),r&&(r.textContent=h),K(d.now)}function Je(){const e=document.querySelector("#noticeList");if(!e)return;const t=te(d.now),o=Me.filter(n=>(!n.startDate||n.startDate<=t)&&(!n.endDate||n.endDate>=t));e.innerHTML=o.length?o.map(n=>`
          <article class="notice-card">
            <div class="notice-tag">${n.tag||"공지"}</div>
            <h3>${n.title}</h3>
            <p>${n.body}</p>
            <span class="notice-date">${n.startDate||""}</span>
          </article>
        `).join(""):`
        <div class="notice-empty">
          현재 등록된 공지가 없습니다.
        </div>
      `}function E(e,t=null,o=null,n=!1){const a=document.querySelector("#routeList");if(!a)return;const s=t??d.routeSearch,r=o??d.routeSearchBase;let c=s.trim().toLowerCase(),l=c,m=c?e.filter(i=>{const u=[i.name,i.subtitle||"",...i.tags||[]].join(" ");return U(u,c)}):e;if(n&&c&&m.length===0){const i=(r||d.routeSearchStable||"").trim().toLowerCase();i&&(l=i,m=e.filter(u=>{const h=[u.name,u.subtitle||"",...u.tags||[]].join(" ");return U(h,l)}))}if(!n&&l&&(d.routeSearchStable=l),!n&&!l&&(d.routeSearchStable=""),!m.length){if(n&&d.routeSearchLastHtml){a.innerHTML=d.routeSearchLastHtml;return}a.innerHTML=`
      <div class="notice-empty">검색 결과가 없습니다.</div>
    `;return}a.innerHTML=m.map(i=>`
      <a class="route-card" data-glow-key="${i.id}" href="./route.html?route=${i.id}">
        <div>
          <h3>${q(i.name,l)}</h3>
          <p>${i.subtitle?q(i.subtitle,l):""}</p>
        </div>
        <div class="route-tags">
          ${(i.tags||[]).map(u=>`<span>${q(u,l)}</span>`).join("")}
        </div>
      </a>
    `).join(""),d.routeSearchLastHtml=a.innerHTML,Ke()}function H(e){const t=document.querySelector("#favoritesList");t&&(t.innerHTML="");const o=document.querySelector("#favoriteDockPanel"),n=document.querySelector("#favoriteDock"),a=document.querySelector("[data-favorite-tab]");if(!o)return;let s=M();if(!s.length){if(o.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,o.setAttribute("aria-live","polite"),n&&n.classList.add("is-empty"),a){const i=n==null?void 0:n.classList.contains("is-open");a.classList.toggle("is-active",!!i)}return}n&&n.classList.remove("is-empty"),o.style.display="";const r=d.now.getHours()*60+d.now.getMinutes(),c=[],l=[];if(s.forEach(i=>{var T;const u=x.find(B=>B.id===i.routeId);if(!u)return;const h=A(d.now,null,u);let p=le(u,i.stopId,h);if(I(u)&&i.campusFrom&&(p=me({...u,stops:ce(u,h)},i.campusFrom,i.campusTo)),!p)return;c.push(i);const f=A(d.now,p,u),g=pe(u,f,((T=p.times)==null?void 0:T[f])||[],i.campusFrom,i.campusTo),v=f!==j(d.now)&&r<Y?r+1440:r,y=g.length?ne(g,v-2,2):[],S=g[g.length-1],$=I(u)&&i.campusFrom?`${F(i.campusFrom)} → ${F(i.campusTo)}`:p.direction&&p.direction!==u.name?`${R(u.id,p.name)} → ${p.direction}`:`${R(u.id,p.name)}`;l.push({item:i,route:u,stop:p,label:$,upcoming:y,lastTime:S})}),c.length!==s.length&&(s=c,G(c)),!l.length){o.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,n&&n.classList.add("is-empty"),a&&a.classList.remove("is-active");return}const m=l.map((i,u)=>{const h=u===0,p=u===l.length-1,f=[`data-jump-route="${i.route.id}"`,`data-jump-stop="${i.stop.id}"`,i.item.campusFrom?`data-jump-from="${i.item.campusFrom}"`:"",i.item.campusTo?`data-jump-to="${i.item.campusTo}"`:""].filter(Boolean).join(" ");return`
      <div class="favorite-dock__item" data-fav="${i.item.key}" ${f}>
        <div class="favorite-dock__title">
          <span>${i.route.name}</span>
          <span>${i.label}</span>
        </div>
        <div class="favorite-dock__row">
          <div class="favorite-dock__times">
            ${i.upcoming.length?i.upcoming.map(g=>`
                      <span>
                        ${g}
                        ${i.lastTime&&g===i.lastTime?'<em class="last-tag">막차</em>':""}
                      </span>
                    `).join(""):'<span class="favorite-dock__empty-text">미운행</span>'}
          </div>
          <div class="favorite-dock__actions">
            <button class="favorite-dock__move" type="button" data-move-favorite="up" data-key="${i.item.key}" ${h?"disabled":""} aria-label="위로">
              ↑
            </button>
            <button class="favorite-dock__move" type="button" data-move-favorite="down" data-key="${i.item.key}" ${p?"disabled":""} aria-label="아래로">
              ↓
            </button>
            <button class="favorite-dock__remove" type="button" data-remove-favorite="${i.item.key}">
              삭제
            </button>
          </div>
        </div>
      </div>
    `});o.innerHTML=m.join("")}function ee(e){const t=document.querySelector("#nextDepartures");if(!t)return;const o=M().slice(0,3);if(!o.length){t.innerHTML=`
      <div class="next-empty">
        즐겨찾기한 노선이 아직 없어요. 노선 상세에서 즐겨찾기를 추가하면
        여기에서 가까운 출발을 빠르게 확인할 수 있어요.
      </div>
    `,H(),he();return}const n=d.now.getHours()*60+d.now.getMinutes(),a=o.map(s=>{var v;const r=x.find(y=>y.id===s.routeId);if(!r)return"";const c=A(d.now,null,r);let l=le(r,s.stopId,c);if(I(r)&&s.campusFrom&&(l=me({...r,stops:ce(r,c)},s.campusFrom,s.campusTo)),!l)return"";const m=A(d.now,l,r),i=pe(r,m,((v=l.times)==null?void 0:v[m])||[],s.campusFrom,s.campusTo);if(!i.length)return"";const u=m!==j(d.now)&&n<Y?n+1440:n,h=ne(i,u-2,4),p=i[i.length-1],f=I(r)&&s.campusFrom?`${F(s.campusFrom)} → ${F(s.campusTo)}`:l.direction&&l.direction!==r.name?`${R(r.id,l.name)} → ${l.direction}`:`${R(r.id,l.name)}`;return`
        <div class="next-card" ${[`data-jump-route="${r.id}"`,`data-jump-stop="${l.id}"`,s.campusFrom?`data-jump-from="${s.campusFrom}"`:"",s.campusTo?`data-jump-to="${s.campusTo}"`:""].filter(Boolean).join(" ")} role="button" tabindex="0">
          <div class="next-header">
            <div>
              <h3>${r.name}</h3>
              <p>${f}</p>
            </div>
            <span class="next-badge">시간표 기준</span>
          </div>
          <div class="next-list">
            ${h.map(y=>`
                <div class="next-chip">
                  ${y}
                  ${p&&y===p?'<span class="last-tag">막차</span>':""}
                </div>
              `).join("")}
          </div>
          <p class="next-note">실시간 위치 아님 · 실제 운행과 차이 가능</p>
        </div>
      `}).filter(Boolean).join("");t.innerHTML=a||`
    <div class="next-empty">
      즐겨찾기한 노선이 아직 없어요. 노선 상세에서 즐겨찾기를 추가하면
      여기에서 가까운 출발을 빠르게 확인할 수 있어요.
    </div>
  `,t.onclick=s=>{const r=s.target.closest("[data-jump-route]");if(!r)return;const c=J({routeId:r.dataset.jumpRoute,stopId:r.dataset.jumpStop,campusFrom:r.dataset.jumpFrom,campusTo:r.dataset.jumpTo});window.location.href=c},t.onkeydown=s=>{if(s.key!=="Enter"&&s.key!==" ")return;const r=s.target.closest("[data-jump-route]");if(!r)return;s.preventDefault();const c=J({routeId:r.dataset.jumpRoute,stopId:r.dataset.jumpStop,campusFrom:r.dataset.jumpFrom,campusTo:r.dataset.jumpTo});window.location.href=c},H()}function Ye(){const e=document.querySelector("[data-theme-toggle]");e&&(e.addEventListener("click",()=>{const t=document.body.classList.contains("theme-night");qe(t?"light":"dark"),K(new Date),t||(d.glowLocked=!1,ge())}),K(new Date))}function ze(){const e=document.querySelector("#favoriteDock"),t=document.querySelector("[data-favorite-tab]"),o=document.querySelector("#favoriteDockPanel");if(!e||!t)return;let n=!1;const a=()=>{t.classList.toggle("is-active",e.classList.contains("is-open"))},s=()=>{e.classList.add("is-open"),a(),c()},r=()=>{n||(e.classList.remove("is-open"),a())};e.addEventListener("mouseenter",()=>s()),e.addEventListener("mouseleave",()=>r()),t.addEventListener("mouseenter",()=>s()),t.addEventListener("mouseleave",()=>r()),e.addEventListener("click",()=>{n=!n,n?(e.classList.add("is-open"),a()):(e.classList.remove("is-open"),a())}),t.addEventListener("click",()=>{n=!n,n?(e.classList.add("is-open"),a()):(e.classList.remove("is-open"),a())});const c=()=>{if(!window.matchMedia("(max-width: 640px)").matches||!e.classList.contains("is-open"))return;const m=t.getBoundingClientRect();e.style.top=`${Math.round(m.bottom+8)}px`};document.addEventListener("click",l=>{e.classList.contains("is-open")&&(e.contains(l.target)||t.contains(l.target)||(n=!1,e.classList.remove("is-open"),a()))}),o&&(o.addEventListener("click",l=>{l.stopPropagation();const m=l.target.closest("[data-move-favorite]");if(m){const p=m.dataset.key,f=m.dataset.moveFavorite;if(!p||!f)return;const g=M(),v=g.findIndex($=>$.key===p),y=f==="up"?v-1:v+1;if(v<0||y<0||y>=g.length)return;const S=g.slice();[S[v],S[y]]=[S[y],S[v]],G(S),H(W(d.serviceDay));return}const i=l.target.closest("[data-remove-favorite]");if(!i)return;const u=i.dataset.removeFavorite;if(!u)return;const h=M().filter(p=>p.key!==u);G(h),H(W(d.serviceDay))}),o.addEventListener("click",l=>{if(l.target.closest("[data-remove-favorite]")||l.target.closest("[data-move-favorite]"))return;const u=l.target.closest("[data-jump-route]");if(!u)return;const h=J({routeId:u.dataset.jumpRoute,stopId:u.dataset.jumpStop,campusFrom:u.dataset.jumpFrom,campusTo:u.dataset.jumpTo});window.location.href=h})),a(),window.addEventListener("scroll",c,{passive:!0}),window.addEventListener("resize",c),t.addEventListener("click",c),e.addEventListener("mouseenter",c)}function _(){const e=document.querySelector("header.navbar"),t=e==null?void 0:e.querySelector(".brand"),o=e==null?void 0:e.querySelector(".primary-nav"),n=o==null?void 0:o.querySelector(".nav-links"),a=o==null?void 0:o.querySelector(".nav-actions");if(!e||!t||!o||(e.classList.contains("is-wrapped")&&e.classList.remove("is-wrapped"),!n||!a))return;const r=Array.from(n.children).some(k=>k.scrollHeight>k.clientHeight+2),c=Array.from(a.children).some(k=>k.scrollHeight>k.clientHeight+2),l=parseFloat(getComputedStyle(e).gap||"0")||0,m=parseFloat(getComputedStyle(o).gap||"0")||0,i=k=>{const O=Array.from(k.children);if(!O.length)return 0;const ve=parseFloat(getComputedStyle(k).gap||"0")||0;return O.reduce((we,Se)=>we+Se.getBoundingClientRect().width,0)+ve*(O.length-1)},u=i(n)+i(a)+m,h=e.clientWidth-t.getBoundingClientRect().width-l,p=n.getBoundingClientRect(),f=a.getBoundingClientRect(),g=o.getBoundingClientRect(),v=e.getBoundingClientRect(),y=t.getBoundingClientRect(),S=p.right>f.left-8,$=g.left<y.right+8,T=g.right>v.right-8,B=u>h-Ne,ye=r||c||S||$||T||B;e.classList.toggle("is-wrapped",ye)}function Ve(){var e;_(),window.addEventListener("resize",_),window.addEventListener("load",_),(e=document.fonts)!=null&&e.ready&&document.fonts.ready.then(_)}function Ue(){const e=document.querySelector("#routeSearch"),t=document.querySelector("#routeSearchRecent");if(!e)return;e.value=d.routeSearch;const o=()=>{if(!t)return;const n=ue();if(!n.length){t.innerHTML="";return}t.innerHTML=`
      <div class="search-recent__label">최근 검색</div>
      <div class="search-recent__items">
        ${n.map(a=>`<button type="button" class="search-chip" data-recent="${b(a)}">${b(a)}</button>`).join("")}
      </div>
    `};o(),e.addEventListener("compositionstart",()=>{d.routeSearchComposing=!0,d.routeSearchBase=d.routeSearch}),e.addEventListener("compositionend",()=>{d.routeSearchComposing=!1,d.routeSearch=e.value,E(L())}),e.addEventListener("compositionupdate",()=>{E(L(),e.value,d.routeSearchBase,!0)}),e.addEventListener("input",()=>{if(d.routeSearch=e.value,d.routeSearchComposing){E(L(),e.value,d.routeSearchBase,!0);return}E(L())}),e.addEventListener("focus",()=>{d.routeSearchActive=!0}),e.addEventListener("blur",()=>{d.routeSearchActive=!1}),e.addEventListener("keydown",n=>{n.key==="Enter"&&(X(e.value),o())}),e.addEventListener("blur",()=>{X(e.value),o()}),t&&t.addEventListener("click",n=>{const a=n.target.closest("[data-recent]");a&&(e.value=a.dataset.recent||"",d.routeSearch=e.value,E(L()),e.focus())})}function Qe(){var t;const e=(t=window.getSelection)==null?void 0:t.call(window);return e?!e.isCollapsed&&e.toString().trim().length>0:!1}function Xe(){const{day:e}=z(d.now);d.serviceDay=e;const t=W(d.serviceDay);if(t.length===0)return;const o=M();if(o.length){d.selectedRouteId=o[0].routeId,d.selectedStopId=o[0].stopId;const n=x.find(r=>r.id===d.selectedRouteId),a=n==null?void 0:n.stops.find(r=>r.id===d.selectedStopId),s=xe.destinations.find(r=>r.name===(a==null?void 0:a.direction));s&&(d.selectedDestinationId=s.id)}else d.selectedRouteId=We(t).id;Z(),Je(),E(L()),ee(),ge(),Ye(),ze(),Ue(),Ve(),setInterval(()=>{Z(),Qe()||ee()},1e3)}Xe();
