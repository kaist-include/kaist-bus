import{t as j,h as P,i as re,r as ie,f as ce,a as le,b as de,g as K,c as x}from"./stopLabels-5QDnVXaU.js";const ue=[{id:"notice-2026-02-01",title:"2월 1일 설 연휴 운행 안내",body:"해당일은 휴일 시간표로 운행됩니다. 출발 전 꼭 시간표를 확인해 주세요.",startDate:"2026-01-28",endDate:"2026-02-02",tag:"휴일"},{id:"notice-2026-02-25",title:"2월 25일 특별휴일 운행",body:"특별 휴일 시간표가 적용됩니다.",startDate:"2026-02-24",endDate:"2026-02-26",tag:"공지"}],pe=[{id:"wolpyeong",name:"월평-본교-시내 순환셔틀",stops:[{routeId:"wolpyeong",stopId:"stop-1"}]},{id:"wolpyeong-early",name:"월평-유성온천역-본교 (얼리월평 셔틀)",stops:[{routeId:"wolpyeong-early",stopId:"stop-1"}]},{id:"campus-loop",name:"본교-문지-화암 왕복셔틀",stops:[{routeId:"campus-loop",stopId:"stop-2"}]},{id:"olev",name:"OLEV 교내셔틀",stops:[{routeId:"olev",stopId:"stop-1"}]}],me={destinations:pe},V="kaist-bus-favorites",Y="kaist-bus-theme",D="kaist-bus-night-sky",B="kaist-bus-card-glow";let h=null;const fe="campus-loop",ge=12,H=4*60,z=[{id:"main",label:"본교",match:/본교/},{id:"munji",label:"문지",match:/문지/},{id:"hwaam",label:"화암",match:/화암/}];function he(e){const o=new Map;return e.forEach(t=>{if(!o.has(t.id)){o.set(t.id,{...t,stops:t.stops.map(a=>{var r,i;return{...a,times:{weekday:[...((r=a.times)==null?void 0:r.weekday)||[]],weekend:[...((i=a.times)==null?void 0:i.weekend)||[]]}}})});return}const n=o.get(t.id);!n.note&&t.note&&(n.note=t.note);const s=new Map(n.stops.map(a=>[a.name,a]));t.stops.forEach(a=>{var i,d;const r=s.get(a.name);if(!r){const c={...a,times:{weekday:[...((i=a.times)==null?void 0:i.weekday)||[]],weekend:[...((d=a.times)==null?void 0:d.weekend)||[]]}};n.stops.push(c),s.set(a.name,c);return}["weekday","weekend"].forEach(c=>{var p,g;const l=((p=r.times)==null?void 0:p[c])||[],f=((g=a.times)==null?void 0:g[c])||[];if(!l.length&&f.length){r.times[c]=[...f];return}f.forEach(m=>{l.includes(m)||l.push(m)})})})}),Array.from(o.values())}const k=he(ie.routes);function J(e,o){const t=e.stops.filter(n=>{var s;return(((s=n.times)==null?void 0:s[o])||[]).length});return t.length?t:e.stops}function U(e,o,t){const n=e.stops.filter(a=>a.id===o);return n.length?n.find(a=>{var r;return(((r=a.times)==null?void 0:r[t])||[]).length})||n[0]:null}function ye(e){const[o,t]=e.split(":").map(Number);if(Number.isNaN(o)||Number.isNaN(t))return 0;let n=o*60+t;return o<4&&(n+=1440),n}function X(e){return!e||e.length===0?null:Math.max(...e.map(ye))}function ve(e,o){if(!e)return null;const t=e.stops.flatMap(n=>{var s;return((s=n.times)==null?void 0:s[o])||[]});return X(t)}function E(e,o,t){var f;const n=I(e),s=new Date(e);s.setDate(e.getDate()-1);const a=I(s);if(n===a)return n;const r=e.getHours()*60+e.getMinutes();if(r>=H)return n;const i=t?ve(t,a):X(((f=o==null?void 0:o.times)==null?void 0:f[a])||[]),d=i!=null&&i>=r+1440,c=p=>{var g;return(((g=o==null?void 0:o.times)==null?void 0:g[p])||[]).length>0};let l=d?a:n;return l===a&&!c(a)&&c(n)&&(l=n),l===n&&!c(n)&&c(a)&&d&&(l=a),l}const u={now:new Date,serviceDay:"weekday",holidayLabel:"",selectedRouteId:"",selectedStopId:"",selectedDestinationId:""};function _(){try{const e=localStorage.getItem(V);return e?JSON.parse(e):[]}catch{return[]}}function $(e){return(e==null?void 0:e.id)===fe}function C(e){var o;return((o=z.find(t=>t.id===e))==null?void 0:o.label)||e}function T(e){const o=z.find(t=>t.match.test(e));return o?o.id:null}function we(e,o){const t=T(e[o].name);for(let n=o+1;n<e.length;n+=1){const s=T(e[n].name);if(s&&s!==t)return s}return null}function Q(e,o,t){const n=e.stops||[],s=n.map((i,d)=>({stop:i,index:d,campus:T(i.name)})).filter(i=>i.campus===o);if(!s.length)return n[0];const a=s.filter(i=>/출발/.test(i.stop.name)),r=a.length?a:s;if(t){const i=r.find(d=>we(n,d.index)===t);if(i)return i.stop}return r[0].stop}function Z(e){localStorage.setItem(V,JSON.stringify(e))}function O(e){var t;const o=j(e);return P.forcedWeekends.includes(o)?{day:"weekend",label:((t=P.labels)==null?void 0:t[o])||"휴일"}:re(e)?{day:"weekend",label:"주말"}:{day:"weekday",label:"평일"}}function I(e){return O(e).day}function Se(){try{return localStorage.getItem(Y)}catch{return null}}function ke(e){try{localStorage.setItem(Y,e)}catch{}}function F(e){const o=Se();let t=!0;if(o==="dark")t=!1;else if(o==="light")t=!0;else{const s=e.getHours();t=s>=6&&s<18}document.body.classList.toggle("theme-night",!t),document.documentElement.classList.toggle("theme-night",!t);const n=document.querySelector('meta[name="theme-color"]');n&&n.setAttribute("content",t?"#e9ecff":"#05070f"),t?(document.documentElement.style.removeProperty("--night-sky"),document.documentElement.style.removeProperty("--app-bg")):be()}function be(){if(!h&&window.__nightSkyCss&&(h=window.__nightSkyCss),!h)try{h=localStorage.getItem(D)||sessionStorage.getItem(D)}catch{h=null}if(!h){h=Le();try{localStorage.setItem(D,h),sessionStorage.setItem(D,h)}catch{}}window.__nightSkyCss=h,document.documentElement.style.setProperty("--night-sky",h),document.documentElement.style.setProperty("--app-bg",h)}function Le(){const e=[],t=typeof window<"u"?window.innerWidth:1200,n=typeof window<"u"?window.innerHeight:800;for(let s=0;s<28;s+=1){const a=Math.floor(Math.random()*t),r=Math.floor(Math.random()*n),i=(Math.random()*1.8+.6).toFixed(2),d=(Math.random()*.5+.35).toFixed(2),l=Math.random()<.25?`rgba(255, 238, 180, ${d})`:`rgba(255, 255, 255, ${d})`;e.push(`radial-gradient(circle at ${a}px ${r}px, ${l} 0 ${i}px, transparent ${(Number(i)+1.6).toFixed(2)}px)`)}if(Math.random()<.65){const s=Math.floor(Math.random()*t),a=Math.floor(Math.random()*(n*.6));e.push(`radial-gradient(circle at ${s}px ${a}px, rgba(255, 244, 190, 0.95) 0 4px, transparent 7px)`)}return e.push("linear-gradient(180deg, #05070f 0%, #0b1026 55%, #141b3f 100%)"),e.join(", ")}function De(){const e=()=>Math.random()<.7?Math.random()<.5?-15+Math.random()*20:95+Math.random()*20:15+Math.random()*70,o=(s,a)=>{const r=Math.round(e()),i=Math.round(e()),d=Math.floor(420+Math.random()*420),c=Math.floor(320+Math.random()*360),l=(a+Math.random()*.06).toFixed(2);return`radial-gradient(${d}px ${c}px at ${r}% ${i}%, rgba(${s}, ${l}), transparent 72%)`},t=["246, 226, 138","255, 181, 201","171, 228, 255","160, 255, 224","198, 176, 255","255, 214, 165"],n=[];for(let s=0;s<10;s+=1){const a=t[s%t.length];n.push(o(a,.045))}return n}function A(){if(!document.body.classList.contains("theme-night"))return;const e=document.querySelectorAll(".hero-card, .next-card, .notice-card, .route-card, .time-table");let o={};try{o=JSON.parse(sessionStorage.getItem(B)||"{}")}catch{o={}}const t=s=>s.classList.contains("hero-card")?"hero":s.classList.contains("next-card")?"next":s.classList.contains("notice-card")?"notice":s.classList.contains("route-card")?"route":s.classList.contains("time-table")?"table":"card",n=location.pathname.replace(/\W+/g,"")||"index";e.forEach((s,a)=>{const r=t(s),i=`${n}:${r}:${a}`;o[i]||(o[i]=De());const[d,c,l]=o[i];s.style.setProperty("--card-glow-1",d),s.style.setProperty("--card-glow-2",c),s.style.setProperty("--card-glow-3",l)});try{sessionStorage.setItem(B,JSON.stringify(o))}catch{}}function ee(e){const o=["olev","campus-loop","wolpyeong","wolpyeong-early"];return k.filter(t=>t.stops.some(n=>{var s,a;return(a=(s=n.times)==null?void 0:s[e])==null?void 0:a.length})).slice().sort((t,n)=>{const s=o.indexOf(t.id),a=o.indexOf(n.id),r=s===-1?Number.MAX_SAFE_INTEGER:s,i=a===-1?Number.MAX_SAFE_INTEGER:a;return r!==i?r-i:t.name.localeCompare(n.name)})}function Me(){return["olev","campus-loop","wolpyeong","wolpyeong-early"].map(o=>k.find(t=>t.id===o)).filter(Boolean)}function xe(e){return e.find(o=>o.stops.some(t=>t.default))||e[0]}function W(){const e=document.querySelectorAll("[data-clock]"),o=document.querySelectorAll("[data-date]"),t=document.querySelectorAll("[data-weekday]"),n=document.querySelectorAll("[data-clock-card]"),s=document.querySelectorAll("[data-date-card]"),a=document.querySelectorAll("[data-weekday-card]"),r=document.querySelector("[data-weekday-badge]");if(!e.length||!o.length||!t.length)return;u.now=new Date;const i=ce(u.now);e.forEach(m=>{m.textContent=i}),n.forEach(m=>{m.textContent=i});const c=le(u.now).replace(/^\d{4}년\s*/,"");o.forEach(m=>{m.textContent=c}),s.forEach(m=>{m.textContent=c});const{day:l,label:f}=O(u.now);u.serviceDay=l,u.holidayLabel=f;const p=l==="weekday"?"평일":"휴일",g=de(u.now);t.forEach(m=>{m.textContent=`${g} (${p}) ·`}),a.forEach(m=>{m.textContent=g}),r&&(r.textContent=p),F(u.now)}function Ee(){const e=document.querySelector("#noticeList");if(!e)return;const o=j(u.now),t=ue.filter(n=>(!n.startDate||n.startDate<=o)&&(!n.endDate||n.endDate>=o));e.innerHTML=t.length?t.map(n=>`
          <article class="notice-card">
            <div class="notice-tag">${n.tag||"공지"}</div>
            <h3>${n.title}</h3>
            <p>${n.body}</p>
            <span class="notice-date">${n.startDate||""}</span>
          </article>
        `).join(""):`
        <div class="notice-empty">
          현재 등록된 공지가 없습니다.
        </div>
      `}function $e(e){const o=document.querySelector("#routeList");o&&(o.innerHTML=e.map(t=>`
      <a class="route-card" href="./route.html?route=${t.id}">
        <div>
          <h3>${t.name}</h3>
          <p>${t.subtitle||""}</p>
        </div>
        <div class="route-tags">
          ${(t.tags||[]).map(n=>`<span>${n}</span>`).join("")}
        </div>
      </a>
    `).join(""))}function q(e){const o=document.querySelector("#favoritesList");o&&(o.innerHTML="");const t=document.querySelector("#favoriteDockPanel"),n=document.querySelector("#favoriteDock"),s=document.querySelector("[data-favorite-tab]");if(!t)return;let a=_();if(!a.length){if(t.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,t.setAttribute("aria-live","polite"),n&&n.classList.add("is-empty"),s){const c=n==null?void 0:n.classList.contains("is-open");s.classList.toggle("is-active",!!c)}return}n&&n.classList.remove("is-empty"),t.style.display="";const r=u.now.getHours()*60+u.now.getMinutes(),i=[],d=a.map(c=>{var L;const l=k.find(S=>S.id===c.routeId);if(!l)return"";const f=E(u.now,null,l);let p=U(l,c.stopId,f);if($(l)&&c.campusFrom&&(p=Q({...l,stops:J(l,f)},c.campusFrom,c.campusTo)),!p)return"";i.push(c);const g=E(u.now,p,l),m=((L=p.times)==null?void 0:L[g])||[],w=g!==I(u.now)&&r<H?r+1440:r,y=m.length?K(m,w-2,2):[],b=m[m.length-1],R=$(l)&&c.campusFrom?`${C(c.campusFrom)} → ${C(c.campusTo)}`:p.direction&&p.direction!==l.name?`${x(l.id,p.name)} → ${p.direction}`:`${x(l.id,p.name)}`;return`
        <div class="favorite-dock__item" data-fav="${c.key}">
          <div class="favorite-dock__title">
            <span>${l.name}</span>
            <span>${R}</span>
          </div>
          <div class="favorite-dock__row">
            <div class="favorite-dock__times">
              ${y.length?y.map(S=>`
                        <span>
                          ${S}
                          ${b&&S===b?'<em class="last-tag">막차</em>':""}
                        </span>
                      `).join(""):'<span class="favorite-dock__empty-text">미운행</span>'}
            </div>
            <button class="favorite-dock__remove" type="button" data-remove-favorite="${c.key}">
              삭제
            </button>
          </div>
        </div>
      `}).filter(Boolean);if(i.length!==a.length&&(a=i,Z(i)),!d.length){t.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,n&&n.classList.add("is-empty"),s&&s.classList.remove("is-active");return}t.innerHTML=d.join("")}function G(e){const o=document.querySelector("#nextDepartures");if(!o)return;const t=_().slice(0,3);if(!t.length){o.innerHTML=`
      <div class="next-empty">
        즐겨찾기한 노선이 아직 없어요. 노선 상세에서 즐겨찾기를 추가하면
        여기에서 가까운 출발을 빠르게 확인할 수 있어요.
      </div>
    `,q(),A();return}const n=u.now.getHours()*60+u.now.getMinutes(),s=t.map(a=>{var w;const r=k.find(y=>y.id===a.routeId);if(!r)return"";const i=E(u.now,null,r);let d=U(r,a.stopId,i);if($(r)&&a.campusFrom&&(d=Q({...r,stops:J(r,i)},a.campusFrom,a.campusTo)),!d)return"";const c=E(u.now,d,r),l=((w=d.times)==null?void 0:w[c])||[];if(!l.length)return"";const f=c!==I(u.now)&&n<H?n+1440:n,p=K(l,f-2,4),g=l[l.length-1],m=$(r)&&a.campusFrom?`${C(a.campusFrom)} → ${C(a.campusTo)}`:d.direction&&d.direction!==r.name?`${x(r.id,d.name)} → ${d.direction}`:`${x(r.id,d.name)}`;return`
        <div class="next-card">
          <div class="next-header">
            <div>
              <h3>${r.name}</h3>
              <p>${m}</p>
            </div>
            <span class="next-badge">시간표 기준</span>
          </div>
          <div class="next-list">
            ${p.map(y=>`
                <div class="next-chip">
                  ${y}
                  ${g&&y===g?'<span class="last-tag">막차</span>':""}
                </div>
              `).join("")}
          </div>
          <p class="next-note">실시간 위치 아님 · 실제 운행과 차이 가능</p>
        </div>
      `}).filter(Boolean).join("");o.innerHTML=s||`
    <div class="next-empty">
      즐겨찾기한 노선이 아직 없어요. 노선 상세에서 즐겨찾기를 추가하면
      여기에서 가까운 출발을 빠르게 확인할 수 있어요.
    </div>
  `,q(),A()}function Ce(){const e=document.querySelector("[data-theme-toggle]");e&&(e.addEventListener("click",()=>{const o=document.body.classList.contains("theme-night");ke(o?"light":"dark"),F(new Date)}),F(new Date))}function Ie(){const e=document.querySelector("#favoriteDock"),o=document.querySelector("[data-favorite-tab]"),t=document.querySelector("#favoriteDockPanel");if(!e||!o)return;let n=!1;const s=()=>{o.classList.toggle("is-active",e.classList.contains("is-open"))},a=()=>{e.classList.add("is-open"),s(),i()},r=()=>{n||(e.classList.remove("is-open"),s())};e.addEventListener("mouseenter",()=>a()),e.addEventListener("mouseleave",()=>r()),o.addEventListener("mouseenter",()=>a()),o.addEventListener("mouseleave",()=>r()),e.addEventListener("click",()=>{n=!n,n?(e.classList.add("is-open"),s()):(e.classList.remove("is-open"),s())}),o.addEventListener("click",()=>{n=!n,n?(e.classList.add("is-open"),s()):(e.classList.remove("is-open"),s())});const i=()=>{if(!window.matchMedia("(max-width: 640px)").matches||!e.classList.contains("is-open"))return;const c=o.getBoundingClientRect();e.style.top=`${Math.round(c.bottom+8)}px`};document.addEventListener("click",d=>{e.classList.contains("is-open")&&(e.contains(d.target)||o.contains(d.target)||(n=!1,e.classList.remove("is-open"),s()))}),t&&t.addEventListener("click",d=>{d.stopPropagation();const c=d.target.closest("[data-remove-favorite]");if(!c)return;const l=c.dataset.removeFavorite;if(!l)return;const f=_().filter(p=>p.key!==l);Z(f),q(ee(u.serviceDay))}),s(),window.addEventListener("scroll",i,{passive:!0}),window.addEventListener("resize",i),o.addEventListener("click",i),e.addEventListener("mouseenter",i)}function M(){const e=document.querySelector("header.navbar"),o=e==null?void 0:e.querySelector(".brand"),t=e==null?void 0:e.querySelector(".primary-nav"),n=t==null?void 0:t.querySelector(".nav-links"),s=t==null?void 0:t.querySelector(".nav-actions");if(!e||!o||!t||(e.classList.contains("is-wrapped")&&e.classList.remove("is-wrapped"),!n||!s))return;const r=Array.from(n.children).some(v=>v.scrollHeight>v.clientHeight+2),i=Array.from(s.children).some(v=>v.scrollHeight>v.clientHeight+2),d=parseFloat(getComputedStyle(e).gap||"0")||0,c=parseFloat(getComputedStyle(t).gap||"0")||0,l=v=>{const N=Array.from(v.children);if(!N.length)return 0;const oe=parseFloat(getComputedStyle(v).gap||"0")||0;return N.reduce((se,ae)=>se+ae.getBoundingClientRect().width,0)+oe*(N.length-1)},f=l(n)+l(s)+c,p=e.clientWidth-o.getBoundingClientRect().width-d,g=n.getBoundingClientRect(),m=s.getBoundingClientRect(),w=t.getBoundingClientRect(),y=e.getBoundingClientRect(),b=o.getBoundingClientRect(),R=g.right>m.left-8,L=w.left<b.right+8,S=w.right>y.right-8,te=f>p-ge,ne=r||i||R||L||S||te;e.classList.toggle("is-wrapped",ne)}function _e(){var e;M(),window.addEventListener("resize",M),window.addEventListener("load",M),(e=document.fonts)!=null&&e.ready&&document.fonts.ready.then(M)}function Re(){const{day:e}=O(u.now);u.serviceDay=e;const o=ee(u.serviceDay);if(o.length===0)return;const t=_();if(t.length){u.selectedRouteId=t[0].routeId,u.selectedStopId=t[0].stopId;const n=k.find(r=>r.id===u.selectedRouteId),s=n==null?void 0:n.stops.find(r=>r.id===u.selectedStopId),a=me.destinations.find(r=>r.name===(s==null?void 0:s.direction));a&&(u.selectedDestinationId=a.id)}else u.selectedRouteId=xe(o).id;W(),Ee(),$e(Me()),G(),A(),Ce(),Ie(),_e(),setInterval(()=>{W(),G()},1e3)}Re();
