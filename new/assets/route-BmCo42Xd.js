import{r as ge,f as ve,a as he,t as ye,h as we,i as be,b as Se,g as X,c as R}from"./stopLabels-BHifznrE.js";const W="kaist-bus-favorites",Q="kaist-bus-theme",F="kaist-bus-night-sky",C="kaist-bus-night-sky-meta",V="v2",ke=24*60*60*1e3,Le=1/7,U="kaist-bus-card-glow";let v=null;const xe="campus-loop",E=[{id:"main",label:"본교",match:/본교/},{id:"munji",label:"문지",match:/문지/},{id:"hwaam",label:"화암",match:/화암/}],a={now:new Date,serviceDay:"weekday",serviceOverride:null,routeId:"",stopId:"",campusFrom:"main",campusTo:"munji",stopPillsExpanded:!1,dropdownOpen:!1,favoriteHelpVisible:!1,sharedFromLink:!1},D=new Map,Te=12,G=4*60;function Ee(e){const t=new Map;return e.forEach(n=>{if(!t.has(n.id)){t.set(n.id,{...n,stops:n.stops.map(c=>{var l,i;return{...c,times:{weekday:[...((l=c.times)==null?void 0:l.weekday)||[]],weekend:[...((i=c.times)==null?void 0:i.weekend)||[]]}}})});return}const s=t.get(n.id);!s.note&&n.note&&(s.note=n.note);const r=new Map(s.stops.map(c=>[c.name,c]));n.stops.forEach(c=>{var i,o;const l=r.get(c.name);if(!l){const d={...c,times:{weekday:[...((i=c.times)==null?void 0:i.weekday)||[]],weekend:[...((o=c.times)==null?void 0:o.weekend)||[]]}};s.stops.push(d),r.set(c.name,d);return}["weekday","weekend"].forEach(d=>{var f,m;const u=((f=l.times)==null?void 0:f[d])||[],p=((m=c.times)==null?void 0:m[d])||[];if(!u.length&&p.length){l.times[d]=[...p];return}p.forEach(b=>{u.includes(b)||u.push(b)})})})}),Array.from(t.values())}const M=Ee(ge.routes);function H(e){const[t,n]=e.split(":").map(Number);if(Number.isNaN(t)||Number.isNaN(n))return 0;let s=t*60+n;return t<4&&(s+=1440),s}function Z(e){return!e||e.length===0?null:Math.max(...e.map(H))}function ee(e,t){if(!e)return null;const n=e.stops.flatMap(s=>{var r;return((r=s.times)==null?void 0:r[t])||[]});return Z(n)}function I(e,t){const n=e.stops.filter(s=>{var r;return(((r=s.times)==null?void 0:r[t])||[]).length});return n.length?n:e.stops}function $e(e,t,n){const s=e.stops.filter(c=>c.id===t);return s.length?s.find(c=>{var l;return(((l=c.times)==null?void 0:l[n])||[]).length})||s[0]:null}function Y(e){a.dropdownOpen=e,document.documentElement.classList.toggle("dropdown-open",e)}function te(){D.forEach(e=>{e.open&&e.close()})}function De(e){if(D.has(e)){const i=D.get(e);return(!i.wrapper.isConnected||i.wrapper.previousSibling!==e)&&e.after(i.wrapper),i}const t=document.createElement("div");t.className="dropdown";const n=document.createElement("button");n.type="button",n.className="dropdown__button",n.setAttribute("aria-haspopup","listbox"),n.setAttribute("aria-expanded","false");const s=document.createElement("span");s.className="dropdown__label";const r=document.createElement("span");r.className="dropdown__chevron",n.append(s,r);const c=document.createElement("div");c.className="dropdown__list",c.setAttribute("role","listbox"),c.tabIndex=-1,t.append(n,c),e.after(t),e.classList.add("native-select"),e.setAttribute("aria-hidden","true"),e.tabIndex=-1;const l={wrapper:t,button:n,label:s,list:c,optionsKey:"",options:[],activeIndex:0,open:!1,openDropdown(){l.open||(te(),l.open=!0,t.classList.add("is-open"),n.setAttribute("aria-expanded","true"),Y(!0),l.syncActiveIndex(),c.tabIndex=-1)},close(){if(!l.open)return;l.open=!1,t.classList.remove("is-open"),n.setAttribute("aria-expanded","false"),c.tabIndex=-1,n.focus();const i=Array.from(D.values()).some(o=>o.open);Y(i)},syncActiveIndex(){const i=e.selectedIndex>=0?e.selectedIndex:0;l.setActive(i)},setActive(i){if(!l.options.length)return;const o=Math.max(0,Math.min(i,l.options.length-1));l.activeIndex=o,l.options.forEach((d,u)=>{const p=u===o;d.classList.toggle("is-active",p),d.setAttribute("aria-selected",p?"true":"false"),p&&d.scrollIntoView({block:"nearest"})})}};return n.addEventListener("click",()=>{l.open?l.close():l.openDropdown()}),n.addEventListener("keydown",i=>{if(i.key==="ArrowDown"||i.key==="ArrowUp"){if(i.preventDefault(),!l.open){l.openDropdown();return}l.setActive(l.activeIndex+(i.key==="ArrowDown"?1:-1));return}if(l.open&&i.key==="Enter"){i.preventDefault();const o=l.options[l.activeIndex];o&&(e.value=o.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),l.close());return}l.open&&i.key==="Escape"&&(i.preventDefault(),l.close())}),c.addEventListener("click",i=>{const o=i.target.closest(".dropdown__option");if(!o)return;const d=o.dataset.value;d!=null&&(e.value=d,e.dispatchEvent(new Event("change",{bubbles:!0})),l.close())}),c.addEventListener("keydown",i=>{if(i.key==="Escape"){i.preventDefault(),l.close();return}if(i.key==="ArrowDown"){i.preventDefault(),l.setActive(l.activeIndex+1);return}if(i.key==="ArrowUp"){i.preventDefault(),l.setActive(l.activeIndex-1);return}if(i.key==="Enter"){i.preventDefault();const o=l.options[l.activeIndex];o&&(e.value=o.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),l.close())}}),document.addEventListener("click",i=>{l.open&&(t.contains(i.target)||l.close())}),D.set(e,l),l}function z(e){var l;const t=De(e),n=e.hidden||e.style.display==="none"||e.classList.contains("is-hidden");t.wrapper.style.display=n?"none":"",t.button.disabled=e.disabled,t.button.setAttribute("aria-disabled",e.disabled?"true":"false");const s=Array.from(e.options).map(i=>({value:i.value,label:i.textContent})),r=s.map(i=>`${i.value}:${i.label}`).join("|");r!==t.optionsKey&&(t.optionsKey=r,t.list.innerHTML="",t.options=s.map(i=>{const o=document.createElement("button");return o.type="button",o.className="dropdown__option",o.setAttribute("role","option"),o.dataset.value=i.value,o.textContent=i.label,t.list.append(o),o}));const c=e.selectedIndex>=0?e.selectedIndex:0;t.label.textContent=((l=s[c])==null?void 0:l.label)||"",t.setActive(c)}function A(){try{const e=localStorage.getItem(W);return e?JSON.parse(e):[]}catch{return[]}}function O(e){localStorage.setItem(W,JSON.stringify(e))}function ne(e){const t=document.querySelector("#favoriteDockPanel"),n=document.querySelector("#favoriteDock"),s=document.querySelector("[data-favorite-tab]");if(!t)return;const r=A();if(!r.length){if(t.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,n&&n.classList.add("is-empty"),s){const o=n==null?void 0:n.classList.contains("is-open");s.classList.toggle("is-active",!!o)}return}n&&n.classList.remove("is-empty"),a.now.getHours()*60+a.now.getMinutes();const c=[],l=[];if(r.forEach(o=>{var w;const d=M.find($=>$.id===o.routeId);if(!d)return;const u=J(a.now,null,d);let p=$e(d,o.stopId,u);if(g(d)&&o.campusFrom&&(p=ae({...d,stops:I(d,u)},o.campusFrom,o.campusTo)),!p)return;l.push(o);const f=J(a.now,p,d),m=N(d,f,((w=p.times)==null?void 0:w[f])||[],o.campusFrom,o.campusTo),b=se(a.now,f),k=m.length?X(m,b-2,2):[],S=m[m.length-1],L=g(d)&&o.campusFrom?`${T(o.campusFrom)} → ${T(o.campusTo)}`:p.direction&&p.direction!==d.name?`${R(d.id,p.name)} → ${p.direction}`:`${R(d.id,p.name)}`;c.push({item:o,route:d,stop:p,label:L,upcoming:k,lastTime:S})}),l.length!==r.length&&O(l),!c.length){if(t.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,n&&n.classList.add("is-empty"),s){const o=n==null?void 0:n.classList.contains("is-open");s.classList.toggle("is-active",!!o)}return}const i=c.map((o,d)=>{const u=d===0,p=d===c.length-1;return`
      <div class="favorite-dock__item" ${[`data-jump-route="${o.route.id}"`,`data-jump-stop="${o.stop.id}"`,o.item.campusFrom?`data-jump-from="${o.item.campusFrom}"`:"",o.item.campusTo?`data-jump-to="${o.item.campusTo}"`:""].filter(Boolean).join(" ")}>
        <div class="favorite-dock__title">
          <span>${o.route.name}</span>
          <span>${o.label}</span>
        </div>
        <div class="favorite-dock__row">
          <div class="favorite-dock__times">
            ${o.upcoming.length?o.upcoming.map(m=>`
                      <span>
                        ${m}
                        ${o.lastTime&&m===o.lastTime?'<em class="last-tag">막차</em>':""}
                      </span>
                    `).join(""):'<span class="favorite-dock__empty-text">미운행</span>'}
          </div>
          <div class="favorite-dock__actions">
            <button class="favorite-dock__move" type="button" data-move-favorite="up" data-key="${o.item.key}" ${u?"disabled":""} aria-label="위로">
              ↑
            </button>
            <button class="favorite-dock__move" type="button" data-move-favorite="down" data-key="${o.item.key}" ${p?"disabled":""} aria-label="아래로">
              ↓
            </button>
            <button class="favorite-dock__remove" type="button" data-remove-favorite="${o.item.key}">
              삭제
            </button>
          </div>
        </div>
      </div>
    `});t.innerHTML=i.join("")}function y(e){const t=ye(e);return we.forcedWeekends.includes(t)||be(e)?"weekend":"weekday"}function J(e,t,n){var p;const s=y(e),r=new Date(e);r.setDate(e.getDate()-1);const c=y(r);if(s===c)return s;const l=e.getHours()*60+e.getMinutes();if(l>=G)return s;const i=n?ee(n,c):Z(((p=t==null?void 0:t.times)==null?void 0:p[c])||[]),o=i!=null&&i>=l+1440,d=f=>{var m;return(((m=t==null?void 0:t.times)==null?void 0:m[f])||[]).length>0};let u=o?c:s;return u===c&&!d(c)&&d(s)&&(u=s),u===s&&!d(s)&&d(c)&&o&&(u=c),u}function se(e,t){const n=e.getHours()*60+e.getMinutes(),s=y(e);return t!==s&&n<G?n+1440:n}function oe(e,t){if(a.serviceOverride)return a.serviceOverride;if(!t)return y(e);const n=new Date(e);n.setDate(e.getDate()-1);const s=y(n),r=y(e);if(s===r)return r;const c=e.getHours()*60+e.getMinutes();if(c>=G)return r;const l=ee(t,s);return l==null?r:l>=c+1440?s:r}function ie(e){const t=["olev","campus-loop","wolpyeong","wolpyeong-early"];return M.sort((n,s)=>{const r=t.indexOf(n.id),c=t.indexOf(s.id),l=r===-1?Number.MAX_SAFE_INTEGER:r,i=c===-1?Number.MAX_SAFE_INTEGER:c;return l!==i?l-i:n.name.localeCompare(s.name)})}function K(e,t){return e.find(n=>n.id===t)||e[0]}function Ie({routeId:e,stopId:t,campusFrom:n,campusTo:s}){const r=new URLSearchParams;e&&r.set("route",e),t&&r.set("stop",t),n&&r.set("from",n),s&&r.set("to",s),a.serviceOverride&&r.set("day",a.serviceOverride);const c=r.toString();return c?`./route.html?${c}`:"./route.html"}function Ae(){const e=new URLSearchParams;return a.routeId&&e.set("route",a.routeId),a.stopId&&e.set("stop",a.stopId),a.campusFrom&&e.set("from",a.campusFrom),a.campusTo&&e.set("to",a.campusTo),a.serviceOverride&&e.set("day",a.serviceOverride),e.set("shared","1"),`./route.html?${e.toString()}`}function g(e){return(e==null?void 0:e.id)===xe}function T(e){var t;return((t=E.find(n=>n.id===e))==null?void 0:t.label)||e}function P(e){const t=E.find(n=>n.match.test(e));return t?t.id:null}function Me(e,t){const n=P(e[t].name);for(let s=t+1;s<e.length;s+=1){const r=P(e[s].name);if(r&&r!==n)return r}return null}function ae(e,t,n){const s=e.stops||[],r=s.map((i,o)=>({stop:i,index:o,campus:P(i.name)})).filter(i=>i.campus===t);if(!r.length)return s[0];const c=r.filter(i=>/출발/.test(i.stop.name)),l=c.length?c:r;if(n){const i=l.find(o=>Me(s,o.index)===n);if(i)return i.stop}return l[0].stop}function N(e,t,n,s,r){return!g(e)||t!=="weekend"||s!=="main"||r!=="hwaam"?n:n.filter(c=>c.trim()!=="11:30")}function re(e,t){var c,l;const n=I(e,t);if(g(e)){let i=ae({...e,stops:n},a.campusFrom,a.campusTo);return(((c=i==null?void 0:i.times)==null?void 0:c[t])||[]).length||(i=n.find(d=>{var u;return(((u=d.times)==null?void 0:u[t])||[]).length})||n[0]||e.stops[0]),i}let s=n.find(i=>i.id===a.stopId)||n.find(i=>i.default)||n[0]||e.stops[0];return(((l=s==null?void 0:s.times)==null?void 0:l[t])||[]).length||(s=n.find(i=>{var o;return(((o=i.times)==null?void 0:o[t])||[]).length})||n[0]||e.stops[0]),s}function ce(e){const t=document.querySelector("[data-route-title]"),n=document.querySelector("[data-route-subtitle]"),s=document.querySelector("[data-route-badge]"),r=document.querySelector("[data-weekday]"),c=document.querySelector("#shareNotice");if(t&&(t.textContent=e.name),n&&(n.textContent=g(e)?`${T(a.campusFrom)} → ${T(a.campusTo)}`:e.subtitle||""),c&&(c.textContent=a.sharedFromLink?"공유된 링크로 열림":"",c.style.display=c.textContent?"":"none"),s){const l=e.stops.some(i=>{var o;return(((o=i.times)==null?void 0:o.weekend)||[]).length});s.textContent=l?"매일 운영":"평일 운영",s.classList.toggle("is-daily",l),s.classList.toggle("is-weekday",!l)}if(r){const l=y(a.now)==="weekday"?"평일":"휴일";r.textContent=`${Se(a.now)} (${l}) ·`}}function B(){const e=document.querySelector("[data-clock]"),t=document.querySelector("[data-date]");if(!e||!t)return;e.textContent=ve(a.now);const n=he(a.now);t.textContent=n.replace(/^\d{4}년\s*/,"")}function Fe(){try{return localStorage.getItem(Q)}catch{return null}}function Ce(e){try{localStorage.setItem(Q,e)}catch{}}function j(e){const t=Fe();let n=!0;if(t==="dark")n=!1;else if(t==="light")n=!0;else{const r=e.getHours();n=r>=6&&r<18}document.body.classList.toggle("theme-night",!n),document.documentElement.classList.toggle("theme-night",!n);const s=document.querySelector('meta[name="theme-color"]');s&&s.setAttribute("content",n?"#e9ecff":"#05070f"),n?(document.documentElement.style.removeProperty("--night-sky"),document.documentElement.style.removeProperty("--app-bg")):_e()}function _e(){!v&&window.__nightSkyCss&&(v=window.__nightSkyCss);let e=null;try{e=JSON.parse(localStorage.getItem(C)||sessionStorage.getItem(C)||"null")}catch{e=null}const t=Date.now(),n=!e||e.version!==V||!e.createdAt||t-e.createdAt>ke;if(!v&&!n)try{v=localStorage.getItem(F)||sessionStorage.getItem(F)}catch{v=null}if(!v||n){v=Ne();try{const s=JSON.stringify({version:V,createdAt:t});localStorage.setItem(F,v),localStorage.setItem(C,s),sessionStorage.setItem(F,v),sessionStorage.setItem(C,s)}catch{}}window.__nightSkyCss=v,document.documentElement.style.setProperty("--night-sky",v),document.documentElement.style.setProperty("--app-bg",v)}function Ne(){const e=[],n=typeof window<"u"?window.innerWidth:1200,s=typeof window<"u"?window.innerHeight:800;for(let r=0;r<28;r+=1){const c=Math.floor(Math.random()*n),l=Math.floor(Math.random()*s),i=(Math.random()*1.8+.6).toFixed(2),o=(Math.random()*.5+.35).toFixed(2),u=Math.random()<.25?`rgba(255, 238, 180, ${o})`:`rgba(255, 255, 255, ${o})`;e.push(`radial-gradient(circle at ${c}px ${l}px, ${u} 0 ${i}px, transparent ${(Number(i)+1.6).toFixed(2)}px)`)}if(Math.random()<Le){const r=Math.floor(Math.random()*n),c=Math.floor(Math.random()*(s*.6));e.push(`radial-gradient(circle at ${r}px ${c}px, rgba(255, 244, 190, 0.6) 0 6px, transparent 12px)`)}return e.push("linear-gradient(180deg, #05070f 0%, #0b1026 55%, #141b3f 100%)"),e.join(", ")}function qe(){const e=()=>Math.random()<.7?Math.random()<.5?-15+Math.random()*20:95+Math.random()*20:15+Math.random()*70,t=(r,c)=>{const l=Math.round(e()),i=Math.round(e()),o=Math.floor(420+Math.random()*420),d=Math.floor(320+Math.random()*360),u=(c+Math.random()*.06).toFixed(2);return`radial-gradient(${o}px ${d}px at ${l}% ${i}%, rgba(${r}, ${u}), transparent 72%)`},n=["246, 226, 138","255, 181, 201","171, 228, 255","160, 255, 224","198, 176, 255","255, 214, 165"],s=[];for(let r=0;r<10;r+=1){const c=n[r%n.length];s.push(t(c,.045))}return s}function Re(){if(!document.body.classList.contains("theme-night"))return;const e=document.querySelectorAll(".hero-card, .next-card, .notice-card, .route-card, .time-table");let t={};try{t=JSON.parse(sessionStorage.getItem(U)||"{}")}catch{t={}}const n=r=>r.classList.contains("hero-card")?"hero":r.classList.contains("next-card")?"next":r.classList.contains("notice-card")?"notice":r.classList.contains("route-card")?"route":r.classList.contains("time-table")?"table":"card",s=location.pathname.replace(/\W+/g,"")||"route";e.forEach((r,c)=>{const l=n(r),i=`${s}:${l}:${c}`;t[i]||(t[i]=qe());const[o,d,u]=t[i];r.style.setProperty("--card-glow-1",o),r.style.setProperty("--card-glow-2",d),r.style.setProperty("--card-glow-3",u)});try{sessionStorage.setItem(U,JSON.stringify(t))}catch{}}function He(e,t){const n=document.querySelector("#routeSelect"),s=document.querySelector("#stopSelect"),r=document.querySelector("#stopSelectLabel"),c=document.querySelector("#stopSelectRow"),l=document.querySelector("#campusSelector");if(!n||!s)return;n.innerHTML=e.map(o=>`<option value="${o.id}">${o.name}${o.subtitle?` ${o.subtitle}`:""}</option>`).join(""),n.value=t.id;const i=g(t);if(n.disabled=!1,n.classList.remove("route-select--static"),i)s.innerHTML="";else{const o=I(t,a.serviceDay);s.innerHTML=o.map(d=>`<option value="${d.id}">${d.name}</option>`).join("")}if(i)s.disabled=!0;else{const o=I(t,a.serviceDay),d=o.find(u=>u.default)||o[0];a.stopId=o.some(u=>u.id===a.stopId)?a.stopId:d==null?void 0:d.id,s.value=a.stopId,s.disabled=o.length<=1}s.classList.toggle("is-hidden",i),s.style.display=i?"none":"inline-flex",s.hidden=i,s.setAttribute("aria-hidden",i?"true":"false"),s.tabIndex=i?-1:0,r&&(r.classList.toggle("is-hidden",i),r.hidden=i,r.style.display=i?"none":"inline-flex"),c&&(c.classList.toggle("is-hidden",i),c.hidden=i,c.style.display=i?"none":"flex"),l&&(l.style.display=i?"flex":"none"),z(n),z(s),n.onchange=o=>{a.routeId=o.target.value,a.stopId="",h()},s.onchange=o=>{a.stopId=o.target.value,h()}}function Oe(e){const t=document.querySelector("#campusSelector");if(!t||!g(e))return;const n=t.querySelector("[data-campus-role='from']"),s=t.querySelector("[data-campus-role='to']"),r=t.querySelector("#campusSwap"),c=(o,d)=>{if(o!==d)return{fromId:o,toId:d};const u=E.find(p=>p.id!==o);return{fromId:o,toId:u?u.id:d}},l=o=>{const d=c(o,a.campusTo);a.campusFrom=d.fromId,a.campusTo=d.toId,h()},i=o=>{const d=c(a.campusFrom,o);a.campusFrom=d.fromId,a.campusTo=d.toId,h()};n&&(n.innerHTML=E.map(o=>`
        <button class="campus-pill ${o.id===a.campusFrom?"is-active":""}" data-campus-from="${o.id}">
          ${o.label}
        </button>
      `).join(""),n.querySelectorAll("[data-campus-from]").forEach(o=>{o.addEventListener("click",()=>l(o.dataset.campusFrom))})),s&&(s.innerHTML=E.map(o=>`
        <button class="campus-pill ${o.id===a.campusTo?"is-active":""} ${o.id===a.campusFrom?"is-disabled":""}" data-campus-to="${o.id}" ${o.id===a.campusFrom?"disabled":""}>
          ${o.label}
        </button>
      `).join(""),s.querySelectorAll("[data-campus-to]").forEach(o=>{o.addEventListener("click",()=>i(o.dataset.campusTo))})),r&&(r.onclick=()=>{const o=a.campusTo,d=a.campusFrom;a.campusFrom=o,a.campusTo=d,h()})}function Pe(e){const t=document.querySelector("#stopPills"),n=document.querySelector("#stopPillsToggle");if(!t)return;const s=t.closest("section");if(g(e)){s&&(s.style.display="none");return}if(e.stops.length<=1){s&&(s.style.display="none");return}s&&(s.style.display="block");const r=I(e,a.serviceDay);t.innerHTML=r.map(l=>`
      <button class="stop-pill ${l.id===a.stopId?"is-active":""}" data-stop="${l.id}">
        ${R(e.id,l.name)}
      </button>
    `).join("");const c=()=>{if(!n)return;const l=t.scrollHeight>t.clientHeight+4;n.style.display=l||a.stopPillsExpanded?"inline-flex":"none",n.innerHTML="",n.classList.toggle("is-open",a.stopPillsExpanded)};t.classList.toggle("is-collapsed",!a.stopPillsExpanded),t.querySelectorAll("[data-stop]").forEach(l=>{l.addEventListener("click",()=>{a.stopId=l.dataset.stop,h()})}),n&&(n.onclick=()=>{a.stopPillsExpanded=!a.stopPillsExpanded,t.classList.toggle("is-collapsed",!a.stopPillsExpanded),c()}),requestAnimationFrame(c)}function Be(e,t){var d;const n=document.querySelector("#nextPanel");if(!n)return;if(a.serviceOverride){n.style.display="";const p=g(e)?`${T(a.campusFrom)} → ${T(a.campusTo)}`:`${t.name} 기준`;n.innerHTML=`
      <div class="next-header">
        <div>
          <h3>${e.name}</h3>
          <p>${p}</p>
        </div>
        <span class="next-badge">가까운 예정</span>
      </div>
      <div class="next-list">
        <div class="next-empty-inline">오늘 기준에서만 가까운 예정이 표시됩니다.</div>
      </div>
    `;return}const s=se(a.now,a.serviceDay),r=N(e,a.serviceDay,((d=t.times)==null?void 0:d[a.serviceDay])||[],a.campusFrom,a.campusTo);if(r.length===0){n.style.display="none";return}n.style.display="";const c=r[r.length-1],l=X(r,s-2,5),o=g(e)?`${T(a.campusFrom)} → ${T(a.campusTo)}`:`${t.name} 기준`;n.innerHTML=`
    <div class="next-header">
      <div>
        <h3>${e.name}</h3>
        <p>${o}</p>
      </div>
      <span class="next-badge">가까운 예정</span>
    </div>
    <div class="next-list">
      ${l.map(u=>`
          <div class="next-chip">
            ${u}
            ${c&&u===c?'<span class="last-tag">막차</span>':""}
          </div>
        `).join("")}
    </div>
    <p class="next-note">실시간 위치 아님 · 실제 운행과 차이 가능</p>
  `}function je(e,t){var l;const n=document.querySelector("#timeTable"),s=document.querySelector("#timeTableSection");if(!n)return;const r=N(e,a.serviceDay,((l=t.times)==null?void 0:l[a.serviceDay])||[],a.campusFrom,a.campusTo).slice().sort((i,o)=>H(i)-H(o)),c=r[r.length-1];if(r.length===0){n.innerHTML=`
      <div class="time-empty">
        선택한 운행일에는 시간표가 없습니다.
      </div>
    `,s&&(s.style.display="");return}s&&(s.style.display=""),n.innerHTML=r.map(i=>`
      <div class="time-row ${c&&i===c?"last-run":""}">
        <span>${i}</span>
        <span class="time-label">${c&&i===c?"막차":"예정"}</span>
      </div>
    `).join("")}function We(e,t){var o;const n=document.querySelector("#routeNote");if(!n)return;const r=N(e,a.serviceDay,((o=t==null?void 0:t.times)==null?void 0:o[a.serviceDay])||[],a.campusFrom,a.campusTo).length===0?"선택한 운행일에는 운행하지 않습니다.":"",c=g(e)&&a.serviceDay==="weekend"&&a.campusFrom==="main"&&a.campusTo==="hwaam"?`주말에는 기사님께 요청하시면 화암관을 경유합니다.

단, 본교출발 11:30회차는 기사님 점심시간 확보를 위해 요청이 불가합니다.`:"",l=e.note||"",i=[r,c,l].filter(Boolean).join(`
`).trim();n.textContent=i,n.style.display=i?"":"none"}function Ge(e,t){var u;const n=document.querySelector("#favoriteToggleRoute"),s=document.querySelector("#favoriteHelp");if(!n)return;const r=A(),c=g(e)?`${e.id}:${a.campusFrom}->${a.campusTo}`:`${e.id}:${a.stopId||t.id}`,i=(((u=t==null?void 0:t.times)==null?void 0:u[a.serviceDay])||[]).length===0,o=r.some(p=>p.key===c);n.textContent=o?"즐겨찾기 해제":"즐겨찾기 추가";const d=i&&!o;n.disabled=!1,n.classList.toggle("is-disabled",d),n.setAttribute("aria-disabled",d?"true":"false"),n.setAttribute("data-disabled",d?"true":"false"),s&&(i&&!o?(s.textContent="선택한 운행일에는 운행하지 않아 즐겨찾기를 추가할 수 없어요.",a.favoriteHelpVisible?(s.classList.add("is-visible"),s.setAttribute("aria-hidden","false")):(s.classList.remove("is-visible"),s.setAttribute("aria-hidden","true"))):(s.textContent="",s.classList.remove("is-visible"),s.setAttribute("aria-hidden","true")))}function h(){var s;a.now=new Date;const e=ie(y(a.now)),t=K(e,a.routeId||((s=e[0])==null?void 0:s.id));if(!t)return;a.routeId=t.id,a.serviceDay=oe(a.now,t);const n=re(t,a.serviceDay);ce(t),B(),j(a.now),He(e,t),Oe(t),Be(t,n),je(t,n),We(t,n),Pe(t),Ge(t,n),ne(),Re()}function Ke(){const e=document.querySelector("#serviceDayToggle");if(!e)return;const t=()=>{const n=y(a.now),s=a.serviceOverride||n;e.querySelectorAll("button[data-day]").forEach(r=>{const c=r.dataset.day,i=c==="auto"?!a.serviceOverride:c===s;r.classList.toggle("is-active",i)})};e.addEventListener("click",n=>{const s=n.target.closest("button[data-day]");if(!s)return;const r=s.dataset.day,c=y(a.now);r==="auto"?a.serviceOverride=null:a.serviceOverride=r===c?null:r,t(),h()}),t()}function Ve(){const e=document.querySelector("#favoriteToggleRoute"),t=document.querySelector("#favoriteHelp");if(!e)return;const n=()=>{t&&e.getAttribute("data-disabled")==="true"&&t.textContent.trim()&&(a.favoriteHelpVisible=!0,t.classList.add("is-visible"),t.setAttribute("aria-hidden","false"),t.classList.remove("is-flipped"),requestAnimationFrame(()=>{const r=t.getBoundingClientRect(),c=r.right>window.innerWidth-12,l=r.left<12;c&&!l&&t.classList.add("is-flipped")}))},s=()=>{t&&e.getAttribute("data-disabled")==="true"&&(a.favoriteHelpVisible=!1,t.classList.remove("is-visible"),t.setAttribute("aria-hidden","true"))};e.addEventListener("mouseenter",n),e.addEventListener("focus",n),e.addEventListener("mouseleave",s),e.addEventListener("blur",s),e.addEventListener("click",()=>{if(e.getAttribute("data-disabled")==="true"){a.favoriteHelpVisible?s():n();return}const r=A(),c=M.find(d=>d.id===a.routeId),l=c?re(c,a.serviceDay):null,i=c&&g(c)?`${c.id}:${a.campusFrom}->${a.campusTo}`:`${a.routeId}:${a.stopId}`,o=r.some(d=>d.key===i)?r.filter(d=>d.key!==i):[{key:i,routeId:a.routeId,stopId:(l==null?void 0:l.id)||a.stopId,campusFrom:c&&g(c)?a.campusFrom:void 0,campusTo:c&&g(c)?a.campusTo:void 0,savedAt:Date.now()},...r];localStorage.setItem(W,JSON.stringify(o.slice(0,10))),h()})}function Ue(){const e=document.querySelector("#shareLink");e&&e.addEventListener("click",async()=>{const t=new URL(Ae(),window.location.origin).toString();try{await navigator.clipboard.writeText(t),e.textContent="복사됨!",window.setTimeout(()=>{e.textContent="링크 공유"},1200)}catch{window.prompt("링크를 복사해 주세요.",t)}})}function Ye(){const e=document.querySelector("[data-theme-toggle]");e&&(e.addEventListener("click",()=>{const t=document.body.classList.contains("theme-night");Ce(t?"light":"dark"),j(new Date)}),j(new Date))}function ze(){const e=document.querySelector("#favoriteDock"),t=document.querySelector("[data-favorite-tab]"),n=document.querySelector("#favoriteDockPanel");if(!e||!t)return;let s=!1;const r=()=>{t.classList.toggle("is-active",e.classList.contains("is-open"))},c=()=>{e.classList.add("is-open"),r(),i()},l=()=>{s||(e.classList.remove("is-open"),r())};e.addEventListener("mouseenter",()=>c()),e.addEventListener("mouseleave",()=>l()),t.addEventListener("mouseenter",()=>c()),t.addEventListener("mouseleave",()=>l()),e.addEventListener("click",()=>{s=!s,s?e.classList.add("is-open"):e.classList.remove("is-open"),r()}),t.addEventListener("click",()=>{s=!s,s?e.classList.add("is-open"):e.classList.remove("is-open"),r()});const i=()=>{if(!window.matchMedia("(max-width: 640px)").matches||!e.classList.contains("is-open"))return;const d=t.getBoundingClientRect();e.style.top=`${Math.round(d.bottom+8)}px`};document.addEventListener("click",o=>{e.classList.contains("is-open")&&(e.contains(o.target)||t.contains(o.target)||(s=!1,e.classList.remove("is-open"),r()))}),n&&(n.addEventListener("click",o=>{o.stopPropagation();const d=o.target.closest("[data-move-favorite]");if(d){const m=d.dataset.key,b=d.dataset.moveFavorite;if(!m||!b)return;const k=A(),S=k.findIndex($=>$.key===m),L=b==="up"?S-1:S+1;if(S<0||L<0||L>=k.length)return;const w=k.slice();[w[S],w[L]]=[w[L],w[S]],O(w),ne(K(M,a.routeId));return}const u=o.target.closest("[data-remove-favorite]");if(!u)return;const p=u.dataset.removeFavorite;if(!p)return;const f=A().filter(m=>m.key!==p);O(f),h()}),n.addEventListener("click",o=>{if(o.target.closest("[data-remove-favorite]")||o.target.closest("[data-move-favorite]"))return;const p=o.target.closest("[data-jump-route]");if(!p)return;const f=Ie({routeId:p.dataset.jumpRoute,stopId:p.dataset.jumpStop,campusFrom:p.dataset.jumpFrom,campusTo:p.dataset.jumpTo});window.location.href=f})),r(),window.addEventListener("scroll",i,{passive:!0}),window.addEventListener("resize",i),t.addEventListener("click",i),e.addEventListener("mouseenter",i)}function _(){const e=document.querySelector("header.navbar"),t=e==null?void 0:e.querySelector(".brand"),n=e==null?void 0:e.querySelector(".primary-nav"),s=n==null?void 0:n.querySelector(".nav-links"),r=n==null?void 0:n.querySelector(".nav-actions");if(!e||!t||!n||(e.classList.contains("is-wrapped")&&e.classList.remove("is-wrapped"),!s||!r))return;const l=Array.from(s.children).some(x=>x.scrollHeight>x.clientHeight+2),i=Array.from(r.children).some(x=>x.scrollHeight>x.clientHeight+2),o=parseFloat(getComputedStyle(e).gap||"0")||0,d=parseFloat(getComputedStyle(n).gap||"0")||0,u=x=>{const q=Array.from(x.children);if(!q.length)return 0;const pe=parseFloat(getComputedStyle(x).gap||"0")||0;return q.reduce((me,fe)=>me+fe.getBoundingClientRect().width,0)+pe*(q.length-1)},p=u(s)+u(r)+d,f=e.clientWidth-t.getBoundingClientRect().width-o,m=s.getBoundingClientRect(),b=r.getBoundingClientRect(),k=n.getBoundingClientRect(),S=e.getBoundingClientRect(),L=t.getBoundingClientRect(),w=m.right>b.left-8,$=k.left<L.right+8,le=k.right>S.right-8,de=p>f-Te,ue=l||i||w||$||le||de;e.classList.toggle("is-wrapped",ue)}function Je(){var e;_(),window.addEventListener("resize",_),window.addEventListener("load",_),(e=document.fonts)!=null&&e.ready&&document.fonts.ready.then(_)}function Xe(){let e;window.addEventListener("resize",()=>{e&&window.clearTimeout(e),e=window.setTimeout(()=>{a.dropdownOpen&&te(),h()},120)})}function Qe(){var t;const e=(t=window.getSelection)==null?void 0:t.call(window);return e?!e.isCollapsed&&e.toString().trim().length>0:!1}(()=>{const e=new URLSearchParams(window.location.search),t=e.get("route"),n=e.get("stop"),s=e.get("from"),r=e.get("to"),c=e.get("day"),l=e.get("shared");if(t&&M.some(i=>i.id===t)&&(a.routeId=t),n&&(a.stopId=n),(c==="weekday"||c==="weekend")&&(a.serviceOverride=c),l==="1"&&(a.sharedFromLink=!0),s&&E.some(i=>i.id===s)&&(a.campusFrom=s),r&&E.some(i=>i.id===r)&&(a.campusTo=r),a.campusFrom===a.campusTo){const i=E.find(o=>o.id!==a.campusFrom);i&&(a.campusTo=i.id)}})();h();Ve();Ye();ze();Ke();Ue();Je();Xe();setInterval(()=>{var e;if(a.dropdownOpen){a.now=new Date,B();const t=ie(y(a.now)),n=K(t,a.routeId||((e=t[0])==null?void 0:e.id));n&&(a.serviceDay=oe(a.now,n),ce(n));return}if(Qe()){a.now=new Date,B();return}h()},1e3);
