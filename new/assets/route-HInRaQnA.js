import{r as x,b as O,f as H,a as P,g as q,d as F,c as $,t as j,h as B,i as R}from"./stopLabels-Dfnzt6Cm.js";const T="kaist-bus-favorites",E="kaist-bus-theme",S="kaist-bus-night-sky",C="kaist-bus-card-glow";let p=null;const G="campus-loop",v=[{id:"main",label:"본교",match:/본교/},{id:"munji",label:"문지",match:/문지/},{id:"hwaam",label:"화암",match:/화암/}],a={now:new Date,serviceDay:"weekday",serviceOverride:null,routeId:"",stopId:"",campusFrom:"main",campusTo:"munji"};function w(){try{const e=localStorage.getItem(T);return e?JSON.parse(e):[]}catch{return[]}}function K(e){const t=document.querySelector("#favoriteDockPanel"),n=document.querySelector("#favoriteDock"),s=document.querySelector("[data-favorite-tab]");if(!t)return;const o=w();if(!o.length){if(t.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,n&&n.classList.add("is-empty"),s){const i=n==null?void 0:n.classList.contains("is-open");s.classList.toggle("is-active",!!i)}return}n&&n.classList.remove("is-empty");const c=a.now.getHours()*60+a.now.getMinutes(),l=b(a.now),r=o.map(i=>{var I;const d=x.routes.find(g=>g.id===i.routeId);if(!d)return"";let u=d.stops.find(g=>g.id===i.stopId);if(m(d)&&i.campusFrom&&(u=u||D(d,i.campusFrom,i.campusTo)),!u)return"";const y=((I=u.times)==null?void 0:I[l])||[],A=q(y,c-2,2),M=y[y.length-1],N=m(d)&&i.campusFrom?`${h(i.campusFrom)} → ${h(i.campusTo)}`:u.direction&&u.direction!==d.name?`${$(d.id,u.name)} → ${u.direction}`:`${$(d.id,u.name)}`;return`
        <div class="favorite-dock__item">
          <div class="favorite-dock__title">
            <span>${d.name}</span>
            <span>${N}</span>
          </div>
          <div class="favorite-dock__row">
            <div class="favorite-dock__times">
              ${A.map(g=>`
                  <span>
                    ${g}
                    ${M&&g===M?'<em class="last-tag">막차</em>':""}
                  </span>
                `).join("")}
            </div>
            <button class="favorite-dock__remove" type="button" data-remove-favorite="${i.key}">
              삭제
            </button>
          </div>
        </div>
      `}).filter(Boolean);if(!r.length){if(t.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,n&&n.classList.add("is-empty"),s){const i=n==null?void 0:n.classList.contains("is-open");s.classList.toggle("is-active",!!i)}return}t.innerHTML=r.join("")}function b(e){const t=j(e);return B.forcedWeekends.includes(t)||R(e)?"weekend":"weekday"}function W(e){return a.serviceOverride||b(e)}function J(e){const t=["olev","campus-loop","wolpyeong","wolpyeong-early"];return x.routes.sort((n,s)=>{const o=t.indexOf(n.id),c=t.indexOf(s.id),l=o===-1?Number.MAX_SAFE_INTEGER:o,r=c===-1?Number.MAX_SAFE_INTEGER:c;return l!==r?l-r:n.name.localeCompare(s.name)})}function Y(e,t){return e.find(n=>n.id===t)||e[0]}function m(e){return(e==null?void 0:e.id)===G}function h(e){var t;return((t=v.find(n=>n.id===e))==null?void 0:t.label)||e}function k(e){const t=v.find(n=>n.match.test(e));return t?t.id:null}function U(e,t){const n=k(e[t].name);for(let s=t+1;s<e.length;s+=1){const o=k(e[s].name);if(o&&o!==n)return o}return null}function D(e,t,n){const s=e.stops||[],o=s.map((r,i)=>({stop:r,index:i,campus:k(r.name)})).filter(r=>r.campus===t);if(!o.length)return s[0];const c=o.filter(r=>/출발/.test(r.stop.name)),l=c.length?c:o;if(n){const r=l.find(i=>U(s,i.index)===n);if(r)return r.stop}return l[0].stop}function _(e){return m(e)?D(e,a.campusFrom,a.campusTo):e.stops.find(t=>t.id===a.stopId)||e.stops.find(t=>t.default)||e.stops[0]}function V(e){const t=document.querySelector("[data-route-title]"),n=document.querySelector("[data-route-subtitle]"),s=document.querySelector("[data-route-badge]"),o=document.querySelector("[data-weekday]");if(t&&(t.textContent=e.name),n&&(n.textContent=m(e)?`${h(a.campusFrom)} → ${h(a.campusTo)}`:e.subtitle||""),s){const c=e.stops.some(l=>{var r;return(((r=l.times)==null?void 0:r.weekend)||[]).length});s.textContent=c?"매일 운영":"평일 운영",s.classList.toggle("is-daily",c),s.classList.toggle("is-weekday",!c)}o&&(o.textContent=O(a.now))}function X(){const e=document.querySelector("[data-clock]"),t=document.querySelector("[data-date]");!e||!t||(e.textContent=H(a.now),t.textContent=P(a.now))}function z(){try{return localStorage.getItem(E)}catch{return null}}function Q(e){try{localStorage.setItem(E,e)}catch{}}function L(e){const t=z();let n=!0;if(t==="dark")n=!1;else if(t==="light")n=!0;else{const s=e.getHours();n=s>=6&&s<18}document.body.classList.toggle("theme-night",!n),n?document.documentElement.style.removeProperty("--night-sky"):Z()}function Z(){if(!p&&window.__nightSkyCss&&(p=window.__nightSkyCss),!p)try{p=localStorage.getItem(S)||sessionStorage.getItem(S)}catch{p=null}if(!p){p=ee();try{localStorage.setItem(S,p),sessionStorage.setItem(S,p)}catch{}}window.__nightSkyCss=p,document.documentElement.style.setProperty("--night-sky",p)}function ee(){const e=[],n=typeof window<"u"?window.innerWidth:1200,s=typeof window<"u"?window.innerHeight:800;for(let o=0;o<28;o+=1){const c=Math.floor(Math.random()*n),l=Math.floor(Math.random()*s),r=(Math.random()*1.8+.6).toFixed(2),i=(Math.random()*.5+.35).toFixed(2),u=Math.random()<.25?`rgba(255, 238, 180, ${i})`:`rgba(255, 255, 255, ${i})`;e.push(`radial-gradient(circle at ${c}px ${l}px, ${u} 0 ${r}px, transparent ${(Number(r)+1.6).toFixed(2)}px)`)}if(Math.random()<.65){const o=Math.floor(Math.random()*n),c=Math.floor(Math.random()*(s*.6));e.push(`radial-gradient(circle at ${o}px ${c}px, rgba(255, 244, 190, 0.95) 0 4px, transparent 7px)`)}return e.push("linear-gradient(180deg, #05070f 0%, #0b1026 55%, #141b3f 100%)"),e.join(", ")}function te(){const e=()=>Math.random()<.7?Math.random()<.5?-15+Math.random()*20:95+Math.random()*20:15+Math.random()*70,t=(o,c)=>{const l=Math.round(e()),r=Math.round(e()),i=Math.floor(420+Math.random()*420),d=Math.floor(320+Math.random()*360),u=(c+Math.random()*.06).toFixed(2);return`radial-gradient(${i}px ${d}px at ${l}% ${r}%, rgba(${o}, ${u}), transparent 72%)`},n=["246, 226, 138","255, 181, 201","171, 228, 255","160, 255, 224","198, 176, 255","255, 214, 165"],s=[];for(let o=0;o<10;o+=1){const c=n[o%n.length];s.push(t(c,.045))}return s}function ne(){if(!document.body.classList.contains("theme-night"))return;const e=document.querySelectorAll(".hero-card, .next-card, .notice-card, .route-card, .time-table");let t={};try{t=JSON.parse(sessionStorage.getItem(C)||"{}")}catch{t={}}const n=o=>o.classList.contains("hero-card")?"hero":o.classList.contains("next-card")?"next":o.classList.contains("notice-card")?"notice":o.classList.contains("route-card")?"route":o.classList.contains("time-table")?"table":"card",s=location.pathname.replace(/\W+/g,"")||"route";e.forEach((o,c)=>{const l=n(o),r=`${s}:${l}:${c}`;t[r]||(t[r]=te());const[i,d,u]=t[r];o.style.setProperty("--card-glow-1",i),o.style.setProperty("--card-glow-2",d),o.style.setProperty("--card-glow-3",u)});try{sessionStorage.setItem(C,JSON.stringify(t))}catch{}}function se(e,t){const n=document.querySelector("#routeSelect"),s=document.querySelector("#stopSelect"),o=document.querySelector("#stopSelectLabel"),c=document.querySelector("#campusSelector");if(!n||!s)return;n.innerHTML=e.map(r=>`<option value="${r.id}">${r.name}${r.subtitle?` ${r.subtitle}`:""}</option>`).join(""),n.value=t.id;const l=m(t);if(n.disabled=!1,n.classList.remove("route-select--static"),l?s.innerHTML="":s.innerHTML=t.stops.map(r=>`<option value="${r.id}">${r.name}</option>`).join(""),l)s.disabled=!0;else{const r=t.stops.find(i=>i.default)||t.stops[0];a.stopId=a.stopId||r.id,s.value=a.stopId,s.disabled=t.stops.length<=1}s.classList.toggle("is-hidden",l),s.style.display=l?"none":"inline-flex",s.hidden=l,s.setAttribute("aria-hidden",l?"true":"false"),s.tabIndex=l?-1:0,o&&(o.classList.toggle("is-hidden",l),o.hidden=l,o.style.display=l?"none":"inline-flex"),c&&(c.style.display=l?"flex":"none"),n.onchange=r=>{a.routeId=r.target.value,a.stopId="",f()},s.onchange=r=>{a.stopId=r.target.value,f()}}function oe(e){const t=document.querySelector("#campusSelector");if(!t||!m(e))return;const n=t.querySelector("[data-campus-role='from']"),s=t.querySelector("[data-campus-role='to']"),o=t.querySelector("#campusSwap"),c=(i,d)=>{if(i!==d)return{fromId:i,toId:d};const u=v.find(y=>y.id!==i);return{fromId:i,toId:u?u.id:d}},l=i=>{const d=c(i,a.campusTo);a.campusFrom=d.fromId,a.campusTo=d.toId,f()},r=i=>{const d=c(a.campusFrom,i);a.campusFrom=d.fromId,a.campusTo=d.toId,f()};n&&(n.innerHTML=v.map(i=>`
        <button class="campus-pill ${i.id===a.campusFrom?"is-active":""}" data-campus-from="${i.id}">
          ${i.label}
        </button>
      `).join(""),n.querySelectorAll("[data-campus-from]").forEach(i=>{i.addEventListener("click",()=>l(i.dataset.campusFrom))})),s&&(s.innerHTML=v.map(i=>`
        <button class="campus-pill ${i.id===a.campusTo?"is-active":""} ${i.id===a.campusFrom?"is-disabled":""}" data-campus-to="${i.id}" ${i.id===a.campusFrom?"disabled":""}>
          ${i.label}
        </button>
      `).join(""),s.querySelectorAll("[data-campus-to]").forEach(i=>{i.addEventListener("click",()=>r(i.dataset.campusTo))})),o&&(o.onclick=()=>{const i=a.campusTo,d=a.campusFrom;a.campusFrom=i,a.campusTo=d,f()})}function ae(e){const t=document.querySelector("#stopPills");if(!t)return;const n=t.closest("section");if(m(e)){n&&(n.style.display="none");return}if(e.stops.length<=1){n&&(n.style.display="none");return}n&&(n.style.display="block"),t.innerHTML=e.stops.map(s=>`
      <button class="stop-pill ${s.id===a.stopId?"is-active":""}" data-stop="${s.id}">
        ${$(e.id,s.name)}
      </button>
    `).join(""),t.querySelectorAll("[data-stop]").forEach(s=>{s.addEventListener("click",()=>{a.stopId=s.dataset.stop,f()})})}function ie(e,t){var d;const n=document.querySelector("#nextPanel");if(!n)return;const s=a.now.getHours()*60+a.now.getMinutes(),o=((d=t.times)==null?void 0:d[a.serviceDay])||[];if(o.length===0){n.style.display="none";return}n.style.display="";const c=o[o.length-1],l=q(o,s,5),i=m(e)?`${h(a.campusFrom)} → ${h(a.campusTo)}`:`${t.name} 기준`;n.innerHTML=`
    <div class="next-card next-card--wide">
      <div class="next-header">
        <div>
          <h3>${e.name}</h3>
          <p>${i}</p>
        </div>
        <span class="next-badge">가까운 예정</span>
      </div>
      <div class="next-list">
        ${l.map(u=>`
            <div class="next-chip">
              ${u}
              ${c&&u===c?'<span class="last-tag">막차</span>':""}
            </div>
          `).join("")}
      </div>
      <p class="next-note">실시간 위치 아님 · 실제 운행과 차이 가능</p>
    </div>
  `}function re(e,t){var l;const n=document.querySelector("#timeTable"),s=document.querySelector("#timeTableSection");if(!n)return;const o=(((l=t.times)==null?void 0:l[a.serviceDay])||[]).slice().sort((r,i)=>F(r)-F(i)),c=o[o.length-1];if(o.length===0){n.innerHTML=`
      <div class="time-empty">
        선택한 운행일에는 시간표가 없습니다.
      </div>
    `,s&&(s.style.display="");return}s&&(s.style.display=""),n.innerHTML=o.map(r=>`
      <div class="time-row ${c&&r===c?"last-run":""}">
        <span>${r}</span>
        <span class="time-label">${c&&r===c?"막차":"예정"}</span>
      </div>
    `).join("")}function ce(e,t){var l;const n=document.querySelector("#routeNote");if(!n)return;const o=(((l=t==null?void 0:t.times)==null?void 0:l[a.serviceDay])||[]).length===0?"선택한 운행일에는 운행하지 않습니다.":"",c=e.note||"";n.textContent=[o,c].filter(Boolean).join(`
`)}function le(e,t){const n=document.querySelector("#favoriteToggleRoute");if(!n)return;const s=w(),o=m(e)?`${e.id}:${a.campusFrom}->${a.campusTo}`:`${e.id}:${t.id}`;n.textContent=s.some(c=>c.key===o)?"즐겨찾기 해제":"즐겨찾기 추가"}function f(){var s;a.now=new Date,a.serviceDay=W(a.now);const e=J(),t=Y(e,a.routeId||((s=e[0])==null?void 0:s.id));if(!t)return;a.routeId=t.id;const n=_(t);V(t),X(),L(a.now),se(e,t),oe(t),ie(t,n),re(t,n),ce(t,n),ae(t),le(t,n),K(),ne()}function de(){const e=document.querySelector("#serviceDayToggle");if(!e)return;const t=()=>{const n=b(a.now),s=a.serviceOverride||n;e.querySelectorAll("button[data-day]").forEach(o=>{const c=o.dataset.day,r=c==="auto"?!a.serviceOverride:c===s;o.classList.toggle("is-active",r)})};e.addEventListener("click",n=>{const s=n.target.closest("button[data-day]");if(!s)return;const o=s.dataset.day,c=b(a.now);o==="auto"?a.serviceOverride=null:a.serviceOverride=o===c?null:o,t(),f()}),t()}function ue(){const e=document.querySelector("#favoriteToggleRoute");e&&e.addEventListener("click",()=>{const t=w(),n=x.routes.find(l=>l.id===a.routeId),s=n?_(n):null,o=n&&m(n)?`${n.id}:${a.campusFrom}->${a.campusTo}`:`${a.routeId}:${a.stopId}`,c=t.some(l=>l.key===o)?t.filter(l=>l.key!==o):[{key:o,routeId:a.routeId,stopId:(s==null?void 0:s.id)||a.stopId,campusFrom:n&&m(n)?a.campusFrom:void 0,campusTo:n&&m(n)?a.campusTo:void 0,savedAt:Date.now()},...t];localStorage.setItem(T,JSON.stringify(c.slice(0,10))),f()})}function me(){const e=document.querySelector("[data-theme-toggle]");e&&(e.addEventListener("click",()=>{const t=document.body.classList.contains("theme-night");Q(t?"light":"dark"),L(new Date)}),L(new Date))}function pe(){const e=document.querySelector("#favoriteDock"),t=document.querySelector("[data-favorite-tab]"),n=document.querySelector("#favoriteDockPanel");if(!e||!t)return;let s=!1;const o=()=>{t.classList.toggle("is-active",e.classList.contains("is-open"))},c=()=>{e.classList.add("is-open"),o()},l=()=>{s||(e.classList.remove("is-open"),o())};e.addEventListener("mouseenter",()=>c()),e.addEventListener("mouseleave",()=>l()),t.addEventListener("mouseenter",()=>c()),t.addEventListener("mouseleave",()=>l()),e.addEventListener("click",()=>{s=!s,s?e.classList.add("is-open"):e.classList.remove("is-open"),o()}),t.addEventListener("click",()=>{s=!s,s?e.classList.add("is-open"):e.classList.remove("is-open"),o()}),document.addEventListener("click",r=>{window.matchMedia("(max-width: 640px)").matches||e.classList.contains("is-open")&&(e.contains(r.target)||t.contains(r.target)||(s=!1,e.classList.remove("is-open"),o()))}),n&&n.addEventListener("click",r=>{r.stopPropagation();const i=r.target.closest("[data-remove-favorite]");if(!i)return;const d=i.dataset.removeFavorite;if(!d)return;const u=w().filter(y=>y.key!==d);localStorage.setItem(T,JSON.stringify(u)),f()}),o()}f();ue();me();pe();de();setInterval(f,1e3);
