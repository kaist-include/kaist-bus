import{r as we,f as be,a as Se,t as Le,h as ke,i as xe,b as Ee,g as X,c as O}from"./stopLabels-IBM8Cyxe.js";const G="kaist-bus-favorites",Z="kaist-bus-theme",F="kaist-bus-night-sky",N="kaist-bus-night-sky-meta",U="v2",Ie=24*60*60*1e3,$e=1/7,Y="kaist-bus-card-glow",ee="kaist-bus-recent-search";let S=null;const Te="campus-loop",T=[{id:"main",label:"본교",match:/본교/},{id:"munji",label:"문지",match:/문지/},{id:"hwaam",label:"화암",match:/화암/}],Ce=["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],s={now:new Date,serviceDay:"weekday",serviceOverride:null,routeId:"",stopId:"",campusFrom:"main",campusTo:"munji",stopPillsExpanded:!1,dropdownOpen:!1,favoriteHelpVisible:!1,sharedFromLink:!1,routeSearch:"",stopSearch:""},D=new Map,De=12,V=4*60;function _e(e){const n=new Map;return e.forEach(t=>{if(!n.has(t.id)){n.set(t.id,{...t,stops:t.stops.map(c=>{var r,l;return{...c,times:{weekday:[...((r=c.times)==null?void 0:r.weekday)||[]],weekend:[...((l=c.times)==null?void 0:l.weekend)||[]]}}})});return}const o=n.get(t.id);!o.note&&t.note&&(o.note=t.note);const i=new Map(o.stops.map(c=>[c.name,c]));t.stops.forEach(c=>{var l,a;const r=i.get(c.name);if(!r){const d={...c,times:{weekday:[...((l=c.times)==null?void 0:l.weekday)||[]],weekend:[...((a=c.times)==null?void 0:a.weekend)||[]]}};o.stops.push(d),i.set(c.name,d);return}["weekday","weekend"].forEach(d=>{var h,g;const u=((h=r.times)==null?void 0:h[d])||[],p=((g=c.times)==null?void 0:g[d])||[];if(!u.length&&p.length){r.times[d]=[...p];return}p.forEach(f=>{u.includes(f)||u.push(f)})})})}),Array.from(n.values())}const M=_e(we.routes);function P(e){const[n,t]=e.split(":").map(Number);if(Number.isNaN(n)||Number.isNaN(t))return 0;let o=n*60+t;return n<4&&(o+=1440),o}function te(e){return!e||e.length===0?null:Math.max(...e.map(P))}function ne(e,n){if(!e)return null;const t=e.stops.flatMap(o=>{var i;return((i=o.times)==null?void 0:i[n])||[]});return te(t)}function _(e,n){const t=e.stops.filter(o=>{var i;return(((i=o.times)==null?void 0:i[n])||[]).length});return t.length?t:e.stops}function Ae(e,n,t){const o=e.stops.filter(c=>c.id===n);return o.length?o.find(c=>{var r;return(((r=c.times)==null?void 0:r[t])||[]).length})||o[0]:null}function J(e){s.dropdownOpen=e,document.documentElement.classList.toggle("dropdown-open",e)}function oe(){D.forEach(e=>{e.open&&e.close()})}function Me(e){if(D.has(e)){const l=D.get(e);return(!l.wrapper.isConnected||l.wrapper.previousSibling!==e)&&e.after(l.wrapper),l}const n=document.createElement("div");n.className="dropdown";const t=document.createElement("button");t.type="button",t.className="dropdown__button",t.setAttribute("aria-haspopup","listbox"),t.setAttribute("aria-expanded","false");const o=document.createElement("span");o.className="dropdown__label";const i=document.createElement("span");i.className="dropdown__chevron",t.append(o,i);const c=document.createElement("div");c.className="dropdown__list",c.setAttribute("role","listbox"),c.tabIndex=-1,n.append(t,c),e.after(n),e.classList.add("native-select"),e.setAttribute("aria-hidden","true"),e.tabIndex=-1;const r={wrapper:n,button:t,label:o,list:c,optionsKey:"",options:[],activeIndex:0,open:!1,openDropdown(){r.open||(oe(),r.open=!0,n.classList.add("is-open"),t.setAttribute("aria-expanded","true"),J(!0),r.syncActiveIndex(),c.tabIndex=-1,r.searchInput&&r.searchInput.focus())},close(){if(!r.open)return;r.open=!1,n.classList.remove("is-open"),t.setAttribute("aria-expanded","false"),c.tabIndex=-1,t.focus();const l=Array.from(D.values()).some(a=>a.open);J(l)},syncActiveIndex(){const l=e.selectedIndex>=0?e.selectedIndex:0;r.setActive(l)},setActive(l){if(!r.options.length)return;const a=Math.max(0,Math.min(l,r.options.length-1));r.activeIndex=a,r.options.forEach((d,u)=>{const p=u===a;d.classList.toggle("is-active",p),d.setAttribute("aria-selected",p?"true":"false"),p&&d.scrollIntoView({block:"nearest"})})}};return t.addEventListener("click",()=>{r.open?r.close():r.openDropdown()}),t.addEventListener("keydown",l=>{if(l.key==="ArrowDown"||l.key==="ArrowUp"){if(l.preventDefault(),!r.open){r.openDropdown();return}r.setActive(r.activeIndex+(l.key==="ArrowDown"?1:-1));return}if(r.open&&l.key==="Enter"){l.preventDefault();const a=r.options[r.activeIndex];a&&(e.value=a.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),r.close());return}r.open&&l.key==="Escape"&&(l.preventDefault(),r.close())}),c.addEventListener("click",l=>{const a=l.target.closest(".dropdown__option");if(!a)return;const d=a.dataset.value;d!=null&&(e.value=d,e.dispatchEvent(new Event("change",{bubbles:!0})),r.close())}),c.addEventListener("keydown",l=>{if(l.key==="Escape"){l.preventDefault(),r.close();return}if(l.key==="ArrowDown"){l.preventDefault(),r.setActive(r.activeIndex+1);return}if(l.key==="ArrowUp"){l.preventDefault(),r.setActive(r.activeIndex-1);return}if(l.key==="Enter"){l.preventDefault();const a=r.options[r.activeIndex];a&&(e.value=a.dataset.value,e.dispatchEvent(new Event("change",{bubbles:!0})),r.close())}}),document.addEventListener("click",l=>{if(r.ignoreDocumentClick){r.ignoreDocumentClick=!1;return}r.open&&(n.contains(l.target)||r.close())}),D.set(e,r),r}function x(e,n=null){var g;const t=Me(e),o=e.hidden||e.style.display==="none"||e.classList.contains("is-hidden");t.wrapper.style.display=o?"none":"",t.button.disabled=e.disabled,t.button.setAttribute("aria-disabled",e.disabled?"true":"false");const i=e.id==="routeSelect"||e.id==="stopSelect",c=i?e.id:"",r=Array.from(e.options).map(f=>({value:f.value,label:f.textContent})),l=e.id==="routeSelect"?s.routeSearch:e.id==="stopSelect"?s.stopSearch:"",a=n??l,d=[c,r.map(f=>`${f.value}:${f.label}`).join("|")].join("|");if(d!==t.optionsKey){if(t.optionsKey=d,i){if(!t.searchWrap){const f=document.createElement("div");f.className="dropdown__search";const m=document.createElement("input");m.type="search",m.className="dropdown__search-input",m.placeholder=e.id==="routeSelect"?"노선 검색":"정류장 검색",m.addEventListener("compositionstart",()=>{t.isComposing=!0,t.compositionBase=e.id==="routeSelect"?s.routeSearch:s.stopSearch}),m.addEventListener("compositionupdate",()=>{x(e,m.value)}),m.addEventListener("compositionend",()=>{t.isComposing=!1,e.id==="routeSelect"?s.routeSearch=m.value:s.stopSearch=m.value,t.compositionBase="",x(e,m.value)}),m.addEventListener("input",()=>{if(t.isComposing){x(e,m.value);return}e.id==="routeSelect"?s.routeSearch=m.value:s.stopSearch=m.value,x(e,m.value)}),m.addEventListener("keydown",v=>{if(v.key!=="Enter")return;const y=e.id==="routeSelect"?"route":"stop";qe(y,m.value),x(e,m.value)}),f.append(m),t.searchWrap=f,t.searchInput=m}!t.isComposing&&document.activeElement!==t.searchInput&&(t.searchInput.value=a||""),t.recentWrap||(t.recentWrap=document.createElement("div"),t.recentWrap.className="dropdown__recent",t.recentWrap.addEventListener("click",f=>{f.stopPropagation(),t.ignoreDocumentClick=!0;const m=f.target.closest("[data-recent]");if(!m)return;const v=m.dataset.recent||"";e.id==="routeSelect"?s.routeSearch=v:s.stopSearch=v,x(e,v)})),t.optionsContainer||(t.optionsContainer=document.createElement("div")),t.list.replaceChildren(t.searchWrap,t.recentWrap,t.optionsContainer)}else t.list.innerHTML="",t.optionsContainer=t.list;t.optionsContainer.innerHTML="",t.options=r.map((f,m)=>{const v=document.createElement("button");return v.type="button",v.className="dropdown__option",v.setAttribute("role","option"),v.dataset.value=f.value,v.dataset.label=f.label,v.addEventListener("mouseenter",()=>{t.setActive(m)}),t.optionsContainer.append(v),v})}const u=f=>{if(!t.optionsContainer)return;let m=0;t.options.forEach(y=>{const b=y.dataset.label||"",E=f?Ne(b,f):!0;y.style.display=E?"":"none",E&&(y.innerHTML=Re(b,f),m+=1)});const v=t.optionsContainer.querySelector(".dropdown__empty");if(m)v&&v.remove();else if(!v){const y=document.createElement("div");y.className="dropdown__empty",y.textContent="검색 결과가 없습니다.",t.optionsContainer.append(y)}return m};if(i&&t.searchInput&&!t.isComposing&&document.activeElement!==t.searchInput&&t.searchInput.value!==(a||"")&&(t.searchInput.value=a||""),i&&t.recentWrap){const f=e.id==="routeSelect"?"route":"stop",m=ie(f);t.recentWrap.innerHTML=m.length?`
        <div class="dropdown__recent-label">최근 검색</div>
        <div class="dropdown__recent-items">
          ${m.map(v=>`<button type="button" class="dropdown__recent-chip" data-recent="${C(v)}">${C(v)}</button>`).join("")}
        </div>
      `:""}const p=u(a||"");t.isComposing&&(!p||p===0)&&t.compositionBase&&u(t.compositionBase);const h=e.selectedIndex>=0?e.selectedIndex:0;t.label.textContent=((g=r[h])==null?void 0:g.label)||"",t.setActive(h)}function A(){try{const e=localStorage.getItem(G);return e?JSON.parse(e):[]}catch{return[]}}function B(e){localStorage.setItem(G,JSON.stringify(e))}function C(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Fe(e){let n="";for(const t of e){const o=t.charCodeAt(0);if(o>=44032&&o<=55203){const i=Math.floor((o-44032)/588);n+=Ce[i]||""}else n+=t}return n}function se(e){return e&&/^[ㄱ-ㅎ]+$/.test(e)}function Ne(e,n){const t=e.toLowerCase();return!n||t.includes(n)?!0:se(n)?Fe(e).includes(n):!1}function Re(e,n){if(!n||se(n))return C(e);const o=e.toLowerCase().indexOf(n);if(o===-1)return C(e);const i=C(e.slice(0,o)),c=C(e.slice(o,o+n.length)),r=C(e.slice(o+n.length));return`${i}<mark class="search-highlight">${c}</mark>${r}`}function ie(e){try{const n=localStorage.getItem(`${ee}:${e}`);return n?JSON.parse(n):[]}catch{return[]}}function He(e,n){localStorage.setItem(`${ee}:${e}`,JSON.stringify(n))}function qe(e,n){const t=n.trim();if(!t||t.length<2)return;const o=ie(e),i=[t,...o.filter(c=>c.toLowerCase()!==t.toLowerCase())];He(e,i.slice(0,6))}function ae(e){const n=document.querySelector("#favoriteDockPanel"),t=document.querySelector("#favoriteDock"),o=document.querySelector("[data-favorite-tab]");if(!n)return;const i=A();if(!i.length){if(n.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,t&&t.classList.add("is-empty"),o){const a=t==null?void 0:t.classList.contains("is-open");o.classList.toggle("is-active",!!a)}return}t&&t.classList.remove("is-empty"),s.now.getHours()*60+s.now.getMinutes();const c=[],r=[];if(i.forEach(a=>{var b;const d=M.find(E=>E.id===a.routeId);if(!d)return;const u=Q(s.now,null,d);let p=Ae(d,a.stopId,u);if(w(d)&&a.campusFrom&&(p=de({...d,stops:_(d,u)},a.campusFrom,a.campusTo)),!p)return;r.push(a);const h=Q(s.now,p,d),g=H(d,h,((b=p.times)==null?void 0:b[h])||[],a.campusFrom,a.campusTo),f=re(s.now,h),m=g.length?X(g,f-2,2):[],v=g[g.length-1],y=w(d)&&a.campusFrom?`${$(a.campusFrom)} → ${$(a.campusTo)}`:p.direction&&p.direction!==d.name?`${O(d.id,p.name)} → ${p.direction}`:`${O(d.id,p.name)}`;c.push({item:a,route:d,stop:p,label:y,upcoming:m,lastTime:v})}),r.length!==i.length&&B(r),!c.length){if(n.innerHTML=`
      <div class="favorite-dock__empty">
        즐겨찾기가 비어 있어요. 상단의 "즐겨찾기 추가" 버튼으로 등록해 주세요.
      </div>
    `,t&&t.classList.add("is-empty"),o){const a=t==null?void 0:t.classList.contains("is-open");o.classList.toggle("is-active",!!a)}return}const l=c.map((a,d)=>{const u=d===0,p=d===c.length-1;return`
      <div class="favorite-dock__item" ${[`data-jump-route="${a.route.id}"`,`data-jump-stop="${a.stop.id}"`,a.item.campusFrom?`data-jump-from="${a.item.campusFrom}"`:"",a.item.campusTo?`data-jump-to="${a.item.campusTo}"`:""].filter(Boolean).join(" ")}>
        <div class="favorite-dock__title">
          <span>${a.route.name}</span>
          <span>${a.label}</span>
        </div>
        <div class="favorite-dock__row">
          <div class="favorite-dock__times">
            ${a.upcoming.length?a.upcoming.map(g=>`
                      <span>
                        ${g}
                        ${a.lastTime&&g===a.lastTime?'<em class="last-tag">막차</em>':""}
                      </span>
                    `).join(""):'<span class="favorite-dock__empty-text">미운행</span>'}
          </div>
          <div class="favorite-dock__actions">
            <button class="favorite-dock__move" type="button" data-move-favorite="up" data-key="${a.item.key}" ${u?"disabled":""} aria-label="위로">
              ↑
            </button>
            <button class="favorite-dock__move" type="button" data-move-favorite="down" data-key="${a.item.key}" ${p?"disabled":""} aria-label="아래로">
              ↓
            </button>
            <button class="favorite-dock__remove" type="button" data-remove-favorite="${a.item.key}">
              삭제
            </button>
          </div>
        </div>
      </div>
    `});n.innerHTML=l.join("")}function k(e){const n=Le(e);return ke.forcedWeekends.includes(n)||xe(e)?"weekend":"weekday"}function Q(e,n,t){var p;const o=k(e),i=new Date(e);i.setDate(e.getDate()-1);const c=k(i);if(o===c)return o;const r=e.getHours()*60+e.getMinutes();if(r>=V)return o;const l=t?ne(t,c):te(((p=n==null?void 0:n.times)==null?void 0:p[c])||[]),a=l!=null&&l>=r+1440,d=h=>{var g;return(((g=n==null?void 0:n.times)==null?void 0:g[h])||[]).length>0};let u=a?c:o;return u===c&&!d(c)&&d(o)&&(u=o),u===o&&!d(o)&&d(c)&&a&&(u=c),u}function re(e,n){const t=e.getHours()*60+e.getMinutes(),o=k(e);return n!==o&&t<V?t+1440:t}function ce(e,n){if(s.serviceOverride)return s.serviceOverride;if(!n)return k(e);const t=new Date(e);t.setDate(e.getDate()-1);const o=k(t),i=k(e);if(o===i)return i;const c=e.getHours()*60+e.getMinutes();if(c>=V)return i;const r=ne(n,o);return r==null?i:r>=c+1440?o:i}function le(e){const n=["olev","campus-loop","wolpyeong","wolpyeong-early"];return M.sort((t,o)=>{const i=n.indexOf(t.id),c=n.indexOf(o.id),r=i===-1?Number.MAX_SAFE_INTEGER:i,l=c===-1?Number.MAX_SAFE_INTEGER:c;return r!==l?r-l:t.name.localeCompare(o.name)})}function z(e,n){return e.find(t=>t.id===n)||e[0]}function Oe({routeId:e,stopId:n,campusFrom:t,campusTo:o}){const i=new URLSearchParams;e&&i.set("route",e),n&&i.set("stop",n),t&&i.set("from",t),o&&i.set("to",o),s.serviceOverride&&i.set("day",s.serviceOverride);const c=i.toString();return c?`./route.html?${c}`:"./route.html"}function Pe(){const e=new URLSearchParams;return s.routeId&&e.set("route",s.routeId),s.stopId&&e.set("stop",s.stopId),s.campusFrom&&e.set("from",s.campusFrom),s.campusTo&&e.set("to",s.campusTo),s.serviceOverride&&e.set("day",s.serviceOverride),e.set("shared","1"),`./route.html?${e.toString()}`}function w(e){return(e==null?void 0:e.id)===Te}function $(e){var n;return((n=T.find(t=>t.id===e))==null?void 0:n.label)||e}function W(e){const n=T.find(t=>t.match.test(e));return n?n.id:null}function Be(e,n){const t=W(e[n].name);for(let o=n+1;o<e.length;o+=1){const i=W(e[o].name);if(i&&i!==t)return i}return null}function de(e,n,t){const o=e.stops||[],i=o.map((l,a)=>({stop:l,index:a,campus:W(l.name)})).filter(l=>l.campus===n);if(!i.length)return o[0];const c=i.filter(l=>/출발/.test(l.stop.name)),r=c.length?c:i;if(t){const l=r.find(a=>Be(o,a.index)===t);if(l)return l.stop}return r[0].stop}function H(e,n,t,o,i){return!w(e)||n!=="weekend"||o!=="main"||i!=="hwaam"?t:t.filter(c=>c.trim()!=="11:30")}function ue(e,n){var c,r;const t=_(e,n);if(w(e)){let l=de({...e,stops:t},s.campusFrom,s.campusTo);return(((c=l==null?void 0:l.times)==null?void 0:c[n])||[]).length||(l=t.find(d=>{var u;return(((u=d.times)==null?void 0:u[n])||[]).length})||t[0]||e.stops[0]),l}let o=t.find(l=>l.id===s.stopId)||t.find(l=>l.default)||t[0]||e.stops[0];return(((r=o==null?void 0:o.times)==null?void 0:r[n])||[]).length||(o=t.find(l=>{var a;return(((a=l.times)==null?void 0:a[n])||[]).length})||t[0]||e.stops[0]),o}function pe(e){const n=document.querySelector("[data-route-title]"),t=document.querySelector("[data-route-subtitle]"),o=document.querySelector("[data-route-badge]"),i=document.querySelector("[data-weekday]"),c=document.querySelector("#shareNotice");if(n&&(n.textContent=e.name),t&&(t.textContent=w(e)?`${$(s.campusFrom)} → ${$(s.campusTo)}`:e.subtitle||""),c&&(c.textContent=s.sharedFromLink?"공유된 링크로 열림":"",c.style.display=c.textContent?"":"none"),o){const r=e.stops.some(l=>{var a;return(((a=l.times)==null?void 0:a.weekend)||[]).length});o.textContent=r?"매일 운영":"평일 운영",o.classList.toggle("is-daily",r),o.classList.toggle("is-weekday",!r)}if(i){const r=k(s.now)==="weekday"?"평일":"휴일";i.textContent=`${Ee(s.now)} (${r}) ·`}}function j(){const e=document.querySelector("[data-clock]"),n=document.querySelector("[data-date]");if(!e||!n)return;e.textContent=be(s.now);const t=Se(s.now);n.textContent=t.replace(/^\d{4}년\s*/,"")}function We(){try{return localStorage.getItem(Z)}catch{return null}}function je(e){try{localStorage.setItem(Z,e)}catch{}}function K(e){const n=We();let t=!0;if(n==="dark")t=!1;else if(n==="light")t=!0;else{const i=e.getHours();t=i>=6&&i<18}document.body.classList.toggle("theme-night",!t),document.documentElement.classList.toggle("theme-night",!t);const o=document.querySelector('meta[name="theme-color"]');o&&o.setAttribute("content",t?"#e9ecff":"#05070f"),t?(document.documentElement.style.removeProperty("--night-sky"),document.documentElement.style.removeProperty("--app-bg")):Ke()}function Ke(){!S&&window.__nightSkyCss&&(S=window.__nightSkyCss);let e=null;try{e=JSON.parse(localStorage.getItem(N)||sessionStorage.getItem(N)||"null")}catch{e=null}const n=Date.now(),t=!e||e.version!==U||!e.createdAt||n-e.createdAt>Ie;if(!S&&!t)try{S=localStorage.getItem(F)||sessionStorage.getItem(F)}catch{S=null}if(!S||t){S=Ge();try{const o=JSON.stringify({version:U,createdAt:n});localStorage.setItem(F,S),localStorage.setItem(N,o),sessionStorage.setItem(F,S),sessionStorage.setItem(N,o)}catch{}}window.__nightSkyCss=S,document.documentElement.style.setProperty("--night-sky",S),document.documentElement.style.setProperty("--app-bg",S)}function Ge(){const e=[],t=typeof window<"u"?window.innerWidth:1200,o=typeof window<"u"?window.innerHeight:800;for(let i=0;i<28;i+=1){const c=Math.floor(Math.random()*t),r=Math.floor(Math.random()*o),l=(Math.random()*1.8+.6).toFixed(2),a=(Math.random()*.5+.35).toFixed(2),u=Math.random()<.25?`rgba(255, 238, 180, ${a})`:`rgba(255, 255, 255, ${a})`;e.push(`radial-gradient(circle at ${c}px ${r}px, ${u} 0 ${l}px, transparent ${(Number(l)+1.6).toFixed(2)}px)`)}if(Math.random()<$e){const i=Math.floor(Math.random()*t),c=Math.floor(Math.random()*(o*.6));e.push(`radial-gradient(circle at ${i}px ${c}px, rgba(255, 244, 190, 0.6) 0 6px, transparent 12px)`)}return e.push("linear-gradient(180deg, #05070f 0%, #0b1026 55%, #141b3f 100%)"),e.join(", ")}function Ve(){const e=()=>Math.random()<.7?Math.random()<.5?-15+Math.random()*20:95+Math.random()*20:15+Math.random()*70,n=(i,c)=>{const r=Math.round(e()),l=Math.round(e()),a=Math.floor(420+Math.random()*420),d=Math.floor(320+Math.random()*360),u=(c+Math.random()*.06).toFixed(2);return`radial-gradient(${a}px ${d}px at ${r}% ${l}%, rgba(${i}, ${u}), transparent 72%)`},t=["246, 226, 138","255, 181, 201","171, 228, 255","160, 255, 224","198, 176, 255","255, 214, 165"],o=[];for(let i=0;i<10;i+=1){const c=t[i%t.length];o.push(n(c,.045))}return o}function ze(){if(!document.body.classList.contains("theme-night"))return;const e=document.querySelectorAll(".hero-card, .next-card, .notice-card, .route-card, .time-table");let n={};try{n=JSON.parse(sessionStorage.getItem(Y)||"{}")}catch{n={}}const t=i=>i.classList.contains("hero-card")?"hero":i.classList.contains("next-card")?"next":i.classList.contains("notice-card")?"notice":i.classList.contains("route-card")?"route":i.classList.contains("time-table")?"table":"card",o=location.pathname.replace(/\W+/g,"")||"route";e.forEach((i,c)=>{const r=t(i),l=`${o}:${r}:${c}`;n[l]||(n[l]=Ve());const[a,d,u]=n[l];i.style.setProperty("--card-glow-1",a),i.style.setProperty("--card-glow-2",d),i.style.setProperty("--card-glow-3",u)});try{sessionStorage.setItem(Y,JSON.stringify(n))}catch{}}function Ue(e,n){const t=document.querySelector("#routeSelect"),o=document.querySelector("#stopSelect"),i=document.querySelector("#stopSelectLabel"),c=document.querySelector("#stopSelectRow"),r=document.querySelector("#routeSearch"),l=document.querySelector("#stopSearch"),a=document.querySelector("#campusSelector");if(!t||!o)return;t.innerHTML=e.map(u=>`<option value="${u.id}">${u.name}${u.subtitle?` ${u.subtitle}`:""}</option>`).join(""),t.value=n.id;const d=w(n);if(t.disabled=!1,t.classList.remove("route-select--static"),d)o.innerHTML="";else{const u=_(n,s.serviceDay);o.innerHTML=u.map(p=>`<option value="${p.id}">${p.name}</option>`).join("")}if(d)o.disabled=!0;else{const u=_(n,s.serviceDay),p=u.find(h=>h.default)||u[0];s.stopId=u.some(h=>h.id===s.stopId)?s.stopId:p==null?void 0:p.id,o.value=s.stopId,o.disabled=u.length<=1}o.classList.toggle("is-hidden",d),o.style.display=d?"none":"inline-flex",o.hidden=d,o.setAttribute("aria-hidden",d?"true":"false"),o.tabIndex=d?-1:0,i&&(i.classList.toggle("is-hidden",d),i.hidden=d,i.style.display=d?"none":"inline-flex"),c&&(c.classList.toggle("is-hidden",d),c.hidden=d,c.style.display=d?"none":"flex"),a&&(a.style.display=d?"flex":"none"),x(t),x(o),t.onchange=u=>{s.routeId=u.target.value,s.stopId="",L()},o.onchange=u=>{s.stopId=u.target.value,L()},r&&(r.dataset.bound||(r.dataset.bound="true",r.addEventListener("input",()=>{s.routeSearch=r.value,x(t)})),r.value!==s.routeSearch&&(r.value=s.routeSearch)),l&&(l.dataset.bound||(l.dataset.bound="true",l.addEventListener("input",()=>{s.stopSearch=l.value,x(o)})),l.value!==s.stopSearch&&(l.value=s.stopSearch))}function Ye(e){const n=document.querySelector("#campusSelector");if(!n||!w(e))return;const t=n.querySelector("[data-campus-role='from']"),o=n.querySelector("[data-campus-role='to']"),i=n.querySelector("#campusSwap"),c=(a,d)=>{if(a!==d)return{fromId:a,toId:d};const u=T.find(p=>p.id!==a);return{fromId:a,toId:u?u.id:d}},r=a=>{const d=c(a,s.campusTo);s.campusFrom=d.fromId,s.campusTo=d.toId,L()},l=a=>{const d=c(s.campusFrom,a);s.campusFrom=d.fromId,s.campusTo=d.toId,L()};t&&(t.innerHTML=T.map(a=>`
        <button class="campus-pill ${a.id===s.campusFrom?"is-active":""}" data-campus-from="${a.id}">
          ${a.label}
        </button>
      `).join(""),t.querySelectorAll("[data-campus-from]").forEach(a=>{a.addEventListener("click",()=>r(a.dataset.campusFrom))})),o&&(o.innerHTML=T.map(a=>`
        <button class="campus-pill ${a.id===s.campusTo?"is-active":""} ${a.id===s.campusFrom?"is-disabled":""}" data-campus-to="${a.id}" ${a.id===s.campusFrom?"disabled":""}>
          ${a.label}
        </button>
      `).join(""),o.querySelectorAll("[data-campus-to]").forEach(a=>{a.addEventListener("click",()=>l(a.dataset.campusTo))})),i&&(i.onclick=()=>{const a=s.campusTo,d=s.campusFrom;s.campusFrom=a,s.campusTo=d,L()})}function Je(e){const n=document.querySelector("#stopPills"),t=document.querySelector("#stopPillsToggle");if(!n)return;const o=n.closest("section");if(w(e)){o&&(o.style.display="none");return}if(e.stops.length<=1){o&&(o.style.display="none");return}o&&(o.style.display="block");const i=_(e,s.serviceDay);n.innerHTML=i.map(r=>`
      <button class="stop-pill ${r.id===s.stopId?"is-active":""}" data-stop="${r.id}">
        ${O(e.id,r.name)}
      </button>
    `).join("");const c=()=>{if(!t)return;const r=n.scrollHeight>n.clientHeight+4;t.style.display=r||s.stopPillsExpanded?"inline-flex":"none",t.innerHTML="",t.classList.toggle("is-open",s.stopPillsExpanded)};n.classList.toggle("is-collapsed",!s.stopPillsExpanded),n.querySelectorAll("[data-stop]").forEach(r=>{r.addEventListener("click",()=>{s.stopId=r.dataset.stop,L()})}),t&&(t.onclick=()=>{s.stopPillsExpanded=!s.stopPillsExpanded,n.classList.toggle("is-collapsed",!s.stopPillsExpanded),c()}),requestAnimationFrame(c)}function Qe(e,n){var d;const t=document.querySelector("#nextPanel");if(!t)return;if(s.serviceOverride){t.style.display="";const p=w(e)?`${$(s.campusFrom)} → ${$(s.campusTo)}`:`${n.name} 기준`;t.innerHTML=`
      <div class="next-header">
        <div>
          <h3>${e.name}</h3>
          <p>${p}</p>
        </div>
        <span class="next-badge">가까운 예정</span>
      </div>
      <div class="next-list">
        <div class="next-empty-inline">오늘 기준에서만 가까운 예정이 표시됩니다.</div>
      </div>
    `;return}const o=re(s.now,s.serviceDay),i=H(e,s.serviceDay,((d=n.times)==null?void 0:d[s.serviceDay])||[],s.campusFrom,s.campusTo);if(i.length===0){t.style.display="none";return}t.style.display="";const c=i[i.length-1],r=X(i,o-2,5),a=w(e)?`${$(s.campusFrom)} → ${$(s.campusTo)}`:`${n.name} 기준`;t.innerHTML=`
    <div class="next-header">
      <div>
        <h3>${e.name}</h3>
        <p>${a}</p>
      </div>
      <span class="next-badge">가까운 예정</span>
    </div>
    <div class="next-list">
      ${r.map(u=>`
          <div class="next-chip">
            ${u}
            ${c&&u===c?'<span class="last-tag">막차</span>':""}
          </div>
        `).join("")}
    </div>
    <p class="next-note">실시간 위치 아님 · 실제 운행과 차이 가능</p>
  `}function Xe(e,n){var r;const t=document.querySelector("#timeTable"),o=document.querySelector("#timeTableSection");if(!t)return;const i=H(e,s.serviceDay,((r=n.times)==null?void 0:r[s.serviceDay])||[],s.campusFrom,s.campusTo).slice().sort((l,a)=>P(l)-P(a)),c=i[i.length-1];if(i.length===0){t.innerHTML=`
      <div class="time-empty">
        선택한 운행일에는 시간표가 없습니다.
      </div>
    `,o&&(o.style.display="");return}o&&(o.style.display=""),t.innerHTML=i.map(l=>`
      <div class="time-row ${c&&l===c?"last-run":""}">
        <span>${l}</span>
        <span class="time-label">${c&&l===c?"막차":"예정"}</span>
      </div>
    `).join("")}function Ze(e,n){var a;const t=document.querySelector("#routeNote");if(!t)return;const i=H(e,s.serviceDay,((a=n==null?void 0:n.times)==null?void 0:a[s.serviceDay])||[],s.campusFrom,s.campusTo).length===0?"선택한 운행일에는 운행하지 않습니다.":"",c=w(e)&&s.serviceDay==="weekend"&&s.campusFrom==="main"&&s.campusTo==="hwaam"?`주말에는 기사님께 요청하시면 화암관을 경유합니다.

단, 본교출발 11:30회차는 기사님 점심시간 확보를 위해 요청이 불가합니다.`:"",r=e.note||"",l=[i,c,r].filter(Boolean).join(`
`).trim();t.textContent=l,t.style.display=l?"":"none"}function et(e,n){var u;const t=document.querySelector("#favoriteToggleRoute"),o=document.querySelector("#favoriteHelp");if(!t)return;const i=A(),c=w(e)?`${e.id}:${s.campusFrom}->${s.campusTo}`:`${e.id}:${s.stopId||n.id}`,l=(((u=n==null?void 0:n.times)==null?void 0:u[s.serviceDay])||[]).length===0,a=i.some(p=>p.key===c);t.textContent=a?"즐겨찾기 해제":"즐겨찾기 추가";const d=l&&!a;t.disabled=!1,t.classList.toggle("is-disabled",d),t.setAttribute("aria-disabled",d?"true":"false"),t.setAttribute("data-disabled",d?"true":"false"),o&&(l&&!a?(o.textContent="선택한 운행일에는 운행하지 않아 즐겨찾기를 추가할 수 없어요.",s.favoriteHelpVisible?(o.classList.add("is-visible"),o.setAttribute("aria-hidden","false")):(o.classList.remove("is-visible"),o.setAttribute("aria-hidden","true"))):(o.textContent="",o.classList.remove("is-visible"),o.setAttribute("aria-hidden","true")))}function L(){var o;s.now=new Date;const e=le(k(s.now)),n=z(e,s.routeId||((o=e[0])==null?void 0:o.id));if(!n)return;s.routeId=n.id,s.serviceDay=ce(s.now,n);const t=ue(n,s.serviceDay);pe(n),j(),K(s.now),Ue(e,n),Ye(n),Qe(n,t),Xe(n,t),Ze(n,t),Je(n),et(n,t),ae(),ze()}function tt(){const e=document.querySelector("#serviceDayToggle");if(!e)return;const n=()=>{const t=k(s.now),o=s.serviceOverride||t;e.querySelectorAll("button[data-day]").forEach(i=>{const c=i.dataset.day,l=c==="auto"?!s.serviceOverride:c===o;i.classList.toggle("is-active",l)})};e.addEventListener("click",t=>{const o=t.target.closest("button[data-day]");if(!o)return;const i=o.dataset.day,c=k(s.now);i==="auto"?s.serviceOverride=null:s.serviceOverride=i===c?null:i,n(),L()}),n()}function nt(){const e=document.querySelector("#favoriteToggleRoute"),n=document.querySelector("#favoriteHelp");if(!e)return;const t=()=>{n&&e.getAttribute("data-disabled")==="true"&&n.textContent.trim()&&(s.favoriteHelpVisible=!0,n.classList.add("is-visible"),n.setAttribute("aria-hidden","false"),n.classList.remove("is-flipped"),requestAnimationFrame(()=>{const i=n.getBoundingClientRect(),c=i.right>window.innerWidth-12,r=i.left<12;c&&!r&&n.classList.add("is-flipped")}))},o=()=>{n&&e.getAttribute("data-disabled")==="true"&&(s.favoriteHelpVisible=!1,n.classList.remove("is-visible"),n.setAttribute("aria-hidden","true"))};e.addEventListener("mouseenter",t),e.addEventListener("focus",t),e.addEventListener("mouseleave",o),e.addEventListener("blur",o),e.addEventListener("click",()=>{if(e.getAttribute("data-disabled")==="true"){s.favoriteHelpVisible?o():t();return}const i=A(),c=M.find(d=>d.id===s.routeId),r=c?ue(c,s.serviceDay):null,l=c&&w(c)?`${c.id}:${s.campusFrom}->${s.campusTo}`:`${s.routeId}:${s.stopId}`,a=i.some(d=>d.key===l)?i.filter(d=>d.key!==l):[{key:l,routeId:s.routeId,stopId:(r==null?void 0:r.id)||s.stopId,campusFrom:c&&w(c)?s.campusFrom:void 0,campusTo:c&&w(c)?s.campusTo:void 0,savedAt:Date.now()},...i];localStorage.setItem(G,JSON.stringify(a.slice(0,10))),L()})}function ot(){const e=document.querySelector("#shareLink");e&&e.addEventListener("click",async()=>{const n=new URL(Pe(),window.location.origin).toString();try{await navigator.clipboard.writeText(n),e.textContent="복사됨!",window.setTimeout(()=>{e.textContent="링크 공유"},1200)}catch{window.prompt("링크를 복사해 주세요.",n)}})}function st(){const e=document.querySelector("[data-theme-toggle]");e&&(e.addEventListener("click",()=>{const n=document.body.classList.contains("theme-night");je(n?"light":"dark"),K(new Date)}),K(new Date))}function it(){const e=document.querySelector("#favoriteDock"),n=document.querySelector("[data-favorite-tab]"),t=document.querySelector("#favoriteDockPanel");if(!e||!n)return;let o=!1;const i=()=>{n.classList.toggle("is-active",e.classList.contains("is-open"))},c=()=>{e.classList.add("is-open"),i(),l()},r=()=>{o||(e.classList.remove("is-open"),i())};e.addEventListener("mouseenter",()=>c()),e.addEventListener("mouseleave",()=>r()),n.addEventListener("mouseenter",()=>c()),n.addEventListener("mouseleave",()=>r()),e.addEventListener("click",()=>{o=!o,o?e.classList.add("is-open"):e.classList.remove("is-open"),i()}),n.addEventListener("click",()=>{o=!o,o?e.classList.add("is-open"):e.classList.remove("is-open"),i()});const l=()=>{if(!window.matchMedia("(max-width: 640px)").matches||!e.classList.contains("is-open"))return;const d=n.getBoundingClientRect();e.style.top=`${Math.round(d.bottom+8)}px`};document.addEventListener("click",a=>{e.classList.contains("is-open")&&(e.contains(a.target)||n.contains(a.target)||(o=!1,e.classList.remove("is-open"),i()))}),t&&(t.addEventListener("click",a=>{a.stopPropagation();const d=a.target.closest("[data-move-favorite]");if(d){const g=d.dataset.key,f=d.dataset.moveFavorite;if(!g||!f)return;const m=A(),v=m.findIndex(E=>E.key===g),y=f==="up"?v-1:v+1;if(v<0||y<0||y>=m.length)return;const b=m.slice();[b[v],b[y]]=[b[y],b[v]],B(b),ae(z(M,s.routeId));return}const u=a.target.closest("[data-remove-favorite]");if(!u)return;const p=u.dataset.removeFavorite;if(!p)return;const h=A().filter(g=>g.key!==p);B(h),L()}),t.addEventListener("click",a=>{if(a.target.closest("[data-remove-favorite]")||a.target.closest("[data-move-favorite]"))return;const p=a.target.closest("[data-jump-route]");if(!p)return;const h=Oe({routeId:p.dataset.jumpRoute,stopId:p.dataset.jumpStop,campusFrom:p.dataset.jumpFrom,campusTo:p.dataset.jumpTo});window.location.href=h})),i(),window.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",l),n.addEventListener("click",l),e.addEventListener("mouseenter",l)}function R(){const e=document.querySelector("header.navbar"),n=e==null?void 0:e.querySelector(".brand"),t=e==null?void 0:e.querySelector(".primary-nav"),o=t==null?void 0:t.querySelector(".nav-links"),i=t==null?void 0:t.querySelector(".nav-actions");if(!e||!n||!t||(e.classList.contains("is-wrapped")&&e.classList.remove("is-wrapped"),!o||!i))return;const r=Array.from(o.children).some(I=>I.scrollHeight>I.clientHeight+2),l=Array.from(i.children).some(I=>I.scrollHeight>I.clientHeight+2),a=parseFloat(getComputedStyle(e).gap||"0")||0,d=parseFloat(getComputedStyle(t).gap||"0")||0,u=I=>{const q=Array.from(I.children);if(!q.length)return 0;const ge=parseFloat(getComputedStyle(I).gap||"0")||0;return q.reduce((he,ye)=>he+ye.getBoundingClientRect().width,0)+ge*(q.length-1)},p=u(o)+u(i)+d,h=e.clientWidth-n.getBoundingClientRect().width-a,g=o.getBoundingClientRect(),f=i.getBoundingClientRect(),m=t.getBoundingClientRect(),v=e.getBoundingClientRect(),y=n.getBoundingClientRect(),b=g.right>f.left-8,E=m.left<y.right+8,me=m.right>v.right-8,fe=p>h-De,ve=r||l||b||E||me||fe;e.classList.toggle("is-wrapped",ve)}function at(){var e;R(),window.addEventListener("resize",R),window.addEventListener("load",R),(e=document.fonts)!=null&&e.ready&&document.fonts.ready.then(R)}function rt(){let e;window.addEventListener("resize",()=>{e&&window.clearTimeout(e),e=window.setTimeout(()=>{s.dropdownOpen&&oe(),L()},120)})}function ct(){var n;const e=(n=window.getSelection)==null?void 0:n.call(window);return e?!e.isCollapsed&&e.toString().trim().length>0:!1}(()=>{const e=new URLSearchParams(window.location.search),n=e.get("route"),t=e.get("stop"),o=e.get("from"),i=e.get("to"),c=e.get("day"),r=e.get("shared");if(n&&M.some(l=>l.id===n)&&(s.routeId=n),t&&(s.stopId=t),(c==="weekday"||c==="weekend")&&(s.serviceOverride=c),r==="1"&&(s.sharedFromLink=!0),o&&T.some(l=>l.id===o)&&(s.campusFrom=o),i&&T.some(l=>l.id===i)&&(s.campusTo=i),s.campusFrom===s.campusTo){const l=T.find(a=>a.id!==s.campusFrom);l&&(s.campusTo=l.id)}})();L();nt();st();it();tt();ot();at();rt();setInterval(()=>{var e;if(s.dropdownOpen){s.now=new Date,j();const n=le(k(s.now)),t=z(n,s.routeId||((e=n[0])==null?void 0:e.id));t&&(s.serviceDay=ce(s.now,t),pe(t));return}if(ct()){s.now=new Date,j();return}L()},1e3);
